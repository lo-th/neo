/**
 * @license
 * Copyright 2010-2021 Neo.js Authors
 * SPDX-License-Identifier: MIT
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).NEO={})}(this,(function(t){"use strict";!function(t){"performance"in t||(t.performance={});var i=t.performance;t.performance.now=i.now||i.mozNow||i.msNow||i.oNow||i.webkitNow||Date.now||function(){return(new Date).getTime()}}(self),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),s=1;s<arguments.length;s++){var e=arguments[s];if(null!=e)for(var h in e)Object.prototype.hasOwnProperty.call(e,h)&&(i[h]=e[h])}return i})
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */;var i=function(t){if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var i=t.document,s=function(){return t.URL||t.webkitURL||t},e=i.createElementNS("http://www.w3.org/1999/xhtml","a"),h="download"in e,o=/constructor/i.test(t.HTMLElement)||t.safari,n=/CriOS\/[\d]+/.test(navigator.userAgent),r=function(i){(t.setImmediate||t.setTimeout)((function(){throw i}),0)},l=function(t){setTimeout((function(){"string"==typeof t?s().revokeObjectURL(t):t.remove()}),4e4)},a=function(t,i,s){for(var e=(i=[].concat(i)).length;e--;){var h=t["on"+i[e]];if("function"==typeof h)try{h.call(t,s||t)}catch(t){r(t)}}},c=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},d=function(i,r,d){d||(i=c(i));var u,p=this,m="application/octet-stream"===i.type,g=function(){a(p,"writestart progress write writeend".split(" "))};if(p.readyState=p.INIT,h)return u=s().createObjectURL(i),void setTimeout((function(){e.href=u,e.download=r,function(t){var i=new MouseEvent("click");t.dispatchEvent(i)}(e),g(),l(u),p.readyState=p.DONE}));!function(){if((n||m&&o)&&t.FileReader){var e=new FileReader;return e.onloadend=function(){var i=n?e.result:e.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(i,"_blank")||(t.location.href=i),i=void 0,p.readyState=p.DONE,g()},e.readAsDataURL(i),void(p.readyState=p.INIT)}(u||(u=s().createObjectURL(i)),m)?t.location.href=u:t.open(u,"_blank")||(t.location.href=u);p.readyState=p.DONE,g(),l(u)}()},u=d.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,i,s){return i=i||t.name||"download",s||(t=c(t)),navigator.msSaveOrOpenBlob(t,i)}:(u.abort=function(){},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,function(t,i,s){return new d(t,i||t.name||"download",s)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window);
/**
	 * @license
	 * Copyright 2010-2021 Uil.js Authors
	 * SPDX-License-Identifier: MIT
	 */const s={ui:[],dom:null,ID:null,lock:!1,wlock:!1,current:-1,needReZone:!0,isEventsInit:!1,isLeave:!1,downTime:0,prevTime:0,prevDefault:["contextmenu","wheel"],pointerEvent:["pointerdown","pointermove","pointerup"],eventOut:["pointercancel","pointerout","pointerleave"],xmlserializer:null,tmpTime:null,tmpImage:null,oldCursor:"auto",input:null,parent:null,firstImput:!0,hiddenImput:null,hiddenSizer:null,hasFocus:!1,startInput:!1,inputRange:[0,0],cursorId:0,str:"",pos:0,startX:-1,moveX:-1,debugInput:!1,isLoop:!1,listens:[],e:{type:null,clientX:0,clientY:0,keyCode:NaN,key:null,delta:0},isMobile:!1,now:null,getTime:function(){return self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now},add:function(t){s.ui.push(t),s.getZone(t),s.isEventsInit||s.initEvents()},testMobile:function(){let t=navigator.userAgent;return!!(t.match(/Android/i)||t.match(/webOS/i)||t.match(/iPhone/i)||t.match(/iPad/i)||t.match(/iPod/i)||t.match(/BlackBerry/i)||t.match(/Windows Phone/i))},remove:function(t){let i=s.ui.indexOf(t);-1!==i&&(s.removeListen(t),s.ui.splice(i,1)),0===s.ui.length&&s.removeEvents()},initEvents:function(){if(s.isEventsInit)return;let t=document.body;s.isMobile=s.testMobile(),s.now=s.getTime(),s.isMobile?t.style.touchAction="none":t.addEventListener("wheel",s,{passive:!1}),t.addEventListener("pointercancel",s),t.addEventListener("pointerleave",s),t.addEventListener("pointermove",s),t.addEventListener("pointerdown",s),t.addEventListener("pointerup",s),t.addEventListener("keydown",s,!1),t.addEventListener("keyup",s,!1),window.addEventListener("resize",s.resize,!1),s.isEventsInit=!0,s.dom=t},removeEvents:function(){if(!s.isEventsInit)return;let t=document.body;s.isMobile||t.removeEventListener("wheel",s),t.removeEventListener("pointercancel",s),t.removeEventListener("pointerleave",s),t.removeEventListener("pointermove",s),t.removeEventListener("pointerdown",s),t.removeEventListener("pointerup",s),t.removeEventListener("keydown",s),t.removeEventListener("keyup",s),window.removeEventListener("resize",s.resize),s.isEventsInit=!1},resize:function(){s.needReZone=!0;let t,i=s.ui.length;for(;i--;)t=s.ui[i],t.isGui&&!t.isCanvasOnly&&t.autoResize&&t.calc()},out:function(){console.log("im am out"),s.clearOldID()},in:function(){console.log("im am in")},fakeUp:function(){this.handleEvent({type:"pointerup"})},handleEvent:function(t){-1!==s.prevDefault.indexOf(t.type)&&t.preventDefault(),s.findZone();let i=s.e,e=!1;"keydown"===t.type&&s.keydown(t),"keyup"===t.type&&s.keyup(t),"wheel"===t.type?i.delta=t.deltaY>0?1:-1:i.delta=0;let h=t.pointerType;if(i.clientX=("touch"===h?t.pageX:t.clientX)||0,i.clientY=("touch"===h?t.pageY:t.clientY)||0,i.type=t.type,-1!==s.eventOut.indexOf(t.type)&&(e=!0,i.type="mouseup"),"pointerleave"===t.type&&(s.isLeave=!0),"pointerdown"===t.type&&(i.type="mousedown"),"pointerup"===t.type&&(i.type="mouseup"),"pointermove"===t.type&&(s.isLeave&&(s.isLeave=!1,s.resize()),i.type="mousemove"),"mousedown"===i.type){if(s.downTime=s.now(),s.downTime-s.prevTime<200)return s.selectAll(),!1;s.prevTime=s.downTime}"mousedown"===i.type&&s.clearInput(),"mousedown"===i.type&&(s.lock=!0),"mouseup"===i.type&&(s.lock=!1),s.isMobile&&"mousedown"===i.type&&s.findID(i),"mousemove"!==i.type||s.lock||s.findID(i),null!==s.ID&&(s.ID.isCanvasOnly&&(i.clientX=s.ID.mouse.x,i.clientY=s.ID.mouse.y),s.ID.handleEvent(i)),s.isMobile&&"mouseup"===i.type&&s.clearOldID(),e&&s.clearOldID()},findID:function(t){let i,e,h,o=s.ui.length,n=-1;for(;o--;)if(i=s.ui[o],i.isCanvasOnly?(e=i.mouse.x,h=i.mouse.y):(e=t.clientX,h=t.clientY),s.onZone(i,e,h)){n=o,n!==s.current&&(s.clearOldID(),s.current=n,s.ID=i);break}-1===n&&s.clearOldID()},clearOldID:function(){s.ID&&(s.current=-1,s.ID.reset(),s.ID=null,s.cursor())},calcUis:function(t,i,e){let h,o,n=t.length,r=0,l=0,a=0,c=1;for(;n--;)h=t[l],l++,h.isGroup&&h.calcUis(),h.zone.w=h.w,h.zone.h=h.h,c=h.margin,h.autoWidth?(r=0,h.zone.x=i.x,h.zone.y=e,e+=h.h+c,a+=h.h+c):(0===r&&(a+=h.h+c),h.zone.x=i.x+r,h.zone.y=e,o=s.getWidth(h),o?h.zone.w=h.w=o:h.fw&&(h.zone.w=h.w=h.fw),r+=h.zone.w,r>=i.w&&(e+=h.h+c,r=0));return a},findTarget:function(t,i){let e=t.length;for(;e--;)if(s.onZone(t[e],i.clientX,i.clientY))return e;return-1},findZone:function(t){if(s.needReZone||t){for(var i,e=s.ui.length;e--;)i=s.ui[e],s.getZone(i),i.isGui&&i.calcUis();s.needReZone=!1}},onZone:function(t,i,s){if(void 0===i||void 0===s)return!1;let e=t.zone,h=i-e.x,o=s-e.y,n=h>=0&&o>=0&&h<=e.w&&o<=e.h;return n?t.local.set(h,o):t.local.neg(),n},getWidth:function(t){return t.getDom().clientWidth},getZone:function(t){if(t.isCanvasOnly)return;let i=t.getDom().getBoundingClientRect();t.zone={x:i.left,y:i.top,w:i.width,h:i.height}},cursor:function(t){(t=t||"auto")!==s.oldCursor&&(document.body.style.cursor=t,s.oldCursor=t)},toCanvas:function(t,i,e,h){if(s.xmlserializer||(s.xmlserializer=new XMLSerializer),h&&null!==s.tmpTime&&(clearTimeout(s.tmpTime),s.tmpTime=null),null!==s.tmpTime)return;s.lock&&(s.tmpTime=setTimeout((function(){s.tmpTime=null}),10));let o=!1;i===t.canvas.width&&e===t.canvas.height||(o=!0),null===s.tmpImage&&(s.tmpImage=new Image);let n=s.tmpImage,r=s.xmlserializer.serializeToString(t.content),l='<svg xmlns="http://www.w3.org/2000/svg" width="'+i+'" height="'+e+'"><foreignObject style="pointer-events: none; left:0;" width="100%" height="100%">'+r+"</foreignObject></svg>";n.onload=function(){let s=t.canvas.getContext("2d");o?(t.canvas.width=i,t.canvas.height=e):s.clearRect(0,0,i,e),s.drawImage(this,0,0),t.onDraw()},n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(l),n.crossOrigin=""},setHidden:function(){null===s.hiddenImput&&(s.hiddenImput=document.createElement("input"),s.hiddenImput.type="text",s.hiddenSizer=document.createElement("div"),document.body.appendChild(s.hiddenImput),document.body.appendChild(s.hiddenSizer));let t=s.debugInput?"":"opacity:0; zIndex:0;",i=s.parent.css.txtselect+"padding:0; width:auto; height:auto; left:10px; top:auto; color:#FFF; background:#000;"+t;s.hiddenImput.style.cssText=i+"bottom:10px;"+(s.debugInput?"":"transform:scale(0);"),s.hiddenSizer.style.cssText=i+"bottom:40px;",s.hiddenImput.style.width=s.input.clientWidth+"px",s.hiddenImput.value=s.str,s.hiddenSizer.innerHTML=s.str,s.hasFocus=!0},clearHidden:function(t){null!==s.hiddenImput&&(s.hasFocus=!1)},clickPos:function(t){let i=s.str.length,e=0,h=0;for(;i--&&(e+=s.textWidth(s.str[h]),!(e>=t));)h++;return h},upInput:function(t,i){if(null===s.parent)return!1;let e=!1;if(i){let i=s.clickPos(t);if(s.moveX=i,-1===s.startX)s.startX=i,s.cursorId=i,s.inputRange=[s.startX,s.startX];else{s.moveX!==s.startX&&(s.startX>s.moveX?s.inputRange=[s.moveX,s.startX]:s.inputRange=[s.startX,s.moveX])}e=!0}else-1!==s.startX&&(s.hasFocus=!0,s.hiddenImput.focus(),s.hiddenImput.selectionStart=s.inputRange[0],s.hiddenImput.selectionEnd=s.inputRange[1],s.startX=-1,e=!0);return e&&s.selectParent(),e},selectAll:function(){s.parent&&(s.str=s.input.textContent,s.inputRange=[0,s.str.length],s.hasFocus=!0,s.hiddenImput.focus(),s.hiddenImput.selectionStart=s.inputRange[0],s.hiddenImput.selectionEnd=s.inputRange[1],s.cursorId=s.inputRange[1],s.selectParent())},selectParent:function(){var t=s.textWidth(s.str.substring(0,s.cursorId)),i=s.textWidth(s.str.substring(0,s.inputRange[0])),e=s.textWidth(s.str.substring(s.inputRange[0],s.inputRange[1]));s.parent.select(t,i,e,s.hiddenSizer.innerHTML)},textWidth:function(t){return null===s.hiddenSizer?0:(t=t.replace(/ /g,"&nbsp;"),s.hiddenSizer.innerHTML=t,s.hiddenSizer.clientWidth)},clearInput:function(){null!==s.parent&&(s.firstImput||s.parent.validate(!0),s.clearHidden(),s.parent.unselect(),s.input.style.background=s.parent.colors.back,s.input.style.borderColor=s.parent.colors.border,s.parent.isEdit=!1,s.input=null,s.parent=null,s.str="",s.firstImput=!0)},setInput:function(t,i){s.clearInput(),s.input=t,s.parent=i,s.input.style.background=s.parent.colors.backoff,s.input.style.borderColor=s.parent.colors.select,s.str=s.input.textContent,s.setHidden()},keydown:function(t){if(null===s.parent)return;let i=t.which;t.shiftKey,s.firstImput=!1,s.hasFocus&&(window.focus(),s.hiddenImput.focus()),s.parent.isEdit=!0,13===i?s.clearInput():s.input.isNum?t.keyCode>47&&t.keyCode<58||t.keyCode>95&&t.keyCode<106||190===t.keyCode||110===t.keyCode||8===t.keyCode||109===t.keyCode?s.hiddenImput.readOnly=!1:s.hiddenImput.readOnly=!0:s.hiddenImput.readOnly=!1},keyup:function(t){null!==s.parent&&(s.str=s.hiddenImput.value,s.parent.allEqual?s.parent.sameStr(s.str):s.input.textContent=s.str,s.cursorId=s.hiddenImput.selectionStart,s.inputRange=[s.hiddenImput.selectionStart,s.hiddenImput.selectionEnd],s.selectParent(),s.parent.validate())},loop:function(){s.isLoop&&requestAnimationFrame(s.loop),s.update()},update:function(){let t=s.listens.length;for(;t--;)s.listens[t].listening()},removeListen:function(t){let i=s.listens.indexOf(t);-1!==i&&s.listens.splice(i,1),0===s.listens.length&&(s.isLoop=!1)},addListen:function(t){return-1===s.listens.indexOf(t)&&(s.listens.push(t),s.isLoop||(s.isLoop=!0,s.loop()),!0)}},e=s,h={transition:.2,frag:document.createDocumentFragment(),colorRing:null,joystick_0:null,joystick_1:null,circular:null,knob:null,pad2d:null,svgns:"http://www.w3.org/2000/svg",links:"http://www.w3.org/1999/xlink",htmls:"http://www.w3.org/1999/xhtml",DOM_SIZE:["height","width","top","left","bottom","right","margin-left","margin-right","margin-top","margin-bottom"],SVG_TYPE_D:["pattern","defs","transform","stop","animate","radialGradient","linearGradient","animateMotion","use","filter","feColorMatrix"],SVG_TYPE_G:["svg","rect","circle","path","polygon","text","g","line","foreignObject"],PI:Math.PI,TwoPI:2*Math.PI,pi90:.5*Math.PI,pi60:Math.PI/3,torad:Math.PI/180,todeg:180/Math.PI,clamp:function(t,i,s){return t=(t=t<i?i:t)>s?s:t},size:{w:240,h:20,p:30,s:8},defineColor:function(t,i=h.colors){let s={...i},e=["fontFamily","fontWeight","fontShadow","fontSize"],o=!1;t.font&&(t.fontFamily=t.font),t.shadow&&(t.fontShadow=t.shadow),t.weight&&(t.fontWeight=t.weight),t.fontColor&&(t.text=t.fontColor),t.color&&(t.text=t.color),t.text&&(s.text=t.text,t.fontColor||t.color||(s.title=h.ColorLuma(t.text,-.25),s.titleoff=h.ColorLuma(t.text,-.5)),s.textOver=h.ColorLuma(t.text,.25),s.textSelect=h.ColorLuma(t.text,.5)),t.button&&(s.button=t.button,s.border=h.ColorLuma(t.button,.1),s.overoff=h.ColorLuma(t.button,.2)),t.select&&(s.select=t.select,s.over=h.ColorLuma(t.select,-.1)),t.itemBg&&(t.back=t.itemBg),t.back&&(s.back=t.back,s.backoff=h.ColorLuma(t.back,-.1)),t.fontSelect&&(s.textSelect=t.fontSelect),t.groupBorder&&(s.gborder=t.groupBorder),t.transparent&&(t.bg="none"),t.bg&&(s.background=s.backgroundOver=t.bg),t.bgOver&&(s.backgroundOver=t.bgOver);for(let i in s)t[i]&&(s[i]=t[i]);for(let i in t)-1!==e.indexOf(i)&&(o=!0);return o&&h.defineText(s),s},colors:{content:"none",background:"rgba(50,50,50,0.3)",backgroundOver:"rgba(50,50,50,0.4)",title:"#CCC",titleoff:"#BBB",text:"#DDD",textOver:"#EEE",textSelect:"#FFF",back:"rgba(0,0,0,0.2)",backoff:"rgba(0,0,0,0.3)",border:"#4c4c4c",borderSize:1,gborder:"none",button:"#3c3c3c",overoff:"#5c5c5c",over:"#024699",select:"#308AFF",action:"#FF3300",fontFamily:"Consolas,monaco,monospace",fontWeight:"normal",fontShadow:"#000",fontSize:12,radius:4,hide:"rgba(0,0,0,0)"},css:{basic:"position:absolute; pointer-events:none; box-sizing:border-box; margin:0; padding:0; overflow:hidden; -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select:none;",button:"display:flex; justify-content:center; align-items:center; text-align:center;"},svgs:{group:"M 7 7 L 7 8 8 8 8 7 7 7 M 5 7 L 5 8 6 8 6 7 5 7 M 3 7 L 3 8 4 8 4 7 3 7 M 7 5 L 7 6 8 6 8 5 7 5 M 6 6 L 6 5 5 5 5 6 6 6 M 7 3 L 7 4 8 4 8 3 7 3 M 6 4 L 6 3 5 3 5 4 6 4 M 3 5 L 3 6 4 6 4 5 3 5 M 3 3 L 3 4 4 4 4 3 3 3 Z",arrow:"M 3 8 L 8 5 3 2 3 8 Z",arrowDown:"M 5 8 L 8 3 2 3 5 8 Z",arrowUp:"M 5 2 L 2 7 8 7 5 2 Z",solid:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 Z",body:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 M 5 4 L 4 5 4 10 9 10 10 9 10 4 5 4 Z",vehicle:"M 13 6 L 11 1 3 1 1 6 1 13 3 13 3 11 11 11 11 13 13 13 13 6 M 2.4 6 L 4 2 10 2 11.6 6 2.4 6 M 12 8 L 12 10 10 10 10 8 12 8 M 4 8 L 4 10 2 10 2 8 4 8 Z",articulation:"M 13 9 L 12 9 9 2 9 1 5 1 5 2 2 9 1 9 1 13 5 13 5 9 4 9 6 5 8 5 10 9 9 9 9 13 13 13 13 9 Z",character:"M 13 4 L 12 3 9 4 5 4 2 3 1 4 5 6 5 8 4 13 6 13 7 9 8 13 10 13 9 8 9 6 13 4 M 6 1 L 6 3 8 3 8 1 6 1 Z",terrain:"M 13 8 L 12 7 Q 9.06 -3.67 5.95 4.85 4.04 3.27 2 7 L 1 8 7 13 13 8 M 3 8 Q 3.78 5.420 5.4 6.6 5.20 7.25 5 8 L 7 8 Q 8.39 -0.16 11 8 L 7 11 3 8 Z",joint:"M 7.7 7.7 Q 8 7.45 8 7 8 6.6 7.7 6.3 7.45 6 7 6 6.6 6 6.3 6.3 6 6.6 6 7 6 7.45 6.3 7.7 6.6 8 7 8 7.45 8 7.7 7.7 M 3.35 8.65 L 1 11 3 13 5.35 10.65 Q 6.1 11 7 11 8.28 11 9.25 10.25 L 7.8 8.8 Q 7.45 9 7 9 6.15 9 5.55 8.4 5 7.85 5 7 5 6.54 5.15 6.15 L 3.7 4.7 Q 3 5.712 3 7 3 7.9 3.35 8.65 M 10.25 9.25 Q 11 8.28 11 7 11 6.1 10.65 5.35 L 13 3 11 1 8.65 3.35 Q 7.9 3 7 3 5.7 3 4.7 3.7 L 6.15 5.15 Q 6.54 5 7 5 7.85 5 8.4 5.55 9 6.15 9 7 9 7.45 8.8 7.8 L 10.25 9.25 Z",ray:"M 9 11 L 5 11 5 12 9 12 9 11 M 12 5 L 11 5 11 9 12 9 12 5 M 11.5 10 Q 10.9 10 10.45 10.45 10 10.9 10 11.5 10 12.2 10.45 12.55 10.9 13 11.5 13 12.2 13 12.55 12.55 13 12.2 13 11.5 13 10.9 12.55 10.45 12.2 10 11.5 10 M 9 10 L 10 9 2 1 1 2 9 10 Z",collision:"M 11 12 L 13 10 10 7 13 4 11 2 7.5 5.5 9 7 7.5 8.5 11 12 M 3 2 L 1 4 4 7 1 10 3 12 8 7 3 2 Z",map:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",material:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",texture:"M 13 4 L 13 1 1 1 1 4 5 4 5 13 9 13 9 4 13 4 Z",object:"M 10 1 L 7 4 4 1 1 1 1 13 4 13 4 5 7 8 10 5 10 13 13 13 13 1 10 1 Z",none:"M 9 5 L 5 5 5 9 9 9 9 5 Z",cursor:"M 4 7 L 1 10 1 12 2 13 4 13 7 10 9 14 14 0 0 5 4 7 Z"},getImput:function(){return!!e.input},setStyle:function(t){for(var i in t)h.colors[i]&&(h.colors[i]=t[i]);h.setText()},defineText:function(t){h.setText(t.fontSize,t.text,t.fontFamily,t.fontShadow,t.fontWeight)},setText:function(t,i,s,e,o){let n=h.colors;void 0===s&&(s=n.fontFamily),void 0===t&&(t=n.fontSize),void 0===e&&(e=n.fontShadow),void 0===o&&(o=n.fontWeight);h.css.txt=h.css.basic+"display:flex; justify-content:left; align-items:center; text-align:left;font-family:"+s+"; font-weight:"+o+"; font-size:"+t+"px; color:"+n.text+"; padding:0px 10px; left:0; top:2px; height:16px; width:100px; overflow:hidden; white-space: nowrap;","none"!==e&&(h.css.txt+=" text-shadow: 1px 1px 1px "+e+";"),h.css.txtselect=h.css.txt+"padding:0px 4px; border:1px dashed "+n.border+";",h.css.item=h.css.txt+" position:relative; margin-bottom:1px; display:block; padding:2px 4px;"},cloneCss:function(){return{...h.css}},clone:function(t){return t.cloneNode(!0)},setSvg:function(t,i,s,e,h){-1===e?t.setAttributeNS(null,i,s):void 0!==h?t.childNodes[e||0].childNodes[h||0].setAttributeNS(null,i,s):t.childNodes[e||0].setAttributeNS(null,i,s)},setCss:function(t,i){for(let s in i)-1!==h.DOM_SIZE.indexOf(s)?t.style[s]=i[s]+"px":t.style[s]=i[s]},set:function(t,i){for(let s in i)"txt"===s&&(t.textContent=i[s]),"link"===s?t.setAttributeNS(h.links,"xlink:href",i[s]):t.setAttributeNS(null,s,i[s])},get:function(t,i){if(void 0===i)return t;if(!isNaN(i))return t.childNodes[i];if(i instanceof Array){if(2===i.length)return t.childNodes[i[0]].childNodes[i[1]];if(3===i.length)return t.childNodes[i[0]].childNodes[i[1]].childNodes[i[2]]}},dom:function(t,i,s,e,o){return t=t||"div",-1!==h.SVG_TYPE_D.indexOf(t)||-1!==h.SVG_TYPE_G.indexOf(t)?"svg"===t?(e=document.createElementNS(h.svgns,"svg"),h.set(e,s)):(void 0===e&&(e=document.createElementNS(h.svgns,"svg")),h.addAttributes(e,t,s,o)):e=void 0===e?document.createElementNS(h.htmls,t):e.appendChild(document.createElementNS(h.htmls,t)),i&&(e.style.cssText=i),void 0===o?e:e.childNodes[o||0]},addAttributes:function(t,i,s,e){let o=document.createElementNS(h.svgns,i);return h.set(o,s),h.get(t,e).appendChild(o),-1!==h.SVG_TYPE_G.indexOf(i)&&(o.style.pointerEvents="none"),o},clear:function(t){for(h.purge(t);t.firstChild;)t.firstChild.firstChild&&h.clear(t.firstChild),t.removeChild(t.firstChild)},purge:function(t){let i,s,e=t.attributes;if(e)for(i=e.length;i--;)s=e[i].name,"function"==typeof t[s]&&(t[s]=null);if(e=t.childNodes,e)for(i=e.length;i--;)h.purge(t.childNodes[i])},addSVGGlowEffect:function(){if(null!==document.getElementById("UILGlow"))return;let t=h.initUILEffects(),i=h.addAttributes(t,"filter",{id:"UILGlow",x:"-20%",y:"-20%",width:"140%",height:"140%"});h.addAttributes(i,"feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"uilBlur"});let s=h.addAttributes(i,"feMerge",{});for(let t=0;t<=3;t++)h.addAttributes(s,"feMergeNode",{in:"uilBlur"});h.addAttributes(s,"feMergeNode",{in:"SourceGraphic"})},initUILEffects:function(){let t=document.getElementById("UILSVGEffects");return null===t&&(t=h.dom("svg",void 0,{id:"UILSVGEffects",width:"0",height:"0"}),document.body.appendChild(t)),t},ColorLuma:function(t,i){"n"===t&&(t="#000"),(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),i=i||0;let s,e,h="#";for(e=0;e<3;e++)s=parseInt(t.substr(2*e,2),16),s=Math.round(Math.min(Math.max(0,s+s*i),255)).toString(16),h+=("00"+s).substr(s.length);return h},findDeepInver:function(t){return.3*t[0]+.59*t[1]+.11*t[2]<=.6},lerpColor:function(t,i,s){let e={};for(let h=0;h<3;h++)e[h]=t[h]+(i[h]-t[h])*s;return e},hexToHtml:function(t){return"#"+("000000"+(t=void 0===t?0:t).toString(16)).substr(-6)},htmlToHex:function(t){return t.toUpperCase().replace("#","0x")},u255:function(t,i){return parseInt(t.substring(i,i+2),16)/255},u16:function(t,i){return parseInt(t.substring(i,i+1),16)/15},unpack:function(t){return 7==t.length?[h.u255(t,1),h.u255(t,3),h.u255(t,5)]:4==t.length?[h.u16(t,1),h.u16(t,2),h.u16(t,3)]:void 0},p255:function(t){let i=Math.round(255*t).toString(16);return i.length<2&&(i="0"+i),i},pack:function(t){return"#"+h.p255(t[0])+h.p255(t[1])+h.p255(t[2])},htmlRgb:function(t){return"rgb("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+")"},pad:function(t){return 1==t.length&&(t="0"+t),t},rgbToHex:function(t){let i=Math.round(255*t[0]).toString(16),s=Math.round(255*t[1]).toString(16),e=Math.round(255*t[2]).toString(16);return"#"+h.pad(i)+h.pad(s)+h.pad(e)},hueToRgb:function(t,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(i-t)*s:s<.5?i:s<2/3?t+6*(i-t)*(2/3-s):t},rgbToHsl:function(t){let i=t[0],s=t[1],e=t[2],h=Math.min(i,s,e),o=Math.max(i,s,e),n=o-h,r=0,l=0,a=(h+o)/2;return a>0&&a<1&&(l=n/(a<.5?2*a:2-2*a)),n>0&&(o==i&&o!=s&&(r+=(s-e)/n),o==s&&o!=e&&(r+=2+(e-i)/n),o==e&&o!=i&&(r+=4+(i-s)/n),r/=6),[r,l,a]},hslToRgb:function(t){let i,s,e=t[0],o=t[1],n=t[2];return 0===o?[n,n,n]:(s=n<=.5?n*(o+1):n+o-n*o,i=2*n-s,[h.hueToRgb(i,s,e+.33333),h.hueToRgb(i,s,e),h.hueToRgb(i,s,e-.33333)])},makeGradiant:function(t,i,s,e){h.dom(t,null,i,s,0);let o,n=s.childNodes[0].childNodes.length-1;for(let t=0;t<e.length;t++)o=e[t],h.dom("stop",null,{offset:o[0]+"%","stop-color":o[1],"stop-opacity":o[2]},s,[0,n])},makePad:function(t){let i=256,s=h.dom("svg",h.css.basic+"position:relative;",{viewBox:"0 0 256 256",width:i,height:i,preserveAspectRatio:"none"}),e=200,n=28;o.dom("rect","",{x:n,y:n,width:e,height:e,fill:h.colors.back},s),o.dom("rect","",{x:38,y:38,width:180,height:180,fill:h.colors.button},s),o.dom("line","",{x1:38,y1:128,x2:218,y2:128,stroke:h.colors.back,"stroke-width":2},s),o.dom("line","",{x1:128,x2:128,y1:38,y2:218,stroke:h.colors.back,"stroke-width":2},s),o.dom("circle","",{cx:128,cy:128,r:5,stroke:h.colors.text,"stroke-width":5,fill:"none"},s),h.pad2d=s},makeKnob:function(t){let i=128,s=h.dom("svg",h.css.basic+"position:relative;",{viewBox:"0 0 128 "+i,width:i,height:i,preserveAspectRatio:"none"});h.dom("circle","",{cx:64,cy:64,r:34,fill:h.colors.button,stroke:"rgba(0,0,0,0.3)","stroke-width":8},s),h.dom("path","",{d:"",stroke:h.colors.text,"stroke-width":4,fill:"none","stroke-linecap":"round"},s),h.dom("circle","",{cx:64,cy:64,r:41,stroke:"rgba(0,0,0,0.1)","stroke-width":7,fill:"none"},s),h.dom("path","",{d:"",stroke:"rgba(255,255,255,0.3)","stroke-width":2,fill:"none","stroke-linecap":"round","stroke-opacity":.5},s),h.knob=s},makeCircular:function(t){let i=128,s=h.dom("svg",h.css.basic+"position:relative;",{viewBox:"0 0 128 "+i,width:i,height:i,preserveAspectRatio:"none"});h.dom("circle","",{cx:64,cy:64,r:40,stroke:"rgba(0,0,0,0.1)","stroke-width":10,fill:"none"},s),h.dom("path","",{d:"",stroke:h.colors.text,"stroke-width":7,fill:"none","stroke-linecap":"butt"},s),h.circular=s},makeJoystick:function(t){let i,s=128,e=Math.floor(49),o=Math.floor(.6*e),n=h.dom("svg",h.css.basic+"position:relative;",{viewBox:"0 0 128 "+s,width:s,height:s,preserveAspectRatio:"none"});if(h.dom("defs",null,{},n),h.dom("g",null,{},n),0===t){i=[[40,"rgb(0,0,0)",.3],[80,"rgb(0,0,0)",0],[90,"rgb(50,50,50)",.4],[100,"rgb(50,50,50)",0]],h.makeGradiant("radialGradient",{id:"grad",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,i),i=[[60,"rgb(0,0,0)",.5],[100,"rgb(0,0,0)",0]],h.makeGradiant("radialGradient",{id:"gradS",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,i);let t=["rgb(40,40,40)","rgb(48,48,48)","rgb(30,30,30)"],s=["rgb(1,90,197)","rgb(3,95,207)","rgb(0,65,167)"];i=[[30,t[0],1],[60,t[1],1],[80,t[1],1],[100,t[2],1]],h.makeGradiant("radialGradient",{id:"gradIn",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,i),i=[[30,s[0],1],[60,s[1],1],[80,s[1],1],[100,s[2],1]],h.makeGradiant("radialGradient",{id:"gradIn2",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,i),h.dom("circle","",{cx:64,cy:64,r:e,fill:"url(#grad)"},n),h.dom("circle","",{cx:69,cy:74,r:o+10,fill:"url(#gradS)"},n),h.dom("circle","",{cx:64,cy:64,r:o,fill:"url(#gradIn)"},n),h.joystick_0=n}else i=[[69,"rgb(0,0,0)",0],[70,"rgb(0,0,0)",.3],[100,"rgb(0,0,0)",0]],h.makeGradiant("radialGradient",{id:"gradX",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},n,i),h.dom("circle","",{cx:64,cy:64,r:e,fill:"none",stroke:"rgba(100,100,100,0.25)","stroke-width":"4"},n),h.dom("circle","",{cx:64,cy:64,r:o+14,fill:"url(#gradX)"},n),h.dom("circle","",{cx:64,cy:64,r:o,fill:"none",stroke:"rgb(100,100,100)","stroke-width":"4"},n),h.joystick_1=n},makeColorRing:function(){let t=256,i=h.dom("svg",h.css.basic+"position:relative;",{viewBox:"0 0 256 "+t,width:t,height:t,preserveAspectRatio:"none"});h.dom("defs",null,{},i),h.dom("g",null,{},i);let s,e,o,n,r,l,a,c,d,u=128,p=8/113/24*Math.PI,m=0,g=[];for(l=0;l<=24;++l){if(o=l/24,n=o*h.TwoPI,s=.5*(m+n),e=1/Math.cos(.5*(n-m)),r=[Math.sin(m),-Math.cos(m),Math.sin(s)*e,-Math.cos(s)*e,Math.sin(n),-Math.cos(n)],g[1]=h.rgbToHex(h.hslToRgb([o,1,.5])),l>0){for(a=6;a--;)r[a]=(113*r[a]+u).toFixed(2);c=" M"+r[0]+" "+r[1]+" Q"+r[2]+" "+r[3]+" "+r[4]+" "+r[5],d=[[0,g[0],1],[100,g[1],1]],h.makeGradiant("linearGradient",{id:"G"+l,x1:r[0],y1:r[1],x2:r[4],y2:r[5],gradientUnits:"userSpaceOnUse"},i,d),h.dom("path","",{d:c,"stroke-width":30,stroke:"url(#G"+l+")","stroke-linecap":"butt"},i,1)}m=n-p,g[0]=g[1]}d=[[0,"#FFFFFF",1],[50,"#FFFFFF",0],[50,"#000000",0],[100,"#000000",1]],h.makeGradiant("linearGradient",{id:"GL0",x1:0,y1:u-84.9,x2:0,y2:212.9,gradientUnits:"userSpaceOnUse"},i,d),d=[[0,"#7f7f7f",1],[50,"#7f7f7f",.5],[100,"#7f7f7f",0]],h.makeGradiant("linearGradient",{id:"GL1",x1:78.95,y1:0,x2:226,y2:0,gradientUnits:"userSpaceOnUse"},i,d),h.dom("g",null,{"transform-origin":"128px 128px",transform:"rotate(0)"},i),h.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"red"},i,2),h.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL1)","stroke-width":1,stroke:"url(#GL1)"},i,2),h.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL0)","stroke-width":1,stroke:"url(#GL0)"},i,2),h.dom("path","",{d:"M 255.75 136.5 Q 256 132.3 256 128 256 123.7 255.75 119.5 L 241 128 255.75 136.5 Z",fill:"none","stroke-width":2,stroke:"#000"},i,2),h.dom("circle","",{cx:128,cy:128,r:6,"stroke-width":2,stroke:"#000",fill:"none"},i),h.colorRing=i},icon:function(t,i,s){s=s||40;let e=["<svg xmlns='"+h.svgns+"' version='1.1' xmlns:xlink='"+h.htmls+"' style='pointer-events:none;' preserveAspectRatio='xMinYMax meet' x='0px' y='0px' width='"+s+"px' height='"+s+"px' viewBox='0 0 256 256'><g>"];switch(t){case"logo":e[1]="<path id='logoin' fill='"+i+"' stroke='none' d='"+h.logoFill_d+"'/>";break;case"donate":e[1]="<path id='logoin' fill='"+i+"' stroke='none' d='"+h.logo_donate+"'/>";break;case"neo":e[1]="<path id='logoin' fill='"+i+"' stroke='none' d='"+h.logo_neo+"'/>";break;case"github":e[1]="<path id='logoin' fill='"+i+"' stroke='none' d='"+h.logo_github+"'/>";break;case"save":e[1]="<path stroke='"+i+"' stroke-width='4' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 26.125 17 L 20 22.95 14.05 17 M 20 9.95 L 20 22.95'/><path stroke='"+i,e[1]+="' stroke-width='2.5' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 32.6 23 L 32.6 25.5 Q 32.6 28.5 29.6 28.5 L 10.6 28.5 Q 7.6 28.5 7.6 25.5 L 7.6 23'/>"}return e[2]="</g></svg>",e.join("\n")},logoFill_d:"\n\t\tM 171 150.75 L 171 33.25 155.5 33.25 155.5 150.75 Q 155.5 162.2 147.45 170.2 139.45 178.25 128 178.25 116.6 178.25 108.55 170.2 100.5 162.2 100.5 150.75 \n\t\tL 100.5 33.25 85 33.25 85 150.75 Q 85 168.65 97.55 181.15 110.15 193.75 128 193.75 145.9 193.75 158.4 181.15 171 168.65 171 150.75 \n\t\tM 200 33.25 L 184 33.25 184 150.8 Q 184 174.1 167.6 190.4 151.3 206.8 128 206.8 104.75 206.8 88.3 190.4 72 174.1 72 150.8 L 72 33.25 56 33.25 56 150.75 \n\t\tQ 56 180.55 77.05 201.6 98.2 222.75 128 222.75 157.8 222.75 178.9 201.6 200 180.55 200 150.75 L 200 33.25 Z\n\t\t",logo_github:"\n\t\tM 180.5 70 Q 186.3 82.4 181.55 96.55 196.5 111.5 189.7 140.65 183.65 168.35 146 172.7 152.5 178.7 152.55 185.9 L 152.55 218.15 Q 152.84 224.56 159.15 223.3 \n\t\t159.21 223.3 159.25 223.3 181.14 216.25 198.7 198.7 228 169.4 228 128 228 86.6 198.7 57.3 169.4 28 128 28 86.6 28 57.3 57.3 28 86.6 28 128 28 169.4 57.3 198.7 74.85 \n\t\t216.25 96.75 223.3 96.78 223.3 96.8 223.3 103.16 224.54 103.45 218.15 L 103.45 200 Q 82.97 203.1 75.1 196.35 69.85 191.65 68.4 185.45 64.27 177.055 59.4 174.15 49.20 \n\t\t166.87 60.8 167.8 69.85 169.61 75.7 180 81.13 188.09 90 188.55 98.18 188.86 103.45 185.9 103.49 178.67 110 172.7 72.33 168.33 66.3 140.65 59.48 111.49 74.45 96.55 69.7 \n\t\t82.41 75.5 70 84.87 68.74 103.15 80 115.125 76.635 128 76.85 140.85 76.65 152.85 80 171.1 68.75 180.5 70 Z\n\t\t",logo_neo:"\n\t\tM 219 52 L 206 52 206 166 Q 206 183.4 193.75 195.65 181.4 208 164 208 146.6 208 134.35 195.65 122 183.4 122 166 L 122 90 Q 122 77.6 113.15 68.85 104.4 60 92 60 79.55 \n\t\t60 70.75 68.85 62 77.6 62 90 L 62 204 75 204 75 90 Q 75 83 79.95 78 84.95 73 92 73 99 73 104 78 109 83 109 90 L 109 166 Q 109 188.8 125.15 204.85 141.2 221 164 221 \n\t\t186.75 221 202.95 204.85 219 188.8 219 166 L 219 52 M 194 52 L 181 52 181 166 Q 181 173 176.05 178 171.05 183 164 183 157 183 152 178 147 173 147 166 L 147 90 Q 147 \n\t\t67.2 130.85 51.15 114.8 35 92 35 69.25 35 53.05 51.15 37 67.2 37 90 L 37 204 50 204 50 90 Q 50 72.6 62.25 60.35 74.6 48 92 48 109.4 48 121.65 60.35 134 72.6 134 90 L \n\t\t134 166 Q 134 178.4 142.85 187.15 151.6 196 164 196 176.45 196 185.25 187.15 194 178.4 194 166 L 194 52 Z\n\t\t",logo_donate:"\n\t\tM 171.3 80.3 Q 179.5 62.15 171.3 45.8 164.1 32.5 141.35 30.1 L 94.35 30.1 Q 89.35 30.4 88.3 35.15 L 70.5 148.05 Q 70.2 152.5 73.7 152.6 L 100.95 152.6 107 111.6 Q 108.75 \n\t\t106.55 112.6 106.45 130.45 108.05 145.3 103.9 163.35 98.75 171.3 80.3 M 179.8 71.5 Q 178.6 79.75 174.9 87.85 168.45 102.9 151.9 109.15 140.65 113.95 117.55 113 113.15 \n\t\t112.75 111 117.45 L 102.7 169.95 Q 102.45 173.8 105.5 173.85 L 128.95 173.85 Q 132.2 174.2 133.35 169.65 L 138.3 139.95 Q 139.75 135.6 143.1 135.5 146.6 135.75 150.6 135.65 \n\t\t154.55 135.5 157.35 135.1 160.15 134.7 166.75 132.35 181.35 127.4 187.9 111.2 194.25 95.75 189.5 81.95 186.75 74.85 179.8 71.5 M 103.5 209.9 Q 103.5 202.85 99.7 198.85 95.95 \n\t\t194.75 89.4 194.75 82.8 194.75 79.05 198.85 75.3 202.9 75.3 209.9 75.3 216.85 79.05 220.95 82.8 225.05 89.4 225.05 95.95 225.05 99.7 221 103.5 216.95 103.5 209.9 M 95.45 205.5 \n\t\tQ 95.95 207.3 95.95 209.9 95.95 212.65 95.45 214.35 94.95 216 94 217.3 93.1 218.45 91.9 219 90.7 219.55 89.4 219.55 88.15 219.55 86.95 219.05 85.75 218.55 84.8 217.3 83.9 216.15 \n\t\t83.4 214.35 82.85 212.6 82.85 209.9 82.85 207.3 83.4 205.45 83.95 203.55 84.85 202.45 85.9 201.2 86.95 200.75 88.05 200.25 89.4 200.25 90.7 200.25 91.85 200.8 93.05 201.3 94 202.5 \n\t\t94.9 203.65 95.45 205.5 M 153.3 195.35 L 145.3 195.35 135.5 224.45 142.8 224.45 144.6 218.5 153.75 218.5 155.6 224.45 163.1 224.45 153.3 195.35 M 152.15 213.25 L 146.25 213.25 \n\t\t149.2 203.65 152.15 213.25 M 116.75 195.35 L 107.8 195.35 107.8 224.45 114.5 224.45 114.5 204.2 125.7 224.45 132.75 224.45 132.75 195.35 126.05 195.35 126.05 212.05 116.75 195.35 M \n\t\t66.5 197.65 Q 64.15 196.15 61.45 195.75 58.8 195.35 55.75 195.35 L 46.7 195.35 46.7 224.45 55.8 224.45 Q 58.8 224.45 61.5 224.05 64.15 223.6 66.4 222.15 69.15 220.45 70.9 217.2 \n\t\t72.7 214 72.7 209.95 72.7 205.7 71 202.6 69.35 199.5 66.5 197.65 M 64.2 205 Q 65.2 207 65.2 209.9 65.2 212.75 64.25 214.75 63.3 216.75 61.5 217.85 60 218.85 58.3 218.9 56.6 219 \n\t\t54.15 219 L 54 219 54 200.8 54.15 200.8 Q 56.4 200.8 58.05 200.9 59.7 200.95 61.15 201.75 63.2 202.95 64.2 205 M 210.2 195.35 L 190.5 195.35 190.5 224.45 210.2 224.45 210.2 218.9 \n\t\t197.75 218.9 197.75 211.55 209.2 211.55 209.2 206 197.75 206 197.75 200.9 210.2 200.9 210.2 195.35 M 187.5 195.35 L 163 195.35 163 200.9 171.6 200.9 171.6 224.45 178.9 224.45 178.9 \n\t\t200.9 187.5 200.9 187.5 195.35 Z\n\t\t"};h.setText();const o=h;class n{constructor(t=0,i=0){this.x=t,this.y=i}set(t,i){return this.x=t,this.y=i,this}divide(t){return this.x/=t.x,this.y/=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}angle(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}addScalar(t){return this.x+=t,this.y+=t,this}negate(){return this.x*=-1,this.y*=-1,this}neg(){return this.x=-1,this.y=-1,this}isZero(){return 0===this.x&&0===this.y}copy(t){return this.x=t.x,this.y=t.y,this}equals(t){return t.x===this.x&&t.y===this.y}nearEquals(t,i){return t.x.toFixed(i)===this.x.toFixed(i)&&t.y.toFixed(i)===this.y.toFixed(i)}lerp(t,i){return null===t?(this.x-=this.x*i,this.y-=this.y*i):(this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i),this}}class r{constructor(t={}){this.lock=t.lock||!1,this.neverlock=!1,this.isSpace=t.isSpace||!1,this.main=t.main||null,this.isUI=t.isUI||!1,this.group=t.group||null,this.isListen=!1,this.isSelectable=void 0!==t.selectable&&t.selectable,this.unselectable=void 0!==t.unselect?t.unselect:this.isSelectable,this.ontop=!!t.ontop&&t.ontop,this.css=this.main?this.main.css:o.css,this.colors=o.defineColor(t,this.main?this.group?this.group.colors:this.main.colors:o.colors),this.svgs=o.svgs,this.zone={x:0,y:0,w:0,h:0},this.local=(new n).neg(),this.isCanvasOnly=!1,this.isSelect=!1,this.p=void 0!==t.p?t.p:o.size.p,this.w=this.isUI?this.main.size.w:o.size.w,void 0!==t.w&&(this.w=t.w),this.h=this.isUI?this.main.size.h:o.size.h,void 0!==t.h&&(this.h=t.h),this.isSpace?this.lock=!0:this.h=this.h<11?11:this.h,this.fw=t.fw||0,this.autoWidth=t.auto||!0,this.isOpen=!1,this.radius=t.radius||this.colors.radius,this.transition=t.transition||o.transition,this.isNumber=!1,this.noNeg=t.noNeg||!1,this.allEqual=t.allEqual||!1,this.mono=!1,this.isEdit=!1,this.simple=t.simple||!1,this.simple&&(this.sa=0),this.setSize(this.w),void 0!==t.sa&&(this.sa=t.sa),void 0!==t.sb&&(this.sb=t.sb),this.simple&&(this.sb=this.w-this.sa),this.sc=void 0===t.sc?47:t.sc,this.objectLink=null,this.isSend=!1,this.val=null,this.txt=t.name||"",this.name=t.rename||this.txt,this.target=t.target||null,this.callback=void 0===t.callback?null:t.callback,this.endCallback=null,this.openCallback=void 0===t.openCallback?null:t.openCallback,this.closeCallback=void 0===t.closeCallback?null:t.closeCallback,null===this.callback&&this.isUI&&null!==this.main.callback&&(this.callback=this.group?this.group.callback:this.main.callback),this.c=[],this.s=[],this.useFlex=!!this.isUI&&this.main.useFlex;let i=this.useFlex?"disply:flex; justify-content:center; align-items:center; text-align:center; flex: 1 100%;":"float:left;";if(this.c[0]=o.dom("div",this.css.basic+i+"position:relative; height:20px;"),this.s[0]=this.c[0].style,this.margin=t.margin||1,this.isUI&&this.margin&&(this.s[0].boxSizing="content-box",.5*this.margin===Math.floor(.5*this.margin)?(this.s[0].borderTop=.5*this.margin+"px solid transparent",this.s[0].borderBottom=.5*this.margin+"px solid transparent"):this.s[0].borderBottom=this.margin+"px solid transparent"),this.simple||(this.c[1]=o.dom("div",this.css.txt),this.s[1]=this.c[1].style,this.c[1].textContent=this.name,this.s[1].color=this.lock?this.colors.titleoff:this.colors.title),t.pos){this.s[0].position="absolute";for(let i in t.pos)this.s[0][i]=t.pos[i];this.mono=!0}t.css&&(this.s[0].cssText=t.css)}init(){this.zone.h=this.h,this.zone.w=this.w;let t=this.s,i=this.c;t[0].height=this.h+"px",this.isUI&&(t[0].background=this.colors.background),!this.autoWidth&&this.useFlex?(t[0].flex="1 0 auto",t[0].minWidth=this.minw+"px",t[0].textAlign="center"):this.isUI&&(t[0].width="100%"),void 0!==i[1]&&this.autoWidth&&(t[1]=i[1].style,t[1].height=this.h-4+"px",t[1].lineHeight=this.h-8+"px");let s=o.frag;for(let e=1,h=i.length;e!==h;e++)void 0!==i[e]&&(s.appendChild(i[e]),t[e]=i[e].style);let h=null!==this.target?this.target:this.isUI?this.main.inner:document.body;this.ontop?h.insertAdjacentElement("afterbegin",i[0]):h.appendChild(i[0]),i[0].appendChild(s),this.rSize(),this.isUI||(this.c[0].style.pointerEvents="auto",e.add(this)),this.baseH&&this.transition&&this.isUI&&(this.c[0].style.transition="height "+this.transition+"s ease-out")}dom(t,i,s,e,h){return o.dom(t,i,s,e,h)}setSvg(t,i,s,e,h){o.setSvg(t,i,s,e,h)}setCss(t,i){o.setCss(t,i)}clamp(t,i,s){return o.clamp(t,i,s)}getColorRing(){return o.colorRing||o.makeColorRing(),o.clone(o.colorRing)}getJoystick(t){return o["joystick_"+t]||o.makeJoystick(t),o.clone(o["joystick_"+t])}getCircular(t){return o.circular||o.makeCircular(t),o.clone(o.circular)}getKnob(t){return o.knob||o.makeKnob(t),o.clone(o.knob)}getPad2d(t){return o.pad2d||o.makePad(t),o.clone(o.pad2d)}cursor(t){e.cursor(t)}update(){}reset(){}getDom(){return this.c[0]}uiout(){this.lock||this.s&&(this.s[0].background=this.colors.background)}uiover(){this.lock||this.s&&(this.s[0].background=this.colors.backgroundOver)}rename(t){void 0!==this.c[1]&&(this.c[1].textContent=t)}listen(){return this.isListen=e.addListen(this),this}listening(){null!==this.objectLink&&(this.isSend||this.isEdit||this.setValue(this.objectLink[this.val]))}setValue(t){this.isNumber?this.value=this.numValue(t):this.value=t,this.update()}onChange(t){if(!this.isSpace)return this.callback=t||null,this}onFinishChange(t){if(!this.isSpace)return this.callback=null,this.endCallback=t,this}onOpen(t){return this.openCallback=t,this}onClose(t){return this.closeCallback=t,this}send(t){(t=t||this.value)instanceof Array&&1===t.length&&(t=t[0]),this.isSend=!0,null!==this.objectLink&&(this.objectLink[this.val]=t),this.callback&&this.callback(t,this.val),this.isSend=!1}sendEnd(t){(t=t||this.value)instanceof Array&&1===t.length&&(t=t[0]),this.endCallback&&this.endCallback(t),null!==this.objectLink&&(this.objectLink[this.val]=t)}dispose(){this.isListen&&e.removeListen(this),o.clear(this.c[0]),null!==this.target?null!==this.group?this.group.clearOne(this):this.target.removeChild(this.c[0]):this.isUI?this.main.clearOne(this):document.body.removeChild(this.c[0]),this.isUI||e.remove(this),this.c=null,this.s=null,this.callback=null,this.target=null,this.isListen=!1}clear(){}getWidth(){let t=e.getWidth(this);t&&(this.w=t)}setSize(t){if(this.autoWidth)if(this.w=t,this.simple)this.sb=this.w-this.sa;else{let t=this.w*(this.p/100);this.sa=Math.floor(t+10),this.sb=Math.floor(this.w-t-20)}}rSize(){this.autoWidth&&(this.isUI||(this.s[0].width=this.w+"px"),this.simple||(this.s[1].width=this.sa+"px"))}setTypeNumber(t){let i;switch(this.isNumber=!0,this.value=0,void 0!==t.value&&("string"==typeof t.value?this.value=1*t.value:this.value=t.value),this.min=void 0===t.min?-1/0:t.min,this.max=void 0===t.max?1/0:t.max,this.precision=void 0===t.precision?2:t.precision,this.precision){case 0:i=1;break;case 1:i=.1;break;case 2:i=.01;break;case 3:i=.001;break;case 4:i=1e-4;break;case 5:i=1e-5}this.step=void 0===t.step?i:t.step,this.range=this.max-this.min,this.value=this.numValue(this.value)}numValue(t){return this.noNeg&&(t=Math.abs(t)),1*Math.min(this.max,Math.max(this.min,t)).toFixed(this.precision)}handleEvent(t){if(!this.lock)return this.neverlock&&(e.lock=!1),this[t.type]?this[t.type](t):console.error(t.type,"this type of event no existe !")}wheel(t){return!1}mousedown(t){return!1}mousemove(t){return!1}mouseup(t){return!1}keydown(t){return!1}keyup(t){return!1}setReferency(t,i){this.objectLink=t,this.val=i}display(t){t=t||!1,this.s[0].visibility=t?"visible":"hidden"}open(){this.isOpen||(this.isOpen=!0,this.openCallback&&this.openCallback())}close(){this.isOpen&&(this.isOpen=!1,this.closeCallback&&this.closeCallback())}needZone(){e.needReZone=!0}rezone(){e.needReZone=!0}select(){}unselect(){}setInput(t){e.setInput(t,this)}upInput(t,i){return e.upInput(t,i)}selected(t){this.isSelect=t||!1}}class l extends r{constructor(t={}){super(t),this.value=t.value||!1,this.model=void 0!==t.mode?t.mode:0,this.onName=t.rename||this.txt,t.onName&&(t.onname=t.onName),t.onname&&(this.onName=t.onname),this.inh=t.inh||Math.floor(.8*this.h),this.inw=t.inw||36;let i=this.colors;if(0===this.model){let t=Math.floor(.5*this.h)-.5*(this.inh-2);this.c[2]=this.dom("div",this.css.basic+"background:"+i.inputBg+"; height:"+(this.inh-2)+"px; width:"+this.inw+"px; top:"+t+"px; border-radius:10px; border:2px solid "+i.back),this.c[3]=this.dom("div",this.css.basic+"height:"+(this.inh-6)+"px; width:16px; top:"+(t+2)+"px; border-radius:10px; background:"+i.button+";")}else this.p=0,void 0!==this.c[1]&&(this.c[1].textContent=""),this.c[2]=this.dom("div",this.css.txt+this.css.button+"top:1px; background:"+i.button+"; height:"+(this.h-2)+"px; border:1px solid "+i.border+"; border-radius:"+this.radius+"px;");this.stat=-1,this.init(),this.update()}mousedown(t){return this.value=!this.value,this.update(!0),this.mousemove(t)}mousemove(t){return this.cursor("pointer"),this.mode(!0)}reset(){return this.cursor(),this.mode()}mode(t){let i,s,e,h=!1,o=this.colors,n=this.value;if(e=t?n?4:3:n?2:1,this.stat!==e){if(this.stat=e,0!==this.model){switch(i=this.s[2],e){case 1:i.color=o.text,i.background=o.button;break;case 2:i.color=o.textSelect,i.background=o.select;break;case 3:i.color=o.textOver,i.background=o.overoff;break;case 4:i.color=o.textOver,i.background=o.over}this.c[2].innerHTML=n?this.onName:this.name}else{switch(i=this.s[2],s=this.s[3],e){case 1:i.background=i.borderColor=o.back,s.background=o.button;break;case 2:i.background=i.borderColor=o.select,s.background=o.button;break;case 3:i.background=i.borderColor=o.back,s.background=o.overoff;break;case 4:i.background=i.borderColor=o.select,s.background=o.over}this.s[3].marginLeft=n?"17px":"2px",this.c[1].textContent=n?this.onName:this.name}h=!0}return h}update(t){this.mode(),t&&this.send()}rSize(){super.rSize();let t=this.s,i=this.w-10-this.inw;0===this.model?(t[2].left=i+"px",t[3].left=i+"px"):(t[2].left=this.sa+"px",t[2].width=this.w-20+"px")}}class a extends r{constructor(t={}){super(t),this.value=t.value||"",this.values=t.value||this.txt,t.values&&(this.values=t.values),this.onName=t.onName||null,this.on=!1,this.customSize=t.forceWidth||-1,"string"==typeof this.values&&(this.values=[this.values]),this.isDown=!1,this.neverlock=!0,this.isLoadButton=t.loader||!1,this.isDragButton=t.drag||!1,this.res=0,this.isDragButton&&(this.isLoadButton=!0),this.lng=this.values.length,this.tmp=[],this.stat=[];let i,s=this.colors;for(let t=0;t<this.lng;t++)i=!1,this.values[t]===this.value&&this.isSelectable&&(i=!0),this.c[t+2]=this.dom("div",this.css.txt+this.css.button+"top:1px; height:"+(this.h-2)+"px; border:"+s.borderSize+"px solid "+s.border+"; border-radius:"+this.radius+"px;"),this.c[t+2].style.background=i?s.select:s.button,this.c[t+2].style.color=i?s.textSelect:s.text,this.c[t+2].innerHTML=this.values[t],this.stat[t]=i?3:1;t.value||t.values||void 0!==this.c[1]&&(this.txt="",this.c[1].textContent=""),this.txt||(this.p=0),this.isLoadButton&&this.initLoader(),this.isDragButton&&(this.lng++,this.initDrager()),this.init()}onOff(){this.on=!this.on,this.label(this.on?this.onName:this.txt)}testZone(t){let i=this.local;if(-1===i.x&&-1===i.y)return-1;let s=this.lng,e=this.tmp;for(;s--;)if(i.x>e[s][0]&&i.x<e[s][2])return s;return-1}mouseup(t){return!!this.isDown&&(this.isDown=!1,-1!==this.res&&(this.value===this.values[this.res]&&this.unselectable?this.value="":this.value=this.values[this.res],null!==this.onName&&this.onOff(),this.isLoadButton||this.send()),this.mousemove(t))}mousedown(t){return!this.isDown&&(this.isDown=!0,this.mousemove(t))}mousemove(t){let i=!1;return this.res=this.testZone(t),-1!==this.res?(this.cursor("pointer"),i=this.modes(this.isDown?3:2,this.res)):i=this.reset(),i}modes(t=1,i=-1){let s,e,h=this.lng,o=!1;for(;h--;)e=t,s=!!this.isSelectable&&this.values[h]===this.value,h===i?s&&2===e&&(e=3):(e=1,s&&(e=4)),o=this.mode(e,h);return o}mode(t,i){let s=!1,e=this.colors,h=this.s,o=i+2;if(this.stat[i]!==t){switch(this.stat[i]=t,t){case 1:h[o].color=e.text,h[o].background=e.button;break;case 2:h[o].color=e.textOver,h[o].background=e.overoff;break;case 3:h[o].color=e.textOver,h[o].background=e.over;break;case 4:h[o].color=e.textSelect,h[o].background=e.select}s=!0}return s}reset(){return this.res=-1,this.cursor(),this.modes()}dragover(t){t.preventDefault(),this.s[4].borderColor=this.colors.select,this.s[4].color=this.colors.select}dragend(t){t.preventDefault(),this.s[4].borderColor=this.color.text,this.s[4].color=this.color.text}drop(t){t.preventDefault(),this.dragend(t),this.fileSelect(t.dataTransfer.files[0])}initDrager(){this.c[4]=this.dom("div",this.css.txt+" text-align:center; line-height:"+(this.h-8)+"px; border:1px dashed "+this.color.text+"; top:2px;\theight:"+(this.h-4)+"px; border-radius:"+this.radius+"px; pointer-events:auto;"),this.c[4].textContent="DRAG",this.c[4].addEventListener("dragover",function(t){this.dragover(t)}.bind(this),!1),this.c[4].addEventListener("dragend",function(t){this.dragend(t)}.bind(this),!1),this.c[4].addEventListener("dragleave",function(t){this.dragend(t)}.bind(this),!1),this.c[4].addEventListener("drop",function(t){this.drop(t)}.bind(this),!1)}addLoader(t,i){this.callbackLoad=i;let s=this.dom("input",this.css.basic+"top:0px; opacity:0; height:100%; width:100%; pointer-events:auto; cursor:pointer;");return s.name="loader",s.type="file",s.addEventListener("change",function(t){this.fileSelect(t.target.files[0])}.bind(this),!1),this.c[t].appendChild(s),this}initLoader(){this.c[3]=this.dom("input",this.css.basic+"top:0px; opacity:0; height:"+this.h+"px; pointer-events:auto; cursor:pointer;"),this.c[3].name="loader",this.c[3].type="file",this.c[3].addEventListener("change",function(t){this.fileSelect(t.target.files[0])}.bind(this),!1)}fileSelect(t){if(void 0===t)return;let i=new FileReader,s=t.name,e=s.substring(s.lastIndexOf(".")+1,s.length);-1!==["png","jpg","mp4","webm","ogg"].indexOf(e)?i.readAsDataURL(t):-1!==["sea","z","hex","bvh","BVH","glb"].indexOf(e)?i.readAsArrayBuffer(t):i.readAsText(t),i.onload=function(t){this.callbackLoad&&this.callbackLoad(t.target.result,s,e)}.bind(this)}label(t,i){i=i||2,this.c[i].textContent=t}icon(t,i=0,s=2){return this.s[s].padding=i+"px 0px",this.c[s].innerHTML=t,this}rSize(){super.rSize();let t=this.s,i=this.sb,s=this.sa,e=this.lng,h=Math.floor((i-3*(e-1))/e);for(-1!==this.customSize&&(h=this.customSize);e--;)this.tmp[e]=[Math.floor(s+h*e+3*e),h],this.tmp[e][2]=this.tmp[e][0]+this.tmp[e][1],t[e+2].left=this.tmp[e][0]+"px",t[e+2].width=this.tmp[e][1]+"px";this.isDragButton&&(t[4].left=s+h+3+"px",t[4].width=h+"px"),this.isLoadButton&&(t[3].left=s+"px",t[3].width=h+"px")}}class c extends r{constructor(t={}){super(t),this.isCyclic=t.cyclic||!1,this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.autoWidth=!1,this.minw=this.w,this.diam=t.diam||this.w,this.setTypeNumber(t),this.twoPi=o.TwoPI,this.pi90=o.pi90,this.offset=new n,this.h=t.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0;let i=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+i.text),this.c[3]=this.getCircular(),this.setSvg(this.c[3],"stroke",i.back,0),this.setSvg(this.c[3],"d",this.makePath(),1),this.setSvg(this.c[3],"stroke",i.text,1),this.setSvg(this.c[3],"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(this.c[3],{width:this.diam,height:this.diam,left:0,top:this.top}),this.init(),this.update()}mode(t){if(this.cmode===t)return!1;let i,s=this.colors;switch(t){case 0:this.s[2].color=s.text,this.setSvg(this.c[3],"stroke",s.back,0),i=this.model>0?o.pack(o.lerpColor(o.unpack(o.ColorLuma(s.text,-.75)),o.unpack(s.text),this.percent)):s.text,this.setSvg(this.c[3],"stroke",i,1);break;case 1:this.s[2].color=s.textOver,this.setSvg(this.c[3],"stroke",s.backoff,0),i=this.model>0?o.pack(o.lerpColor(o.unpack(o.ColorLuma(s.text,-.75)),o.unpack(s.text),this.percent)):s.textOver,this.setSvg(this.c[3],"stroke",i,1)}return this.cmode=t,!0}reset(){this.isDown=!1}testZone(t){let i=this.local;return-1===i.x&&-1===i.y?"":i.y<=this.c[1].offsetHeight?"title":i.y>this.h-this.c[2].offsetHeight?"text":"circular"}mouseup(t){return this.isDown=!1,this.sendEnd(),this.mode(0)}mousedown(t){return this.isDown=!0,this.old=this.value,this.oldr=null,this.mousemove(t),this.mode(1)}mousemove(t){if(!this.isDown)return;let i=this.offset;if(i.x=.5*this.w-(t.clientX-this.zone.x),i.y=.5*this.diam-(t.clientY-this.zone.y-this.top),this.r=i.angle()-this.pi90,this.r=(this.r%this.twoPi+this.twoPi)%this.twoPi,null!==this.oldr){let t=this.r-this.oldr;this.r=Math.abs(t)>Math.PI?this.oldr:this.r,t>6&&(this.r=0),t<-6&&(this.r=this.twoPi)}let s=1/this.twoPi,e=this.r*s,h=this.range*e+this.min-this.old;(h>=this.step||h<=this.step)&&(h=~~(h/this.step),this.value=this.numValue(this.old+h*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}wheel(t){if("circular"===this.testZone(t)){let i=this.value-this.step*t.delta;return i>this.max?i=this.isCyclic?this.min:this.max:i<this.min&&(i=this.isCyclic?this.max:this.min),this.setValue(i),this.old=i,this.update(!0),!0}return!1}makePath(){let t=40,i=this.percent*this.twoPi-.001,s=t+t*Math.sin(i)+24,e=t-t*Math.cos(i)+24;return"M 64,24 A 40,40 0 "+(i>Math.PI?1:0)+" 1 "+s+","+e}update(t){if(this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range,this.setSvg(this.c[3],"d",this.makePath(),1),this.model>0){let t=this.colors,i=o.pack(o.lerpColor(o.unpack(o.ColorLuma(t.text,-.75)),o.unpack(t.text),this.percent));this.setSvg(this.c[3],"stroke",i,1)}t&&this.send()}}class d extends r{constructor(t={}){super(t),this.ctype=t.ctype||"hex",this.wfixe=256,this.cw=this.sb>256?256:this.sb,null!=t.cw&&(this.cw=t.cw),this.side=t.side||"down",this.up="down"===this.side?0:1,this.baseH=this.h,this.offset=new n,this.decal=new n,this.pp=new n,this.c[2]=this.dom("div",this.css.txt+"height:"+(this.h-4)+"px;border-radius:"+this.radius+"px; line-height:"+(this.h-8)+"px;"),this.s[2]=this.c[2].style,this.s[2].textShadow="none",this.up&&(this.s[2].top="auto",this.s[2].bottom="2px"),this.c[3]=this.getColorRing(),this.c[3].style.visibility="hidden",this.hsl=null,this.value="#ffffff",void 0!==t.value&&(t.value instanceof Array?this.value=o.rgbToHex(t.value):isNaN(t.value)?this.value=t.value:this.value=o.hexToHtml(t.value)),this.bcolor=null,this.isDown=!1,this.fistDown=!1,this.notext=t.notext||!1,this.tr=98,this.tsl=Math.sqrt(3)*this.tr,this.hue=0,this.d=256,this.setColor(this.value),this.init(),void 0!==t.open&&this.open()}testZone(t,i){let s=this.local;return-1===s.x&&-1===s.y?"":this.up&&this.isOpen?s.y>this.wfixe?"title":"color":s.y<this.baseH+2?"title":this.isOpen?"color":void 0}mouseup(t){this.isDown=!1,this.d=256}mousedown(t){let i=this.testZone(t.clientX,t.clientY);if("title"===i)return this.isOpen?this.close():this.open(),!0;"color"===i&&(this.isDown=!0,this.fistDown=!0,this.mousemove(t))}mousemove(t){let i,s,e,h,n,r,l,a,c,d=this.testZone(t.clientX,t.clientY),u=o;if("title"===d&&this.cursor("pointer"),"color"===d&&(i=this.offset,i.x=t.clientX-(this.zone.x+this.decal.x+this.mid),i.y=t.clientY-(this.zone.y+this.decal.y+this.mid),s=i.length()*this.ratio,c=i.angle(),c<0&&(c+=2*u.PI),s<128?this.cursor("crosshair"):this.isDown||this.cursor(),this.isDown&&(this.fistDown&&(this.d=s,this.fistDown=!1),this.d<128)))if(this.d>this.tr)e=(c+u.pi90)/u.TwoPI,this.hue=(e+1)%1,this.setHSL([(e+1)%1,this.hsl[1],this.hsl[2]]);else{l=i.x*this.ratio,a=i.y*this.ratio;let t=this.hue*u.TwoPI+u.PI;t<0&&(t+=2*u.PI),r=Math.atan2(-a,l),r<0&&(r+=2*u.PI);let s=(r+u.pi90+u.TwoPI+t)%u.TwoPI,e=s%(2/3*u.PI)-u.pi60,o=.5*this.tr,c=Math.tan(e)*o,d=Math.sqrt(l*l+a*a),p=Math.sqrt(o*o+c*c);if(d>p){let i=Math.tan(e)*d,h=Math.atan(i/p);h>u.pi60?h=u.pi60:h<-u.pi60&&(h=-u.pi60),r+=h-e,s=(r+u.pi90+u.TwoPI+t)%u.TwoPI,e=s%(2/3*u.PI)-u.pi60,c=Math.tan(e)*o,d=p=Math.sqrt(o*o+c*c)}n=Math.sin(s)*d/this.tsl+.5;let m=1-2*Math.abs(n-.5);h=(Math.cos(s)*d+this.tr/2)/(1.5*this.tr)/m,h=u.clamp(h,0,1),this.setHSL([this.hsl[0],h,n])}}setHeight(){this.h=this.isOpen?this.wfixe+this.baseH+5:this.baseH,this.s[0].height=this.h+"px",this.zone.h=this.h}parentHeight(t){null!==this.group?this.group.calc(t):this.isUI&&this.main.calc(t)}open(){super.open(),this.setHeight(),this.up&&(this.zone.y-=this.wfixe+5);let t=this.h-this.baseH;this.s[3].visibility="visible",this.parentHeight(t)}close(){super.close(),this.up&&(this.zone.y+=this.wfixe+5);let t=this.h-this.baseH;this.setHeight(),this.s[3].visibility="hidden",this.parentHeight(-t)}update(t){let i=o.rgbToHex(o.hslToRgb([this.hsl[0],1,.5]));this.moveMarkers(),this.value=this.bcolor,this.setSvg(this.c[3],"fill",i,2,0),this.s[2].background=this.bcolor,this.notext||(this.c[2].textContent=o.htmlToHex(this.bcolor)),this.invert=o.findDeepInver(this.rgb),this.s[2].color=this.invert?"#fff":"#000",t&&("array"===this.ctype&&this.send(this.rgb),"rgb"===this.ctype&&this.send(o.htmlRgb(this.rgb)),"hex"===this.ctype&&this.send(o.htmlToHex(this.value)),"html"===this.ctype&&this.send())}setValue(t){t instanceof Array?this.value=o.rgbToHex(t):isNaN(t)?this.value=t:this.value=o.hexToHtml(t),this.setColor(this.value),this.update()}setColor(t){let i=o.unpack(t);return this.bcolor!==t&&i&&(this.bcolor=t,this.rgb=i,this.hsl=o.rgbToHsl(this.rgb),this.hue=this.hsl[0],this.update()),this}setHSL(t){return this.hsl=t,this.rgb=o.hslToRgb(t),this.bcolor=o.rgbToHex(this.rgb),this.update(!0),this}moveMarkers(){let t=this.pp,i=o;this.invert;let s=this.hsl[0]*i.TwoPI,e=2/3*i.PI,h=this.tr,n=this.hsl[0],r=this.hsl[1],l=this.hsl[2],a=(s-i.pi90)*i.todeg;n=-s+i.pi90;let c=Math.cos(n)*h,d=-Math.sin(n)*h,u=Math.cos(n-e)*h,p=-Math.sin(n-e)*h,m=Math.cos(n+e)*h,g=-Math.sin(n+e)*h,x=(u+m)/2,f=(p+g)/2;s=(1-2*Math.abs(l-.5))*r;let v=u+(m-u)*l+(c-x)*s,b=p+(g-p)*l+(d-f)*s;t.set(v,b).addScalar(128),this.setSvg(this.c[3],"transform","rotate("+a+" )",2),this.setSvg(this.c[3],"cx",t.x,3),this.setSvg(this.c[3],"cy",t.y,3),this.setSvg(this.c[3],"stroke",this.invert?"#fff":"#000",2,3),this.setSvg(this.c[3],"stroke",this.invert?"#fff":"#000",3),this.setSvg(this.c[3],"fill",this.bcolor,3)}rSize(){super.rSize();let t=this.s;t[2].width=this.sb+"px",t[2].left=this.sa+"px",this.rSizeColor(this.cw),this.decal.x=Math.floor(.5*(this.w-this.wfixe))}rSizeColor(t){if(t===this.wfixe)return;this.wfixe=t;let i=this.s;this.decal.y="up"===this.side?2:this.baseH+2,this.mid=Math.floor(.5*this.wfixe),this.setSvg(this.c[3],"viewBox","0 0 "+this.wfixe+" "+this.wfixe),i[3].width=this.wfixe+"px",i[3].height=this.wfixe+"px",i[3].top=this.decal.y+"px",this.ratio=256/this.wfixe,this.square=1/(this.wfixe/256*60),this.setHeight()}}class u extends r{constructor(t={}){super(t),this.round=Math.round,this.baseH=this.h,this.hplus=t.hplus||50,this.res=t.res||40,this.l=1,this.precision=t.precision||0,this.custom=t.custom||!1,this.names=t.names||["FPS","MS"];let i=t.cc||["220,220,220","255,255,0"];this.adding=t.adding||!1,this.range=t.range||[165,100,100],this.alpha=t.alpha||.25,this.values=[],this.points=[],this.textDisplay=[],this.custom||(this.now=e.getTime(),this.startTime=0,this.prevTime=0,this.frames=0,this.ms=0,this.fps=0,this.mem=0,this.mm=0,this.isMem=!(!self.performance||!self.performance.memory),this.isMem&&(this.names.push("MEM"),i.push("0,255,255")),this.txt=t.name||"Fps");let s=Math.floor(.5*this.h)-6;this.c[1].textContent=this.txt,this.c[0].style.cursor="pointer",this.c[0].style.pointerEvents="auto";let h="display:none; left:10px; top:"+this.h+"px; height:"+(this.hplus-8)+"px; box-sizing:border-box; background: rgba(0, 0, 0, 0.2); border:1px solid "+this.colors.border+";";0!==this.radius&&(h+="border-radius:"+this.radius+"px;"),this.c[2]=this.dom("path",this.css.basic+h,{}),this.c[2].setAttribute("viewBox","0 0 "+this.res+" 50"),this.c[2].setAttribute("height","100%"),this.c[2].setAttribute("width","100%"),this.c[2].setAttribute("preserveAspectRatio","none"),this.c[3]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; left:4px; top:"+s+"px;",{d:this.svgs.arrow,fill:this.colors.text,stroke:"none"}),this.c[4]=this.dom("div",this.css.txt+"position:absolute; left:10px; top:"+(this.h+2)+"px; display:none; width:100%; text-align:center;"),t.bottomLine&&(this.c[4]=this.dom("div",this.css.basic+"width:100%; bottom:0px; height:1px; background: rgba(255, 255, 255, 0.2);")),this.isShow=!1;let o=this.s;o[1].marginLeft="10px",o[1].lineHeight=this.h-4,o[1].color=this.colors.text,o[1].fontWeight="bold",0!==this.radius&&(o[0].borderRadius=this.radius+"px"),"none"!==this.colors.gborder&&(o[0].border="1px solid "+this.colors.gborder);let n=0;for(n=0;n<this.names.length;n++){let t=[],s=this.res+1;for(;s--;)t.push(50);this.range[n]=1/this.range[n]*49,this.points.push(t),this.values.push(0),this.textDisplay.push("<span style='color:rgb("+i[n]+")'> "+this.names[n]+" ")}for(n=this.names.length;n--;)this.dom("path",null,{fill:"rgba("+i[n]+","+this.alpha+")","stroke-width":1,stroke:"rgba("+i[n]+",1)","vector-effect":"non-scaling-stroke"},this.c[2]);this.init()}mousedown(t){this.isShow?this.close():this.open()}tick(t){this.values=t,this.isShow&&(this.drawGraph(),this.upText())}makePath(t){let i="";i+="M -1 50";for(let s=0;s<this.res+1;s++)i+=" L "+s+" "+t[s];return i+=" L "+(this.res+1)+" 50",i}upText(t){let i=t||this.values,s="";for(let t=0,e=this.names.length;t<e;t++)s+=this.textDisplay[t]+i[t].toFixed(this.precision)+"</span>";this.c[4].innerHTML=s}drawGraph(){let t,i=this.c[2],s=this.names.length,e=0,h=0;for(;s--;)t=this.adding?(this.values[h]+e)*this.range[h]:this.values[h]*this.range[h],this.points[h].shift(),this.points[h].push(50-t),this.setSvg(i,"d",this.makePath(this.points[h]),s+1),e+=this.values[h],h++}open(){super.open(),this.h=this.hplus+this.baseH,this.setSvg(this.c[3],"d",this.svgs.arrowDown),null!==this.group?this.group.calc(this.hplus):this.isUI&&this.main.calc(this.hplus),this.s[0].height=this.h+"px",this.s[2].display="block",this.s[4].display="block",this.isShow=!0,this.custom||e.addListen(this)}close(){super.close(),this.h=this.baseH,this.setSvg(this.c[3],"d",this.svgs.arrow),null!==this.group?this.group.calc(-this.hplus):this.isUI&&this.main.calc(-this.hplus),this.s[0].height=this.h+"px",this.s[2].display="none",this.s[4].display="none",this.isShow=!1,this.custom||e.removeListen(this),this.c[4].innerHTML=""}begin(){this.startTime=this.now()}end(){let t=this.now();if(this.ms=t-this.startTime,this.frames++,t>this.prevTime+1e3&&(this.fps=this.round(1e3*this.frames/(t-this.prevTime)),this.prevTime=t,this.frames=0,this.isMem)){let t=performance.memory.usedJSHeapSize,i=performance.memory.jsHeapSizeLimit;this.mem=this.round(954e-9*t),this.mm=t/i}return this.values=[this.fps,this.ms,this.mm],this.drawGraph(),this.upText([this.fps,this.ms,this.mem]),t}listening(){this.custom||(this.startTime=this.end())}rSize(){let t=this.s,i=this.w;t[0].width=i+"px",t[1].width=i+"px",t[2].left="10px",t[2].width=i-20+"px",t[4].width=i-20+"px"}}class p extends r{constructor(t={}){super(t),this.value=void 0!==t.value?t.value:[0,0,0],this.lng=this.value.length,this.precision=void 0!==t.precision?t.precision:2,this.multiplicator=t.multiplicator||1,this.neg=t.neg||!1,this.line=void 0===t.line||t.line,this.autoWidth=void 0===t.autoWidth||t.autoWidth,this.isNumber=!1,this.isDown=!1,this.h=t.h||138,this.rh=this.h-10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.autoWidth||(this.c[1].style.width="100%",this.c[1].style.justifyContent="center"),this.top=10,this.h+=10),this.gh=this.rh-28,this.gw=this.w-28,this.c[2]=this.dom("div",this.css.txt+"display:block; text-align:center; padding:0px 0px; top:"+(this.h-20)+"px; left:14px; width:"+this.gw+"px;\tcolor:"+this.colors.text),this.c[2].innerHTML=this.valueToHtml();let i=this.dom("svg",this.css.basic,{viewBox:"0 0 "+this.w+" "+this.rh,width:this.w,height:this.rh,preserveAspectRatio:"none"});this.setCss(i,{width:this.w,height:this.rh,left:0,top:this.top}),this.dom("path","",{d:"",stroke:this.colors.text,"stroke-width":2,fill:"none","stroke-linecap":"butt"},i),this.dom("rect","",{x:10,y:10,width:this.gw+8,height:this.gh+8,stroke:"rgba(0,0,0,0.3)","stroke-width":1,fill:"none"},i),this.iw=(this.gw-4*(this.lng-1))/this.lng;let s=[];this.cMode=[],this.v=[];for(let t=0;t<this.lng;t++)s[t]=[14+t*this.iw+4*t,this.iw],s[t][2]=s[t][0]+s[t][1],this.cMode[t]=0,this.neg?this.v[t]=.5*(1+this.value[t]/this.multiplicator):this.v[t]=this.value[t]/this.multiplicator,this.dom("rect","",{x:s[t][0],y:14,width:s[t][1],height:1,fill:this.colors.text,"fill-opacity":.3},i);this.tmp=s,this.c[3]=i,this.init(),void 0!==this.c[1]&&(this.c[1].style.top="0px",this.c[1].style.height="20px",this.s[1].lineHeight="15px"),this.update(!1)}setValue(t){this.value=t,this.lng=this.value.length;for(var i=0;i<this.lng;i++)this.neg?this.v[i]=.5*(1+t[i]/this.multiplicator):this.v[i]=t[i]/this.multiplicator;this.update()}valueToHtml(){let t=this.lng,i=0,s='<table style="width:100%;"><tr>',e="width:"+100/this.lng+"%;";for(;t--;)i===this.lng-1?s+="<td style="+e+">"+this.value[i]+"</td></tr></table>":s+="<td style="+e+">"+this.value[i]+"</td>",i++;return s}updateSVG(){this.line&&this.setSvg(this.c[3],"d",this.makePath(),0);for(let t=0;t<this.lng;t++)this.setSvg(this.c[3],"height",this.v[t]*this.gh,t+2),this.setSvg(this.c[3],"y",this.gh-this.v[t]*this.gh+14,t+2),this.neg?this.value[t]=1*((2*this.v[t]-1)*this.multiplicator).toFixed(this.precision):this.value[t]=1*(this.v[t]*this.multiplicator).toFixed(this.precision);this.c[2].innerHTML=this.valueToHtml()}testZone(t){let i=this.local;if(-1===i.x&&-1===i.y)return"";let s=this.lng,e=this.tmp;if(i.y>this.top&&i.y<this.h-20)for(;s--;)if(i.x>e[s][0]&&i.x<e[s][2])return s;return""}mode(t,i){if(t===this.cMode[i])return!1;let s;switch(t){case 0:s=.3;break;case 1:s=.6;break;case 2:s=1}return this.reset(),this.setSvg(this.c[3],"fill-opacity",s,i+2),this.cMode[i]=t,!0}reset(){let t=!1,i=this.lng;for(;i--;)0!==this.cMode[i]&&(this.cMode[i]=0,this.setSvg(this.c[3],"fill-opacity",.3,i+2),t=!0);return t}mouseup(t){if(this.isDown=!1,-1!==this.current)return this.reset()}mousedown(t){return this.isDown=!0,this.mousemove(t)}mousemove(t){let i=!1,s=this.testZone(t);return""===s?i=this.reset():(i=this.mode(this.isDown?2:1,s),this.isDown&&(this.v[s]=this.clamp(1-(t.clientY-this.zone.y-this.top-10)/this.gh,0,1),this.update(!0))),i}update(t){this.updateSVG(),t&&this.send()}makePath(){let t,i,s,e,h,o,n="";for(let r=0;r<this.lng;r++)t=this.gh-this.v[r]*this.gh+14,i=14+r*this.iw+4*r,e=i+.5*this.iw,s=i+this.iw,n+=0===r?"M "+i+" "+t+" T "+e+" "+t:" C "+h+" "+o+","+i+" "+t+","+e+" "+t,r===this.lng-1&&(n+=" T "+s+" "+t),h=s,o=t;return n}rSize(){super.rSize();let t=this.s;void 0!==this.c[1]&&(t[1].width=this.w+"px"),t[3].width=this.w+"px";let i=this.w-28,s=(i-4*(this.lng-1))/this.lng,e=[];t[2].width=i+"px";for(let t=0;t<this.lng;t++)e[t]=[14+t*s+4*t,s],e[t][2]=e[t][0]+e[t][1];this.tmp=e}}class m extends r{constructor(t={}){super(t),this.isGroup=!0,this.ADD=t.add,this.uis=[],this.isEmpty=!0,this.autoHeight=!0,this.current=-1,this.targetIn=null,this.decal=0,this.baseH=this.h;let i=Math.floor(.5*this.h)-6;this.isLine=void 0!==t.line&&t.line,this.decal=0,t.group&&(this.decal=t.group.decal?t.group.decal:0,this.decal+=6),this.useFlex=!0;let s=this.useFlex?"display:flex; flex-flow: row wrap;":"";this.c[2]=this.dom("div",this.css.basic+s+"width:100%; left:0; height:auto; overflow:hidden; top:"+this.h+"px"),this.c[3]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; left:0; top:"+i+"px;",{d:this.svgs.group,fill:this.colors.text,stroke:"none"}),this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; left:"+(4+this.decal)+"px; top:"+i+"px;",{d:this.svgs.arrow,fill:this.colors.text,stroke:"none"}),this.isLine&&(this.c[5]=this.dom("div",this.css.basic+"background:rgba(255, 255, 255, 0.2); width:100%; left:0; height:1px; bottom:0px"));let e=this.s;e[0].height=this.h+"px",e[1].height=this.h+"px",this.c[1].name="group",e[1].marginLeft=10+this.decal+"px",e[1].lineHeight=this.h-4,e[1].color=this.colors.text,e[1].fontWeight="bold",0!==this.radius&&(e[0].borderRadius=this.radius+"px"),this.init(),this.setBG(t.bg),void 0!==t.open&&this.open()}testZone(t){let i=this.local;if(-1===i.x&&-1===i.y)return"";let s="";return i.y<this.baseH?s="title":this.isOpen&&(s="content"),s}clearTarget(){return-1!==this.current&&(this.targetIn.uiout(),this.targetIn.reset(),this.current=-1,this.targetIn=null,this.cursor(),!0)}reset(){this.clearTarget()}handleEvent(t){let i=t.type,s=!1,h=!1,o=this.testZone(t);if(o){switch(o){case"content":this.cursor(),e.isMobile&&"mousedown"===i&&this.getNext(t,s),this.targetIn&&(h=this.targetIn.handleEvent(t)),e.lock||this.getNext(t,s);break;case"title":this.cursor("pointer"),"mousedown"===i&&(this.isOpen?this.close():this.open())}return this.isDown&&(s=!0),h&&(s=!0),s}}getNext(t,i){let s=e.findTarget(this.uis,t);s!==this.current&&(this.clearTarget(),this.current=s),-1!==s&&(this.targetIn=this.uis[this.current],this.targetIn.uiover())}setBG(t){void 0!==t&&(this.colors.background=t),this.c[0].style.background=this.colors.background;let i=this.uis.length;for(;i--;)this.uis[i].setBG(this.colors.background)}add(){let t=arguments;"object"==typeof t[1]?(t[1].isUI=this.isUI,t[1].target=this.c[2],t[1].main=this.main,t[1].group=this):"string"==typeof arguments[1]&&(void 0===t[2]?[].push.call(t,{isUI:!0,target:this.c[2],main:this.main}):(t[2].isUI=!0,t[2].target=this.c[2],t[2].main=this.main,t[2].group=this));let i=this.ADD.apply(this,t);return this.uis.push(i),this.isEmpty=!1,i}remove(t){t.dispose&&t.dispose()}dispose(){this.clear(),this.isUI&&this.main.calc(),super.dispose()}clear(){this.empty()}empty(){this.close();let t,i=this.uis.length;for(;i--;)t=this.uis.pop(),this.c[2].removeChild(t.c[0]),t.clear(!0);this.isEmpty=!0,this.h=this.baseH}clearOne(t){let i=this.uis.indexOf(t);-1!==i&&(this.calc(-(this.uis[i].h+1)),this.c[2].removeChild(this.uis[i].c[0]),this.uis.splice(i,1),0===this.uis.length&&(this.isEmpty=!0,this.close()))}open(){super.open(),this.setSvg(this.c[4],"d",this.svgs.arrowDown),this.rSizeContent(),this.h,this.baseH,this.parentHeight()}close(){super.close(),this.h,this.baseH,this.setSvg(this.c[4],"d",this.svgs.arrow),this.h=this.baseH,this.s[0].height=this.h+"px",this.parentHeight()}calcUis(){this.isOpen?this.h=e.calcUis(this.uis,this.zone,this.zone.y+this.baseH)+this.baseH:this.h=this.baseH,this.s[0].height=this.h+"px"}parentHeight(t){null!==this.group?this.group.calc(t):this.isUI&&this.main.calc(t)}calc(t){this.isOpen&&(this.isUI?this.main.calc():this.calcUis(),this.s[0].height=this.h+"px")}rSizeContent(){let t=this.uis.length;for(;t--;)this.uis[t].setSize(this.w),this.uis[t].rSize()}rSize(){super.rSize();let t=this.s;t[3].left=this.sa+this.sb-17+"px",t[1].width=this.w+"px",t[2].width=this.w+"px",this.isOpen&&this.rSizeContent()}}class g extends r{constructor(t={}){super(t),this.autoWidth=!1,this.value=[0,0],this.minw=this.w,this.diam=t.diam||this.w,this.joyType="analogique",this.model=void 0!==t.mode?t.mode:0,this.precision=t.precision||2,this.multiplicator=t.multiplicator||1,this.pos=new n,this.tmp=new n,this.interval=null,this.distance=.5*this.diam*.25,this.h=t.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10);let i=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+i.text),this.c[2].textContent=this.value,this.c[3]=this.getJoystick(this.model),this.setSvg(this.c[3],"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(this.c[3],{width:this.diam,height:this.diam,left:0,top:this.top}),this.ratio=128/this.w,this.init(),this.update(!1)}mode(t){let i=this.colors;switch(t){case 0:0===this.model?(this.setSvg(this.c[3],"fill","url(#gradIn)",4),this.setSvg(this.c[3],"stroke","#000",4)):(this.setSvg(this.c[3],"stroke","rgba(100,100,100,0.25)",2),this.setSvg(this.c[3],"stroke","#666",4),this.setSvg(this.c[3],"fill","none",4));break;case 1:0===this.model?(this.setSvg(this.c[3],"fill","url(#gradIn2)",4),this.setSvg(this.c[3],"stroke","rgba(0,0,0,0)",4)):(this.setSvg(this.c[3],"stroke","rgba(48,138,255,0.25)",2),this.setSvg(this.c[3],"stroke",i.select,4),this.setSvg(this.c[3],"fill","rgba(48,138,255,0.25)",4))}}addInterval(){null!==this.interval&&this.stopInterval(),this.pos.isZero()||(this.interval=setInterval(function(){this.update()}.bind(this),10))}stopInterval(){null!==this.interval&&(clearInterval(this.interval),this.interval=null)}reset(){this.addInterval(),this.mode(0)}mouseup(t){this.addInterval(),this.isDown=!1}mousedown(t){this.isDown=!0,this.mousemove(t),this.mode(2)}mousemove(t){if(this.mode(1),!this.isDown)return;if(this.tmp.x=.5*this.w-(t.clientX-this.zone.x),this.tmp.y=.5*this.diam-(t.clientY-this.zone.y-this.top),this.tmp.length()>this.distance){let t=Math.atan2(this.tmp.x,this.tmp.y);this.tmp.x=Math.sin(t)*this.distance,this.tmp.y=Math.cos(t)*this.distance}this.pos.copy(this.tmp).divideScalar(this.distance).negate(),this.update()}setValue(t){void 0===t&&(t=[0,0]),this.pos.set(t[0]||0,t[1]||0),this.updateSVG()}update(t){void 0===t&&(t=!0),null!==this.interval&&(this.isDown||(this.pos.lerp(null,.3),this.pos.x=Math.abs(this.pos.x)<.01?0:this.pos.x,this.pos.y=Math.abs(this.pos.y)<.01?0:this.pos.y,this.isUI&&this.main.isCanvas&&this.main.draw())),this.updateSVG(),t&&this.send(),this.pos.isZero()&&this.stopInterval()}updateSVG(){let t=.5*this.diam- -this.pos.x*this.distance,i=.5*this.diam- -this.pos.y*this.distance;if(0===this.model){let s=t+5*this.pos.x+5,e=i+5*this.pos.y+10;this.setSvg(this.c[3],"cx",s*this.ratio,3),this.setSvg(this.c[3],"cy",e*this.ratio,3)}else this.setSvg(this.c[3],"cx",t*this.ratio,3),this.setSvg(this.c[3],"cy",i*this.ratio,3);this.setSvg(this.c[3],"cx",t*this.ratio,4),this.setSvg(this.c[3],"cy",i*this.ratio,4),this.value[0]=1*(this.pos.x*this.multiplicator).toFixed(this.precision),this.value[1]=1*(this.pos.y*this.multiplicator).toFixed(this.precision),this.c[2].textContent=this.value}clear(){this.stopInterval(),super.clear()}}class x extends r{constructor(t={}){super(t),this.isCyclic=t.cyclic||!1,this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.autoWidth=!1,this.setTypeNumber(t),this.minw=this.w,this.diam=t.diam||this.w,this.mPI=.8*Math.PI,this.toDeg=180/Math.PI,this.cirRange=2*this.mPI,this.offset=new n,this.h=t.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0;let i=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+i.text),this.c[3]=this.getKnob(),this.setSvg(this.c[3],"fill",i.button,0),this.setSvg(this.c[3],"stroke",i.text,1),this.setSvg(this.c[3],"stroke",i.text,3),this.setSvg(this.c[3],"d",this.makeGrad(),3),this.setSvg(this.c[3],"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(this.c[3],{width:this.diam,height:this.diam,left:0,top:this.top}),this.model>0&&(o.dom("path","",{d:"",stroke:i.text,"stroke-width":2,fill:"none","stroke-linecap":"round"},this.c[3]),2==this.model&&(o.addSVGGlowEffect(),this.setSvg(this.c[3],"style",'filter: url("#UILGlow");',4))),this.r=0,this.init(),this.update()}mode(t){let i=this.colors;if(this.cmode===t)return!1;switch(t){case 0:this.s[2].color=i.text,this.setSvg(this.c[3],"fill",i.button,0),this.setSvg(this.c[3],"stroke",i.text,1);break;case 1:this.s[2].color=i.textOver,this.setSvg(this.c[3],"fill",i.select,0),this.setSvg(this.c[3],"stroke",i.textOver,1)}return this.cmode=t,!0}testZone(t){let i=this.local;return-1===i.x&&-1===i.y?"":i.y<=this.c[1].offsetHeight?"title":i.y>this.h-this.c[2].offsetHeight?"text":"knob"}mouseup(t){return this.isDown=!1,this.sendEnd(),this.mode(0)}mousedown(t){return this.isDown=!0,this.old=this.value,this.oldr=null,this.mousemove(t),this.mode(1)}mousemove(t){if(!this.isDown)return;let i=this.offset;i.x=.5*this.w-(t.clientX-this.zone.x),i.y=.5*this.diam-(t.clientY-this.zone.y-this.top),this.r=-Math.atan2(i.x,i.y),null!==this.oldr&&(this.r=Math.abs(this.r-this.oldr)>Math.PI?this.oldr:this.r),this.r=this.r>this.mPI?this.mPI:this.r,this.r=this.r<-this.mPI?-this.mPI:this.r;let s=1/this.cirRange,e=(this.r+this.mPI)*s,h=this.range*e+this.min-this.old;(h>=this.step||h<=this.step)&&(h=Math.floor(h/this.step),this.value=this.numValue(this.old+h*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}wheel(t){if("knob"===this.testZone(t)){let i=this.value-this.step*t.delta;return i>this.max?i=this.isCyclic?this.min:this.max:i<this.min&&(i=this.isCyclic?this.max:this.min),this.setValue(i),this.old=i,this.update(!0),!0}return!1}makeGrad(){let t,i,s,e,h,o,n,r="",l=64,a=Math.PI+this.mPI,c=Math.PI-this.mPI;this.step>5?(i=this.range/this.step,t=(a-c)/i):(t=(a-c)/l*2,i=32);for(let c=0;c<=i;++c)s=a-t*c,e=l+44*Math.sin(s),h=l+44*Math.cos(s),o=l+40*Math.sin(s),n=l+40*Math.cos(s),r+="M"+e+" "+h+" L"+o+" "+n+" ";return r}update(t){this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range;let i=Math.PI+this.mPI,s=this.percent*this.cirRange-this.mPI,e=Math.sin(s),h=Math.cos(s),n=25*e+64,r=-25*h+64,l=20*e+64,a=-20*h+64;if(this.setSvg(this.c[3],"d","M "+n+" "+r+" L "+l+" "+a,1),this.model>0){let t=36*Math.sin(i)+64,n=36*Math.cos(i)+64,r=36*e+64,l=-36*h+64,a=s<=Math.PI-this.mPI?0:1;this.setSvg(this.c[3],"d","M "+t+","+n+" A 36,36 1 "+a+" 1 "+r+","+l,4);let c=o.pack(o.lerpColor(o.unpack(o.ColorLuma(this.colors.text,-.75)),o.unpack(this.colors.text),this.percent));this.setSvg(this.c[3],"stroke",c,4)}t&&this.send()}}class f extends r{constructor(t={}){super(t),this.path=t.path||"",this.format=t.format||"",this.isWithImage=""!==this.path,this.preLoadComplete=!1,this.tmpImage={},this.tmpUrl=[];let i=t.align||"center",s=t.scrollSize||10;this.ss=s+1,this.sMode=0,this.tMode=0,this.listOnly=t.listOnly||!1,this.staticTop=t.staticTop||!1,this.isSelectable=this.listOnly,void 0!==t.select&&(t.selectable=t.select),void 0!==t.selectable&&(this.isSelectable=t.selectable),""===this.txt&&(this.p=0);let e=Math.floor(.5*this.h)-5,h=this.colors;if(this.c[2]=this.dom("div",this.css.basic+"top:0; display:none; border-radius:"+this.radius+"px;"),this.c[3]=this.dom("div",this.css.item+"position:absolute; text-align:"+i+"; line-height:"+(this.h-4)+"px; top:1px; background:"+h.button+"; height:"+(this.h-2)+"px; border:1px solid "+h.border+"; border-radius:"+this.radius+"px;"),this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; top:"+e+"px;",{d:this.svgs.arrow,fill:h.text,stroke:"none"}),this.scrollerBack=this.dom("div",this.css.basic+"right:0px; width:"+s+"px; background:"+h.back+"; display:none;"),this.scroller=this.dom("div",this.css.basic+"right:"+.5*(s-.25*s)+"px; width:"+.25*s+"px; background:"+h.text+"; display:none; "),this.c[3].style.color=h.text,this.list=[],this.refObject=null,t.list)if(t.list instanceof Array)this.list=t.list;else{this.refObject=t.list;for(let t in this.refObject)this.list.push(t)}this.items=[],this.prevName="",this.baseH=this.h,this.itemHeight=t.itemHeight||this.h-3,this.full=t.full||!1,this.py=0,this.ww=this.sb,this.scroll=!1,this.isDown=!1,this.current=null,this.side=t.side||"down",this.up="down"===this.side?0:1,this.up?(this.c[2].style.top="auto",this.c[3].style.top="auto",this.c[4].style.top="auto",this.c[2].style.bottom=this.h-2+"px",this.c[3].style.bottom="1px",this.c[4].style.bottom=e+"px"):this.c[2].style.top=this.baseH+"px",this.listIn=this.dom("div",this.css.basic+"left:0; top:0; width:100%; background:none;"),this.listIn.name="list",this.topList=0,this.c[2].appendChild(this.listIn),this.c[2].appendChild(this.scrollerBack),this.c[2].appendChild(this.scroller),void 0!==t.value?isNaN(t.value)?this.value=t.value:this.value=this.list[t.value]:this.value=this.list[0],this.isOpenOnStart=t.open||!1,this.listOnly&&(this.baseH=5,this.c[3].style.display="none",this.c[4].style.display="none",this.c[2].style.top=this.baseH+"px",this.isOpenOnStart=!0),this.miniCanvas=t.miniCanvas||!1,this.canvasBg=t.canvasBg||"rgba(0,0,0,0)",this.imageSize=t.imageSize||[20,20],this.drag=t.drag||!1,this.dragout=t.dragout||!1,this.dragstart=t.dragstart||null,this.dragend=t.dragend||null,this.isWithImage&&this.preloadImage(),this.setList(this.list),this.init(),this.isOpenOnStart&&this.open(!0)}preloadImage(){this.preLoadComplete=!1,this.tmpImage={};for(let t=0;t<this.list.length;t++)this.tmpUrl.push(this.list[t]);this.loadOne()}nextImg(){this.tmpUrl.shift(),0===this.tmpUrl.length?(this.preLoadComplete=!0,this.addImages()):this.loadOne()}loadOne(){let t=this,i=this.tmpUrl[0],s=document.createElement("img");s.style.cssText="position:absolute; width:"+t.imageSize[0]+"px; height:"+t.imageSize[1]+"px",s.setAttribute("src",this.path+i+this.format),s.addEventListener("load",(function(){t.imageSize[2]=s.width,t.imageSize[3]=s.height,t.tmpImage[i]=s,t.nextImg()}))}testZone(t){let i=this.local;if(-1===i.x&&-1===i.y)return"";if(this.up&&this.isOpen){if(i.y>this.h-this.baseH)return"title";if(this.scroll&&i.x>this.sa+this.sb-this.ss)return"scroll";if(i.x>this.sa)return this.testItems(i.y-this.baseH)}else{if(i.y<this.baseH+2)return"title";if(this.isOpen){if(this.scroll&&i.x>this.sa+this.sb-this.ss)return"scroll";if(i.x>this.sa)return this.testItems(i.y-this.baseH)}}return""}testItems(t){let i,s,e,h="",o=this.items.length;for(;o--;)if(i=this.items[o],s=i.posy+this.topList,e=i.posy+this.itemHeight+1+this.topList,t>=s&&t<=e)return h="item"+o,this.modeItem(0),this.current=i,this.modeItem(1),h;return h}modeItem(t){if(!this.current)return;this.current.select&&0===t&&(t=2);let i=this.colors;switch(t){case 0:this.current.style.background=i.back,this.current.style.color=i.text;break;case 1:this.current.style.background=i.over,this.current.style.color=i.textOver;break;case 2:this.current.style.background=i.select,this.current.style.color=i.textSelect}}unSelected(){this.current&&(this.modeItem(0),this.current=null)}selected(){this.current&&(this.resetItems(),this.modeItem(2),this.current.select=!0)}resetItems(){let t=this.items.length;for(;t--;)this.items[t].select=!1,this.items[t].style.background=this.colors.back,this.items[t].style.color=this.colors.text}mouseup(t){this.isDown=!1}mousedown(t){let i=this.testZone(t);return!!i&&("scroll"===i?(this.isDown=!0,this.mousemove(t)):"title"===i?(this.modeTitle(2),this.listOnly||(this.isOpen?this.close():this.open())):this.current&&(this.value=this.list[this.current.id],this.isSelectable&&this.selected(),this.send(null!==this.refObject?this.refObject[this.list[this.current.id]]:this.value),this.listOnly||(this.close(),this.setTopItem())),!0)}mousemove(t){let i=!1,s=this.testZone(t);if(!s)return i;if("title"===s)this.unSelected(),this.modeTitle(1),this.cursor("pointer");else if("scroll"===s){if(this.cursor("s-resize"),this.modeScroll(1),this.isDown){this.modeScroll(2);let i=this.zone.y+this.baseH-2;this.update(t.clientY-i-.5*this.sh)}}else this.modeTitle(0),this.modeScroll(0),this.cursor("pointer");return s!==this.prevName&&(i=!0),this.prevName=s,i}wheel(t){return"title"!==this.testZone(t)&&(this.py+=10*t.delta,this.update(this.py),!0)}reset(){this.prevName="",this.unSelected(),this.modeTitle(0),this.modeScroll(0)}modeScroll(t){if(t===this.sMode)return;let i=this.scroller.style,s=this.colors;switch(t){case 0:i.background=s.text;break;case 1:case 2:i.background=s.select}this.sMode=t}modeTitle(t){if(t===this.tMode)return;let i=this.s,s=this.colors;switch(t){case 0:i[3].color=s.text,i[3].background=s.button;break;case 1:i[3].color=s.textOver,i[3].background=s.overoff;break;case 2:i[3].color=s.textSelect,i[3].background=s.overoff}this.tMode=t}clearList(){for(;this.listIn.children.length;)this.listIn.removeChild(this.listIn.lastChild);this.items=[]}setList(t){let i,s;this.clearList(),this.list=t,this.length=this.list.length,this.maxItem=this.full?this.length:5,this.maxItem=this.length<this.maxItem?this.length:this.maxItem,this.maxHeight=this.maxItem*(this.itemHeight+1)+2,this.max=this.length*(this.itemHeight+1)+2,this.ratio=this.maxHeight/this.max,this.sh=this.maxHeight*this.ratio,this.range=this.maxHeight-this.sh,this.c[2].style.height=this.maxHeight+"px",this.scrollerBack.style.height=this.maxHeight+"px",this.scroller.style.height=this.sh+"px",this.max>this.maxHeight&&(this.ww=this.sb-this.ss,this.scroll=!0),this.miniCanvas&&(this.tmpCanvas=document.createElement("canvas"),this.tmpCanvas.width=this.imageSize[0],this.tmpCanvas.height=this.imageSize[1],this.tmpCtx=this.tmpCanvas.getContext("2d"),this.tmpCtx.fillStyle=this.canvasBg,this.tmpCtx.fillRect(0,0,this.imageSize[0],this.imageSize[1]));for(let t=0;t<this.length;t++){if(s=this.list[t],i=this.dom("div",this.css.item+"width:"+this.ww+"px; height:"+this.itemHeight+"px; line-height:"+(this.itemHeight-5)+"px; color:"+this.colors.text+"; background:"+this.colors.back+";"),i.name="item"+t,i.id=t,i.select=!1,i.posy=(this.itemHeight+1)*t,this.listIn.appendChild(i),this.items.push(i),s===this.value&&(this.current=i),this.isWithImage||(i.textContent=s),this.miniCanvas){let t=new Image;t.src=this.tmpCanvas.toDataURL(),t.style.cssText="position:relative; pointer-events:none; display:inline-block; float:left; margin-left:0px; margin-right:5px; top:2px",i.appendChild(t),this.tmpImage[s]=t}this.dragout&&(i.img=this.tmpImage[s],i.style.pointerEvents="auto",i.draggable="true",i.addEventListener("dragstart",this.dragstart||function(){}),i.addEventListener("drag",this.drag||function(){}),i.addEventListener("dragleave",(function(){e.fakeUp()})),i.addEventListener("dragend",this.dragend||function(){}.bind(this)))}this.setTopItem(),this.isSelectable&&this.selected()}drawImage(t,i,s,e,h,o){this.tmpCtx.clearRect(0,0,this.imageSize[0],this.imageSize[1]),this.tmpCtx.drawImage(i,s,e,h,o,0,0,this.imageSize[0],this.imageSize[1]),this.tmpImage[t].src=this.tmpCanvas.toDataURL()}addImages(){let t=this.list.length;for(let i=0;i<t;i++)this.items[i].appendChild(this.tmpImage[this.list[i]]);this.setTopItem()}setValue(t){isNaN(t)?this.value=t:this.value=this.list[t],this.setTopItem()}setTopItem(){if(!this.staticTop){if(this.isWithImage){if(!this.preLoadComplete)return;this.c[3].children.length||(this.canvas=document.createElement("canvas"),this.canvas.width=this.imageSize[0],this.canvas.height=this.imageSize[1],this.canvas.style.cssText="position:absolute; top:0px; left:0px;",this.ctx=this.canvas.getContext("2d"),this.c[3].appendChild(this.canvas)),this.tmpImage[this.value],this.ctx.drawImage(this.tmpImage[this.value],0,0,this.imageSize[2],this.imageSize[3],0,0,this.imageSize[0],this.imageSize[1])}else this.c[3].textContent=this.value;this.miniCanvas&&(this.c[3].children.length||(this.canvas=document.createElement("canvas"),this.canvas.width=this.imageSize[0],this.canvas.height=this.imageSize[1],this.h,this.imageSize[1],this.canvas.style.cssText="position:relative; pointer-events:none; display:inline-block; float:left; margin-left:0px; margin-right:5px; top:2px",this.ctx=this.canvas.getContext("2d"),this.c[3].style.textAlign="left",this.c[3].appendChild(this.canvas)),this.ctx.drawImage(this.tmpImage[this.value],0,0))}}update(t){this.scroll&&(t=(t=t<0?0:t)>this.range?this.range:t,this.topList=-Math.floor(t/this.ratio),this.listIn.style.top=this.topList+"px",this.scroller.style.top=Math.floor(t)+"px",this.py=t)}parentHeight(t){null!==this.group?this.group.calc(t):this.isUI&&this.main.calc(t)}open(t){super.open(),this.update(0),this.h=this.maxHeight+this.baseH+5,this.scroll?(this.scroller.style.display="block",this.scrollerBack.style.display="block"):(this.topList=0,this.h=this.baseH+5+this.max,this.scroller.style.display="none",this.scrollerBack.style.display="none"),this.s[0].height=this.h+"px",this.s[2].display="block",this.up?(this.zone.y-=this.h-(this.baseH-10),this.setSvg(this.c[4],"d",this.svgs.arrowUp)):this.setSvg(this.c[4],"d",this.svgs.arrowDown),this.rSizeContent();let i=this.h-this.baseH;this.zone.h=this.h,t||this.parentHeight(i)}close(){super.close(),this.up&&(this.zone.y+=this.h-(this.baseH-10));let t=this.h-this.baseH;this.h=this.baseH,this.s[0].height=this.h+"px",this.s[2].display="none",this.setSvg(this.c[4],"d",this.svgs.arrow),this.zone.h=this.h,this.parentHeight(-t)}text(t){this.c[3].textContent=t}rSizeContent(){let t=this.length;for(;t--;)this.listIn.children[t].style.width=this.ww+"px"}rSize(){super.rSize();let t=this.s,i=this.sb,s=this.sa;void 0!==t[2]&&(t[2].width=i+"px",t[2].left=s+"px",t[3].width=i+"px",t[3].left=s+"px",t[4].left=s+i-17+"px",this.ww=i,this.max>this.maxHeight&&(this.ww=i-this.ss),this.isOpen&&this.rSizeContent())}}class v extends r{constructor(t={}){super(t),this.setTypeNumber(t),this.allway=t.allway||!1,this.isDown=!1,this.value=[0],this.multy=1,this.invmulty=1,this.isSingle=!0,this.isAngle=!1,this.isVector=!1,t.isAngle&&(this.isAngle=!0,this.multy=o.torad,this.invmulty=o.todeg),this.isDrag=t.drag||!1,void 0!==t.value&&(isNaN(t.value)?t.value instanceof Array?(this.value=t.value,this.isSingle=!1):t.value instanceof Object&&(this.value=[],void 0!==t.value.x&&(this.value[0]=t.value.x),void 0!==t.value.y&&(this.value[1]=t.value.y),void 0!==t.value.z&&(this.value[2]=t.value.z),void 0!==t.value.w&&(this.value[3]=t.value.w),this.isVector=!0,this.isSingle=!1):this.value=[t.value]),this.lng=this.value.length,this.tmp=[],this.current=-1,this.prev={x:0,y:0,d:0,v:0};let i=this.colors;this.c[2]=this.dom("div",this.css.basic+" background:"+i.select+"; top:4px; width:0px; height:"+(this.h-8)+"px;"),this.cMode=[];let s=this.lng;for(;s--;)this.isAngle&&(this.value[s]=(180*this.value[s]/Math.PI).toFixed(this.precision)),this.c[3+s]=this.dom("div",this.css.txtselect+" height:"+(this.h-4)+"px; color:"+i.text+"; background:"+i.back+"; borderColor:"+i.border+"; border-radius:"+this.radius+"px;"),t.center&&(this.c[2+s].style.textAlign="center"),this.c[3+s].textContent=this.value[s],this.c[3+s].style.color=this.colors.text,this.c[3+s].isNum=!0,this.cMode[s]=0;this.selectId=3+this.lng,this.c[this.selectId]=this.dom("div",this.css.txtselect+"position:absolute; top:4px; height:"+(this.h-8)+"px; padding:0px 0px; width:0px; color:"+i.textSelect+"; background:"+i.select+"; border:none; border-radius:0px;"),this.cursorId=4+this.lng,this.c[this.cursorId]=this.dom("div",this.css.basic+"top:4px; height:"+(this.h-8)+"px; width:0px; background:"+i.text+";"),this.init()}testZone(t){let i=this.local;if(-1===i.x&&-1===i.y)return"";let s=this.lng,e=this.tmp;for(;s--;)if(i.x>e[s][0]&&i.x<e[s][2])return s;return""}mousedown(t){let i=this.testZone(t);return!this.isDown&&(this.isDown=!0,""!==i&&(this.current=i,this.prev={x:t.clientX,y:t.clientY,d:0,v:this.isSingle?parseFloat(this.value):parseFloat(this.value[this.current])},this.setInput(this.c[3+this.current])),this.mousemove(t))}mouseup(t){return!!this.isDown&&(this.isDown=!1,this.prev={x:0,y:0,d:0,v:0},this.mousemove(t))}mousemove(t){let i=!1,s=0;if(""===this.testZone(t)?this.cursor():this.isDrag?this.cursor(-1!==this.current?"move":"pointer"):this.cursor("text"),!this.isDrag)return this.isDown&&(s=t.clientX-this.zone.x-3),-1!==this.current&&(s-=this.tmp[this.current][0]),this.upInput(s,this.isDown);if(-1!==this.current){this.prev.d+=t.clientX-this.prev.x-(t.clientY-this.prev.y);let s=this.prev.v+this.prev.d*this.step;this.value[this.current]=this.numValue(s),this.c[3+this.current].textContent=this.value[this.current],this.validate(),this.prev.x=t.clientX,this.prev.y=t.clientY,i=!0}return i}reset(){return!1}setValue(t){this.isVector?(void 0!==t.x&&(this.value[0]=t.x),void 0!==t.y&&(this.value[1]=t.y),void 0!==t.z&&(this.value[2]=t.z),void 0!==t.w&&(this.value[3]=t.w)):this.isSingle?this.value=[t]:this.value=t,this.update()}sameStr(t){let i=this.value.length;for(;i--;)this.c[3+i].textContent=t}update(t){let i=this.value.length;for(;i--;)this.value[i]=this.numValue(this.value[i]*this.invmulty),this.c[3+i].textContent=this.value[i];t&&this.send()}send(t){t=t||this.value,this.isSend=!0,null!==this.objectLink&&(this.isVector?this.objectLink[this.val].fromArray(t):this.objectLink[this.val]=t),this.callback&&this.callback(t,this.val),this.isSend=!1}select(t,i,s,e){let h=this.s,o=-1!==this.current?this.tmp[this.current][0]+5:0;h[this.cursorId].width="1px",h[this.cursorId].left=o+t+"px",h[this.selectId].left=o+i+"px",h[this.selectId].width=s+"px",this.c[this.selectId].innerHTML=e}unselect(){let t=this.s;t&&(this.c[this.selectId].innerHTML="",t[this.selectId].width="0px",t[this.cursorId].width="0px")}validate(t){let i=[],s=this.lng;for(this.allway&&(t=!0);s--;){if(isNaN(this.c[3+s].textContent))this.c[3+s].textContent=this.value[s];else{let t=this.numValue(this.c[3+s].textContent);this.c[3+s].textContent=t,this.value[s]=t}i[s]=this.value[s]*this.multy}t&&(this.isSingle?this.send(i[0]):this.send(i))}rSize(){super.rSize();let t=Math.floor((this.sb+5)/this.lng)-5,i=this.s,s=this.lng;for(;s--;)this.tmp[s]=[Math.floor(this.sa+t*s+5*s),t],this.tmp[s][2]=this.tmp[s][0]+this.tmp[s][1],i[3+s].left=this.tmp[s][0]+"px",i[3+s].width=this.tmp[s][1]+"px"}}class b extends r{constructor(t={}){super(t),this.setTypeNumber(t),this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.isDown=!1,this.isOver=!1,this.allway=t.allway||!1,this.isDeg=t.isDeg||!1,this.isCyclic=t.cyclic||!1,this.firstImput=!1;let i=this.colors;if(this.c[2]=this.dom("div",this.css.txtselect+"border:none; background:none; width:47px; color:"+i.text+";"),this.c[3]=this.dom("div",this.css.basic+" top:0; height:"+this.h+"px;"),this.c[4]=this.dom("div",this.css.basic+"background:"+i.back+"; top:2px; height:"+(this.h-4)+"px;"),this.c[5]=this.dom("div",this.css.basic+"left:4px; top:5px; height:"+(this.h-10)+"px; background:"+i.text+";"),this.c[2].isNum=!0,this.c[2].style.height=this.h-2+"px",this.c[2].style.lineHeight=this.h-10+"px",0!==this.model){let t=4,s=8,e=this.h-4,h=20;2===this.model&&(t=4,s=8,h=2,e=.5*(this.h-4)),3===this.model&&(this.c[5].style.visible="none"),this.c[4].style.borderRadius=t+"px",this.c[4].style.height=s+"px",this.c[4].style.top=.5*this.h-t+"px",this.c[5].style.borderRadius=.5*t+"px",this.c[5].style.height=t+"px",this.c[5].style.top=.5*this.h-.5*t+"px",this.c[6]=this.dom("div",this.css.basic+"border-radius:"+h+"px; margin-left:"+.5*-e+"px; border:1px solid "+i.border+"; background:"+i.button+"; left:4px; top:2px; height:"+(this.h-4)+"px; width:"+e+"px;")}this.init()}testZone(t){let i=this.local;return-1===i.x&&-1===i.y?"":i.x>=this.txl?"text":i.x>=this.sa?"scroll":""}mouseup(t){this.isDown&&(this.isDown=!1)}mousedown(t){let i=this.testZone(t);return!!i&&("scroll"===i&&(this.isDown=!0,this.old=this.value,this.mousemove(t)),!0)}mousemove(t){let i=!1;if("scroll"===this.testZone(t)?(this.mode(1),this.cursor("w-resize")):this.cursor(),this.isDown){let s=(t.clientX-(this.zone.x+this.sa)-3)/this.ww*this.range+this.min-this.old;(s>=this.step||s<=this.step)&&(s=Math.floor(s/this.step),this.value=this.numValue(this.old+s*this.step),this.update(!0),this.old=this.value),i=!0}return i}wheel(t){if("scroll"===this.testZone(t)){let i=this.value-this.step*t.delta;return i>this.max?i=this.isCyclic?this.min:this.max:i<this.min&&(i=this.isCyclic?this.max:this.min),this.setValue(i),this.old=i,this.update(!0),!0}return!1}validate(){let t=this.c[2].textContent;isNaN(t)?this.c[2].textContent=this.value+(this.isDeg?"":""):(this.value=this.numValue(t),this.update(!0))}reset(){this.isDown=!1,this.mode(0)}mode(t){let i=this.s,s=this.colors;switch(t){case 0:i[2].color=s.text,i[4].background=s.back,i[5].background=s.text;break;case 1:i[2].color=s.textOver,i[4].background=s.back,i[5].background=s.textOver}}update(t){let i=Math.floor(this.ww*((this.value-this.min)/this.range));3!==this.model&&(this.s[5].width=i+"px"),this.s[6]&&(this.s[6].left=this.sa+i+3+"px"),this.c[2].textContent=this.value+(this.isDeg?"":""),t&&this.send()}rSize(){super.rSize();let t=this.sb-this.sc;this.ww=t-6;let i=this.sc;!this.isUI&&this.simple||(i=this.sc+10),this.txl=this.w-i+2;let s=this.s;s[2].width=this.sc-6+"px",s[2].left=this.txl+4+"px",s[3].left=this.sa+"px",s[3].width=t+"px",s[4].left=this.sa+"px",s[4].width=t+"px",s[5].left=this.sa+3+"px",this.update()}}class y extends r{constructor(t={}){super(t),this.cmode=0,this.value=t.value||"",this.placeHolder=t.placeHolder||"",this.allway=t.allway||!1,this.editable=void 0===t.edit||t.edit,this.isDown=!1;let i=this.colors;this.c[2]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; color:"+i.text+"; background:"+i.back+"; borderColor:"+i.border+"; border-radius:"+this.radius+"px;"),this.c[2].textContent=this.value,this.c[3]=this.dom("div",this.css.txtselect+"position:absolute; top:4px; height:"+(this.h-8)+"px; padding:0px 0px; width:0px; color:"+i.textSelect+"; background:"+i.select+"; border:none; border-radius:0px;"),this.c[4]=this.dom("div",this.css.basic+"top:4px; height:"+(this.h-8)+"px; width:0px; background:"+i.text+";"),this.c[5]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; justify-content: center; font-style: italic; color:"+i.border+";"),""===this.value&&(this.c[5].textContent=this.placeHolder),this.init()}testZone(t){let i=this.local;return-1===i.x&&-1===i.y?"":i.x>=this.sa?"text":""}mouseup(t){if(this.editable)return!!this.isDown&&(this.isDown=!1,this.mousemove(t))}mousedown(t){if(!this.editable)return;let i=this.testZone(t);return!this.isDown&&(this.isDown=!0,"text"===i&&this.setInput(this.c[2]),this.mousemove(t))}mousemove(t){if(!this.editable)return;let i=0;return"text"===this.testZone(t)?this.cursor("text"):this.cursor(),this.isDown&&(i=t.clientX-this.zone.x),this.upInput(i-this.sa-3,this.isDown)}update(){this.c[2].textContent=this.value}reset(){this.cursor()}select(t,i,s,e){let h=this.s,o=this.sa+5;h[4].width="1px",h[4].left=o+i+"px",h[3].left=o+i+"px",h[3].width=s+"px",this.c[3].innerHTML=e}unselect(){let t=this.s;t&&(t[3].width="0px",this.c[3].innerHTML="t",t[4].width="0px")}validate(t){this.allway&&(t=!0),this.value=this.c[2].textContent,""!==this.value?this.c[5].textContent="":this.c[5].textContent=this.placeHolder,t&&this.send()}rSize(){super.rSize();let t=this.s;t[2].left=this.sa+"px",t[2].width=this.sb+"px",t[5].left=this.sa+"px",t[5].width=this.sb+"px"}}class w extends r{constructor(t={}){super(t);let i=t.prefix||"";this.c[2]=this.dom("div",this.css.txt+"justify-content:right; width:60px; line-height:"+(this.h-8)+"px; color:"+this.colors.text),31===this.h&&(this.s[0].height=this.h+"px",this.s[1].top="8px",this.c[2].style.top="8px");let s=this.s;s[1].justifyContent=t.align||"left",s[1].fontWeight=t.fontWeight||"bold",this.c[1].textContent=this.txt.substring(0,1).toUpperCase()+this.txt.substring(1).replace("-"," "),this.c[2].textContent=i,this.init()}text(t){this.c[1].textContent=t}text2(t){this.c[2].textContent=t}rSize(){super.rSize(),this.s[1].width=this.w+"px",this.s[2].left=this.w+"px"}setColor(t){this.s[1].color=t,this.s[2].color=t}}class k extends r{constructor(t={}){super(t),this.value=t.value||"",this.isDown=!1,this.onActif=t.onActif||function(){},t.prefix,this.c[2]=this.dom("div",this.css.txt+this.css.button+" top:1px; background:"+this.colors.button+"; height:"+(this.h-2)+"px; border:"+this.colors.buttonBorder+"; border-radius:15px; width:30px; left:10px;"),this.c[2].style.color=this.fontColor,this.c[3]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; background:"+this.colors.inputBg+"; borderColor:"+this.colors.inputBorder+"; border-radius:"+this.radius+"px;"),this.c[3].textContent=this.value;let i=Math.floor(.5*this.h)-7;this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+i+"px;",{d:this.svgs.cursor,fill:this.fontColor,stroke:"none"}),this.stat=1,this.isActif=!1,this.init()}testZone(t){let i=this.local;return-1===i.x&&-1===i.y?"":i.x>this.sa&&i.x<this.sa+30?"over":"0"}mouseup(t){return!!this.isDown&&(this.isDown=!1,this.mousemove(t))}mousedown(t){return!!this.testZone(t)&&(this.isDown=!0,this.mousemove(t))}mousemove(t){let i=!1;return"over"===this.testZone(t)?(this.cursor("pointer"),i=this.mode(this.isDown?3:2)):i=this.reset(),i}apply(t){(t=t||"")!==this.value&&(this.value=t,this.c[3].textContent=this.value,this.send()),this.mode(1)}update(){this.mode(3)}mode(t){let i=!1,s=this.colors;if(this.stat!==t){switch(1===t&&(this.isActif=!1),3===t&&(this.isActif?this.isActif=!1:(this.isActif=!0,t=4,this.onActif(this))),2===t&&this.isActif&&(t=4),this.stat=t,t){case 1:this.s[2].color=s.text,this.s[2].background=s.button;break;case 2:this.s[2].color=s.textOver,this.s[2].background=s.over;break;case 3:this.s[2].color=s.textSelect,this.s[2].background=s.select;break;case 4:this.s[2].color=s.textSelect,this.s[2].background=s.action}i=!0}return i}reset(){return this.cursor(),this.mode(this.isActif?4:1)}text(t){this.c[3].textContent=t}rSize(){super.rSize();let t=this.s;t[2].left=this.sa+"px",t[3].left=this.sa+40+"px",t[3].width=this.sb-40+"px",t[4].left=this.sa+8+"px"}}class S extends a{constructor(t={}){void 0===t.selectable&&(t.selectable=!0),super(t)}}class C extends r{constructor(t={}){t.isSpace=!0,t.margin=0,t.h||(t.h=10),super(t),this.init()}}class M extends r{constructor(t={}){super(t),this.p=100,this.value=this.txt,this.status=1,this.itype=t.itype||"none",this.val=this.itype,this.graph=this.svgs[this.itype];let i=Math.floor(.5*this.h)-7;this.c[2]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+i+"px;",{d:this.graph,fill:this.colors.text,stroke:"none"}),this.s[1].marginLeft="20px",this.init()}mousemove(t){this.cursor("pointer")}mousedown(t){return this.isUI&&this.main.resetItem(),this.selected(!0),this.send(),!0}uiout(){this.isSelect?this.mode(3):this.mode(1)}uiover(){this.isSelect?this.mode(4):this.mode(2)}update(){}mode(t){let i=!1;if(this.status!==t){this.status=t;let s=this.s,e=this.colors;switch(t){case 1:this.status=1,s[1].color=e.text,s[0].background="none";break;case 2:this.status=2,s[1].color=e.textOver,s[0].background=e.back;break;case 3:this.status=3,s[1].color=e.textSelect,s[0].background=e.select;break;case 4:this.status=4,s[1].color=e.textOver,s[0].background=e.over}i=!0}return i}reset(){this.cursor()}selected(t){this.isSelect&&this.mode(1),this.isSelect=t||!1,this.isSelect&&this.mode(3)}}class L extends r{constructor(t={}){super(t),this.values=t.values||[],"string"==typeof this.values&&(this.values=[this.values]),this.lng=this.values.length,this.value=t.value||null,this.isSelectable=t.selectable||!1,this.spaces=t.spaces||[5,3],this.bsize=t.bsize||[90,20],t.h&&(this.bsize[1]=t.h),this.bsizeMax=this.bsize[0],this.tmp=[],this.stat=[],this.grid=[2,Math.round(.5*this.lng)],this.h=this.grid[1]*(this.bsize[1]+this.spaces[1])+this.spaces[1],this.c[1].textContent="",this.c[2]=this.dom("table",this.css.basic+"width:100%; top:"+(this.spaces[1]-2)+"px; height:auto; border-collapse:separate; border:none; border-spacing: "+(this.spaces[0]-2)+"px "+(this.spaces[1]-2)+"px;");let i,s,e,h,o=0;this.res=-1,this.isDown=!1,this.neverlock=!0,this.buttons=[],this.stat=[],this.tmpX=[],this.tmpY=[];let n=this.colors;for(let t=0;t<this.grid[1];t++){e=this.c[2].insertRow(),e.style.cssText="pointer-events:none;";for(let t=0;t<this.grid[0];t++)s=e.insertCell(),s.style.cssText="pointer-events:none;",this.values[o]?(h=!1,this.values[o]===this.value&&this.isSelectable&&(h=!0),i=document.createElement("div"),i.style.cssText=this.css.txt+this.css.button+"position:static; width:"+this.bsize[0]+"px; height:"+this.bsize[1]+"px; border:"+n.borderSize+"px solid "+n.border+"; left:auto; right:auto; border-radius:"+this.radius+"px;",i.style.background=h?n.select:n.button,i.style.color=h?n.textSelect:n.text,i.innerHTML=this.values[o],s.appendChild(i),this.buttons.push(i),this.stat.push(1)):(i=document.createElement("div"),i.style.cssText=this.css.txt+"position:static; width:"+this.bsize[0]+"px; height:"+this.bsize[1]+"px; text-align:center; left:auto; right:auto; background:none;",s.appendChild(i)),i.style.cssText+=0===t?"float:right;":"float:left;",o++}this.init()}testZone(t){let i=this.local;if(-1===i.x&&-1===i.y)return-1;let s=this.tmpX,e=this.tmpY,h=-1,o=-1,n=-1,r=this.grid[0];for(;r--;)i.x>s[r][0]&&i.x<s[r][1]&&(o=r);for(r=this.grid[1];r--;)i.y>e[r][0]&&i.y<e[r][1]&&(n=r);return-1!==o&&-1!==n&&(h=o+2*n,h>this.lng-1&&(h=-1)),h}mouseup(t){return!!this.isDown&&(this.isDown=!1,-1!==this.res&&(this.value=this.values[this.res],this.send()),this.mousemove(t))}mousedown(t){return!this.isDown&&(this.isDown=!0,this.mousemove(t))}mousemove(t){let i=!1;return this.res=this.testZone(t),-1!==this.res?(this.cursor("pointer"),i=this.modes(this.isDown?3:2,this.res)):i=this.reset(),i}modes(t=1,i=-1){let s,e,h=this.lng,o=!1;for(;h--;)e=t,s=!!this.isSelectable&&this.values[h]===this.value,h===i?s&&2===e&&(e=3):(e=1,s&&(e=4)),this.mode(e,h)&&(o=!0);return o}mode(t,i){let s=!1,e=this.colors,h=this.buttons,o=i;if(this.stat[i]!==t){switch(this.stat[i]=t,t){case 1:h[o].style.color=e.text,h[o].style.background=e.button;break;case 2:h[o].style.color=e.textOver,h[o].style.background=e.overoff;break;case 3:h[o].style.color=e.textOver,h[o].style.background=e.over;break;case 4:h[o].style.color=e.textSelect,h[o].style.background=e.select}s=!0}return s}reset(){return this.res=-1,this.cursor(),this.modes()}label(t,i){this.buttons[i].textContent=t}icon(t,i,s){this.buttons[s].style.padding=(i||0)+"px 0px",this.buttons[s].innerHTML=t}testW(){let t=!1;if(3*this.spaces[0]+2*this.bsizeMax>this.w?(this.bsize[0]=.5*(this.w-3*this.spaces[0]),t=!0):this.bsize[0]!==this.bsizeMax&&(this.bsize[0]=this.bsizeMax,t=!0),!t)return;let i=this.buttons.length;for(;i--;)this.buttons[i].style.width=this.bsize[0]+"px"}rSize(){let t;super.rSize(),this.testW(),this.tmpX=[],this.tmpY=[];for(let i=0;i<this.grid[0];i++)0===i?(t=.5*this.w-.5*this.spaces[0],this.tmpX.push([t-this.bsize[0],t])):(t=.5*this.w+.5*this.spaces[0],this.tmpX.push([t,t+this.bsize[0]]));t=this.spaces[1];for(let i=0;i<this.grid[1];i++)this.tmpY.push([t,t+this.bsize[1]]),t+=this.bsize[1]+this.spaces[1]}}class I extends r{constructor(t={}){super(t),this.autoWidth=!1,this.minw=this.w,this.diam=t.diam||this.w,this.pos=new n(0,0),this.maxPos=90,this.model=t.stype||0,void 0!==t.mode&&(this.model=t.mode),this.min=void 0===t.min?-1:t.min,this.max=void 0===t.max?1:t.max,this.range=.5*(this.max-this.min),this.cmode=0,this.precision=void 0===t.precision?2:t.precision,this.value=Array.isArray(t.value)&&2==t.value.length?t.value:[0,0],this.h=t.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10);let i=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+i.text),this.c[2].textContent=this.value;let s=this.getPad2d();this.setSvg(s,"fill",i.back,0),this.setSvg(s,"fill",i.button,1),this.setSvg(s,"stroke",i.back,2),this.setSvg(s,"stroke",i.back,3),this.setSvg(s,"stroke",i.text,4),this.setSvg(s,"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(s,{width:this.diam,height:this.diam,left:0,top:this.top}),this.c[3]=s,this.init(),this.setValue()}testZone(t){let i=this.local;return-1===i.x&&-1===i.y?"":i.y<=this.c[1].offsetHeight?"title":i.y>this.h-this.c[2].offsetHeight?"text":"pad"}mouseup(t){return this.isDown=!1,this.mode(0)}mousedown(t){if("pad"===this.testZone(t))return this.isDown=!0,this.mousemove(t),this.mode(1)}mousemove(t){if(!this.isDown)return;let i=.5*this.w-(t.clientX-this.zone.x),s=.5*this.diam-(t.clientY-this.zone.y-this.top),e=256/this.diam;i=-i*e,s=-s*e,i=o.clamp(i,-this.maxPos,this.maxPos),s=o.clamp(s,-this.maxPos,this.maxPos),this.setPos([i,s]),this.update(!0)}mode(t){if(this.cmode===t)return!1;let i=this.colors;switch(t){case 0:this.s[2].color=i.text,this.setSvg(this.c[3],"fill",i.back,0),this.setSvg(this.c[3],"fill",i.button,1),this.setSvg(this.c[3],"stroke",i.back,2),this.setSvg(this.c[3],"stroke",i.back,3),this.setSvg(this.c[3],"stroke",i.text,4);break;case 1:this.s[2].color=i.textSelect,this.setSvg(this.c[3],"fill",i.backoff,0),this.setSvg(this.c[3],"fill",i.overoff,1),this.setSvg(this.c[3],"stroke",i.backoff,2),this.setSvg(this.c[3],"stroke",i.backoff,3),this.setSvg(this.c[3],"stroke",i.textSelect,4)}return this.cmode=t,!0}update(t){this.c[2].textContent=this.value,this.updateSVG(),t&&this.send()}updateSVG(){1==this.model&&(this.setSvg(this.c[3],"y1",this.pos.y,2),this.setSvg(this.c[3],"y2",this.pos.y,2),this.setSvg(this.c[3],"x1",this.pos.x,3),this.setSvg(this.c[3],"x2",this.pos.x,3)),this.setSvg(this.c[3],"cx",this.pos.x,4),this.setSvg(this.c[3],"cy",this.pos.y,4)}setPos(t){this.pos.set(t[0]+128,t[1]+128);let i=1/this.maxPos;this.value[0]=(t[0]*i*this.range).toFixed(this.precision),this.value[1]=(t[1]*i*this.range).toFixed(this.precision)}setValue(t,i=!1){void 0===t&&(t=this.value),this.value[0]=1*Math.min(this.max,Math.max(this.min,t[0])).toFixed(this.precision),this.value[1]=1*Math.min(this.max,Math.max(this.min,t[1])).toFixed(this.precision),this.pos.set(this.value[0]/this.range*this.maxPos+128,this.value[1]/this.range*this.maxPos+128),this.update(i)}}const T=function(){let t,i,s=arguments,e=!1,h=null;"string"==typeof s[0]?(t=s[0],i=s[1]||{}):"object"==typeof s[0]&&(e=!0,void 0===s[2]&&[].push.call(s,{}),t=s[2].type?s[2].type:A(s[0][s[1]],s[2]),i=s[2],i.name=s[1],"list"===t?i.list=s[0][s[1]]:i.value=s[0][s[1]]);let o=t.toLowerCase();switch("group"===o&&(i.add=T),o){case"bool":case"boolean":h=new l(i);break;case"button":h=new a(i);break;case"circular":h=new c(i);break;case"color":h=new d(i);break;case"fps":h=new u(i);break;case"graph":h=new p(i);break;case"group":h=new m(i);break;case"joystick":h=new g(i);break;case"knob":h=new x(i);break;case"list":h=new f(i);break;case"numeric":case"number":h=new v(i);break;case"slide":h=new b(i);break;case"textInput":case"string":h=new y(i);break;case"title":case"text":h=new w(i);break;case"select":h=new k(i);break;case"selector":h=new S(i);break;case"empty":case"space":h=new C(i);break;case"item":h=new M(i);break;case"grid":h=new L(i);break;case"pad2d":case"pad":h=new I(i)}if(null!==h)return e&&h.setReferency(s[0],s[1]),h},A=function(t,i){let s="slide";return"boolean"==typeof t?s="bool":"string"==typeof t?s="#"===t.substring(0,1)?"color":"string":"number"==typeof t?s=i.ctype?"color":"slide":"array"==typeof t&&t instanceof Array?"number"==typeof t[0]?s="number":"string"==typeof t[0]&&(s="list"):"object"==typeof t&&t instanceof Object&&(s=void 0!==t.x?"number":"list"),s},z={doc:document,Dom:document.body,frag:document.createDocumentFragment(),icon:o.icon,getImput:o.getImput,css:o.css,basic:o.css.basic,txt:o.css.txt,svgns:"http://www.w3.org/2000/svg",htmls:"http://www.w3.org/1999/xhtml",dom:o.dom,clear:o.clear,setSvg:o.setSvg,hexToHtml:o.hexToHtml,TRACK:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAAUCAYAAAAk0RfcAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAl1JREFUeNrsWkFWwjAQbUJ34AHwALhwiXuee7YegXIALlAOoHtk6dKlHED3cAAvoM+13ZI4rQmmpS1JU1/TMv\n\t\tPe0GRe81+S+ZlMUjwPBaVDQmQhDENuAwTtSaaOeIjXDJ4tWBYD8RCvKTyKmxRKl8SXhbvNZmyFtN2mqoiHeE3g+YXJNWPJG5zSGx27UeIuMKrgHNpSuip9kbG5Dr7al1LMCnh9oQOh/cwzlqeK88gZG0LSeKkchla2fqn1cKbwBPo2g3xgbXCwm2XnPc9HeZjUlYE7IdnJc1jAcYHH+Z\n\t\t+ajTPw9vsVY2xUarPwqbqwYuKlSGpA5hhHVdVHeZjUpdWMpNYNz3wCvyOPkIXX681jPThcL7IH0Padcr4ostVFZhs/5OFkSe0koV3ZJrVSGTcIfQVR7w36GpkzjsS56gfoI5RHhTYDAqta5EuTKJ1HZol/itQ+krllZLYdIuehGGsEBLmI77oI53EuvkvZKpyVXPClj2Q+HzKX+sLzPp\n\t\t3unyZX8B66bcLYALbuaRJRKxJDkgNI/J09BEobPF+het+2s5CPDHFbDls/5LdA5CEUxyI92FljA2l7v3gTwH9QbVAfMyA0MYycRXm00dUd7JZl+XgyJwU7KkbolqUFoEtw9LKWYA+LBPACznkkF4i0QfGFUGqchiT3znVEakFqEzJjhG4Dif/xnCEIe3vKZktqk+icug3JI/WJDyu+6U\n\t\tTWMcE2GNptKV03jRcJ/TrzhWjylfDofc15PyL083RqlZNdh2GqjniI1wQe5tAo3TpEywL+oRzxuoSHgtIJ+RFgALOc3s25JFD0AAAAAElFTkSuQmCC",X0:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKAgMAAADwXCcuAAAACVBMVEVMaXHi4uLi4uLDusitAAAAAnRSTlMAgJsrThgAAAAlSURBVHicYxBgcGBIYZzIIMnmxsAWycnAuIQFjEFskBhIDqgGAGxoBXlOWpMvAAAAAElFTkSuQmCC)",SlideBG:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFAQMAAAC3obSmAAAABlBMVEVMaXH///+a4ocPAAAAAnRSTlMAM8lDrC4AAAASSURBVHicY3BgaGDgYBBgUAAABkIA+fbHMRYAAAAASUVORK5CYII=)",SlideBG_NN:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAALElEQVQImV3MsQ0AIAwDwUsmYTRGyeg0SAi7eekKF8bbwu4ETCdAJ0Ddfr8H+wEEqTj7jz0AAAAASUVORK5CYII=)",FPS:60,frameTime:1/60,frameSize:1,frameMax:1,frameTrack:0,color:{track1:"rgba(128,128,128,1)",track2:"rgba(128,128,128,0.5)",trackover:"rgba(160,220,55,0.5)",time:"rgba(189,65,40,0.75)",timeprev:"rgba(128,128,128,0.75)",timeprevtext:"rgba(180,180,180,1)",timeline:"rgba(128,128,128,1)",select:"#035fcf",key:"rgba(86,175,178,1)",action:"rgba(86,175,178,0.1)"},keyColor:["#6BB","#BB6","#F66"],soundLibs:{},inRange:function(t,i,s,e){return e?t>i&&t<s:t>=i&&t<=s},int:function(t){return Math.floor(t)},liner:function(t,i,s){return i=void 0===i?"rgba(128,128,128,0.5)":i,s=s||1,z.dom("div",z.basic+"width:100%; height:1px; border-top:"+s+"px solid "+i+"; top:"+(t-s)+"px;")},vliner:function(t,i){return void 0===i&&(i="#888"),z.dom("div",z.basic+"width:1px; height:100%; background:"+i+";"+t)},linerBottom:function(t,i,s){void 0===i&&(i="#888"),void 0===s&&(s="#rgba(128,128,128,0.5)");let e=z.dom("div",z.basic+"width:100%; height:"+t+"px; bottom:0; background:none; pointer-events:auto; cursor:row-resize; border-top:1px solid "+s+"; border-bottom:1px solid "+i+";");return z.dom("div",z.basic+"width:100%; height:4px; top:1px; background:"+z.SlideBG,null,e),e.name="scaleBar",e},pins:function(t){let i=~~(.5*(t-10)),s=z.dom("div",z.basic+"width:20px; height:"+t+"px; pointer-events:auto; cursor:pointer;");return z.dom("div",z.basic+"width:10px; height:10px; border-radius:5px; border:2px solid #ccc; top:"+i+"px; left:5px;",null,s),s.name="pins",s},dels:function(t){let i=z.dom("div",z.basic+"width:10px; height:10px; right:5px; top:"+(t||5)+"px; pointer-events:auto; cursor:pointer; background:"+z.X0+";");return i.name="dels",i},saveJson:function(t,s){let e,h={frameMax:t.frameMax,track:{}},o=t.tracks.length;for(let i=0;i<o;i++)e=t.tracks[i],h.track[e.name]={type:e.type,frame:e.getFrame()};let n=JSON.stringify(h,null);if(n=n.replace('"frameMax"','\n"frameMax"'),n=n.replace('"track":{','\n"track":{\n\t\t'),n=n.replace(/}},/g,"}},\n\t\t"),n=n.replace("}}}}","}}\n\t\t}\n}"),s){let t=new Blob([n],{type:"text/plain;charset=utf-8"});i(t,"neo.json")}else t.tmpJSON=n,console.log("timeline in memory")},fromJson:function(t,i){if(void 0===i)return;t.clear();let s,e=JSON.parse(i);for(let i in e.track)s=e.track[i],t.add(s.type,{name:i,frame:s.frame})},loadVideo:function(t,i){let s=document.createElement("VIDEO"),e=document.createElement("source");e.setAttribute("src","./assets/video/"+t),e.setAttribute("type","video/mp4"),s.appendChild(e),s.load(),s.addEventListener("loadeddata",(function(){s.autoplay=!1;let t=Math.floor(s.duration.toFixed(0)*i.frameRate*2);i.totalFrame=Math.floor(s.duration.toFixed(0)*z.FPS),i.reSize(),i.video=s,console.log(i.totalFrame,t);let e=s.videoWidth,h=s.videoHeight;document.body.insertBefore(s,document.body.firstChild),s.style.cssText="pointer-events:none; position:absolute; left:50%; top:50%; width:"+e+"px; height:"+h+"px; margin:"+.5*-h+"px "+.5*-e+"px"}),!1)},Sound:null,loadSound:function(t,i,s){z.Sound||(z.Sound=new(window.AudioContext||window.webkitAudioContext||window.MozAudioContext||window.oAudioContext||window.msAudioContext));let e=t.substring(t.lastIndexOf("/"),t.lastIndexOf("."));if(void 0!==z.soundLibs[e])return null!==i&&z.makeSoundKey(e,i),void(void 0!==s&&s());let h=new XMLHttpRequest;h.open("GET","./assets/sound/"+t,!0),h.responseType="arraybuffer",h.onload=function(t){z.Sound.decodeAudioData(h.response,(function(t){z.soundLibs[e]={imgs:z.soundToImg(z.soundPeaks(t,!0)),totalFrame:Math.round(60*t.duration),buffer:t},console.log("loading sound: "+e),null!==i&&z.makeSoundKey(e,i),void 0!==s&&s()}))},h.onerror=function(t){console.log(t)},h.send()},makeSoundKey:function(t,i){z.clear(i.key);let s=z.soundLibs[t];for(let t=0;t<s.imgs.length;t++)i.key.appendChild(s.imgs[t].cloneNode());i.totalFrame=s.totalFrame,i.buffer=s.buffer,i.reSize()},soundPeaks:function(t,i){let s=Math.round(60*t.duration),e=t.length/s,h=Math.floor(.1*e)||1,o=t.numberOfChannels,n=[],r=[];for(let i=0;i<o;i++){let o=n[i]=[],l=t.getChannelData(i);for(let t=0;t<s;t++){let s=Math.floor(t*e),n=Math.floor(s+e),a=0;for(let t=s;t<n;t+=h){let i=l[t];i>a?a=i:-i>a&&(a=-i)}o[t]=a,(0==i||a>r[t])&&(r[t]=a)}}return i?n:r},soundToImg:function(t,i){let s=[],e=t[0],h=t[1],o=void 0===h,n=e.length,r=Math.floor(n/500),l=n-500*r,a=1/n,c=5e4*a,d=100*l*a,u=document.createElement("canvas");u.height=100,u.width=500;let p=document.createElement("canvas");p.height=100,p.width=l;let m,g,x,f,v,b,y=["rgba(86,175,178,0.3)","rgba(86,175,178,0.75)"],w=u.getContext("2d"),k=p.getContext("2d"),S=0,C=o?50:25;for(m=0;m<=r;m++){for(x=500,m===r&&(x=l,c=d,u=p,w=k),w.clearRect(0,0,500,100),w.beginPath(),g=0;g<x;g++)v=Math.round(e[g+S]*C),w.fillStyle=y[0],w.fillRect(g,C-v,1,2*v),w.fillStyle=y[1],w.fillRect(g,C-v,1,1),w.fillRect(g,C+v,1,1),o||(b=Math.round(h[g+S]*C),w.fillStyle=y[0],w.fillRect(g,75-b,1,2*b),w.fillStyle=y[1],w.fillRect(g,75-b,1,1),w.fillRect(g,75+b,1,1));S+=500,f=document.createElement("img"),f.src=u.toDataURL(),f.style.cssText="image-rendering:pixelated; pointer-events:none; position:relative; width:"+c+"%; height:100%; display:inline-block; ",s.push(f)}return w=null,u=null,s}},P={PI:3.141592653589793,PI90:1.570796326794896,PI270:4.712388980384689,TwoPI:6.283185307179586,degtorad:.017453292519943295,radtodeg:57.29577951308232,sqrt:Math.sqrt,abs:Math.abs,max:Math.max,pow:Math.pow,floor:Math.floor,round:Math.round,asin:Math.asin,sin:Math.sin,cos:Math.cos,lerp:function(t,i,s){return(1-s)*t+s*i},randInt:function(t,i){return t+P.floor(P.random()*(i-t+1))},rand:function(t,i){return t+P.random()*(i-t)},int:function(t){return P.floor(t)},fix:function(t,i){return 1*t.toFixed(i||0)},seed:function(t){return function(){return(t=1e4*P.sin(t))-P.floor(t)}},ARRAY32:"undefined"!=typeof Float32Array?Float32Array:Array,ARRAY8:"undefined"!=typeof Uint8Array?Uint8Array:Array,Tween:function(t,i,s,e,h,o){var n=(e-h)/(o-h);n=n>1?1:n;var r=P.Ease[s](n);return t>i?t-(t-i)*r:t+(i-t)*r},Ease:{getNum:function(t){var i;switch(t.substring(0,4)){case"quad":case"cubi":case"quar":case"quin":case"sine":i=7;break;case"expo":case"back":case"elas":i=11;break;case"circ":case"boun":i=21}return i},linear:function(t){return t},"quad-in":function(t){return t*t},"quad-out":function(t){return t*(2-t)},"quad-in-out":function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},"cubic-in":function(t){return t*t*t},"cubic-out":function(t){return--t*t*t+1},"cubic-in-out":function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},"quart-in":function(t){return t*t*t*t},"quart-out":function(t){return 1- --t*t*t*t},"quart-in-out":function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},"quint-in":function(t){return t*t*t*t*t},"quint-out":function(t){return--t*t*t*t*t+1},"quint-in-out":function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},"sine-in":function(t){return 1-P.cos(t*P.PI90)},"sine-out":function(t){return P.sin(t*P.PI90)},"sine-in-out":function(t){return.5*(1-P.cos(P.PI*t))},"expo-in":function(t){return 0===t?0:P.pow(1024,t-1)},"expo-out":function(t){return 1===t?1:1-P.pow(2,-10*t)},"expo-in-out":function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*P.pow(1024,t-1):.5*(2-P.pow(2,-10*(t-1)))},"circ-in":function(t){return 1-P.sqrt(1-t*t)},"circ-out":function(t){return P.sqrt(1- --t*t)},"circ-in-out":function(t){return(t*=2)<1?-.5*(P.sqrt(1-t*t)-1):.5*(P.sqrt(1-(t-=2)*t)+1)},"elastic-in":function(t){var i,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=.4*P.asin(1/s)/P.TwoPI,-s*P.pow(2,10*(t-=1))*P.sin((t-i)*P.TwoPI/.4))},"elastic-out":function(t){var i,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=.4*P.asin(1/s)/P.TwoPI,s*P.pow(2,-10*t)*P.sin((t-i)*P.TwoPI/.4)+1)},"elastic-in-out":function(t){var i,s=.1,e=.4;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=e*P.asin(1/s)/P.TwoPI,(t*=2)<1?s*P.pow(2,10*(t-=1))*P.sin((t-i)*P.TwoPI/e)*-.5:s*P.pow(2,-10*(t-=1))*P.sin((t-i)*P.TwoPI/e)*.5+1)},"back-in":function(t){var i=1.70158;return t*t*((i+1)*t-i)},"back-out":function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},"back-in-out":function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},"bounce-in":function(t){return 1-this["bounce-out"](1-t)},"bounce-out":function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},"bounce-in-out":function(t){return t<.5?.5*this["bounce-in"](2*t):.5*this["bounce-out"](2*t-1)+.5}},hexToHtml:function(t){return"#"+("000000"+(t=void 0===t?0:t).toString(16)).substr(-6)},numToHex:function(t){return t||(t=0),"0x"+("000000"+t.toString(16)).substr(-6)},hexFormat:function(t){return t.toUpperCase().replace("#","0x")},lerpColor:function(t,i,s){var e=[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255],h=[(i>>16&255)/255,(i>>8&255)/255,(255&i)/255];return e[0]+=(h[0]-e[0])*s,e[1]+=(h[1]-e[1])*s,e[2]+=(h[2]-e[2])*s,255*e[0]<<16^255*e[1]<<8^255*e[2]<<0},invertColor:function(t){return 16777215^t},Sine:function(t,i,s,e){return P.sin(s*t+i*P.degtorad)*e},computeControlPoints:function(t,i){var s,e,h=[],o=[],n=[],r=[],l=[],a=[],c=t.length-1;for(n[0]=0,r[0]=2,l[0]=1,a[0]=t[0]+2*t[1],s=1;s<c-1;s++)n[s]=1,r[s]=4,l[s]=1,a[s]=4*t[s]+2*t[s+1];for(n[c-1]=2,r[c-1]=7,l[c-1]=0,a[c-1]=8*t[c-1]+t[c],s=1;s<c;s++)e=n[s]/r[s-1],r[s]-=e*l[s-1],a[s]-=e*a[s-1];for(h[c-1]=P.fix(a[c-1]/r[c-1],i),s=c-2;s>=0;s--)h[s]=P.fix((a[s]-l[s]*h[s+1])/r[s],i);for(s=0;s<c-1;s++)o[s]=P.fix(2*t[s+1]-h[s+1],i);return o[c-1]=P.fix(.5*(t[c]+h[c-1]),i),[h,o]}};class E{constructor(t){this.grad3=new P.ARRAY32([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6;let i,s=Math.random;if(t){let i=P.seed(t),e=P.seed(i());s=P.seed(e())}for(this.p=new P.ARRAY8(256),this.perm=new P.ARRAY8(512),this.permMod12=new P.ARRAY8(512),i=0;i<256;i++)this.p[i]=256*s();for(i=0;i<512;i++)this.perm[i]=this.p[255&i],this.permMod12[i]=this.perm[i]%12}noise(t,i){let s,e,h=this.permMod12,o=this.perm,n=this.grad3,r=0,l=0,a=0,c=(t+i)*this.F2,d=Math.floor(t+c),u=Math.floor(i+c),p=(d+u)*this.G2,m=t-(d-p),g=i-(u-p);m>g?(s=1,e=0):(s=0,e=1);let x=m-s+this.G2,f=g-e+this.G2,v=m-1+2*this.G2,b=g-1+2*this.G2,y=255&d,w=255&u,k=.5-m*m-g*g;if(k>=0){let t=3*h[y+o[w]];k*=k,r=k*k*(n[t]*m+n[t+1]*g)}let S=.5-x*x-f*f;if(S>=0){let t=3*h[y+s+o[w+e]];S*=S,l=S*S*(n[t]*x+n[t+1]*f)}let C=.5-v*v-b*b;if(C>=0){let t=3*h[y+1+o[w+1]];C*=C,a=C*C*(n[t]*v+n[t+1]*b)}return 70*(r+l+a)}}class D{constructor(t){this.parent=t,this.content=z.dom("div",z.basic+"top:0; left:0; width:400px; height:20px; display:none; pointer-events:auto; overflow:visible; "),this.content.name="pannel",this.parent.content.appendChild(this.content),this.key=null,this.type="",this.init()}init(){let t=19,i={color:T("color",{target:this.content,callback:null,name:" ",color:"n",w:100,pos:{left:"10px",top:"0px"},simple:!0,side:"down",ctype:"hex",h:t}),curve1:T("list",{target:this.content,list:["linear","quad","cubic","quart","quint","sine","expo","circ","elastic","back","bounce"],w:80,pos:{left:"10px",top:"0px"},simple:!0,side:"down",full:!0,h:t,align:"left"}),curve2:T("list",{target:this.content,list:["-in","-out","-in-out"],w:80,pos:{left:"92px",top:"0px"},simple:!0,side:"down",full:!0,h:t,align:"left"}),lfo1:T("list",{target:this.content,list:["sine","noise"],w:80,pos:{left:"10px",top:"0px"},simple:!0,side:"down",full:!0,h:t,align:"left"}),lfo2:T("number",{target:this.content,name:"frequency",min:0,max:1,value:0,precision:2,pos:{left:"92px",top:"0px"},w:124,p:60,h:t}),lfo3:T("number",{target:this.content,name:"amplitude",min:0,max:1,value:0,precision:2,pos:{left:"210px",top:"0px"},w:124,p:60,h:t}),lfo4:T("number",{target:this.content,name:"seed",min:0,max:999,value:0,precision:0,pos:{left:"336px",top:"0px"},w:100,p:50,h:t}),lfo5:T("number",{target:this.content,name:"phase",min:0,max:360,value:0,precision:0,pos:{left:"336px",top:"0px"},w:100,p:50,h:t})};this.pannels=i,this.hideAll()}resize(t,i){this.content.style.left=t+120+"px",this.content.style.width=i-120+"px"}move(){if(null===this.key)return;let t=this.key.parent.top-this.parent.box.t,i=this.parent.isInView(t);this.display(i),i&&(this.content.style.top=t+"px")}setKey(t){this.key=t,this.type=t.parent.type,this.move(),this.hideAll();let i,s,e,h,o,n=this.pannels;switch(n.color.needZone(),this.type){case"color":i=n.color,i.display(!0),i.onChange(function(t){this.key.setColor(t)}.bind(this)),i.setValue(P.hexToHtml(this.key.value)),i.close();break;case"curve":this.key.getType(),i=n.curve1,s=n.curve2,i.display(!0),i.text(this.key.name),i.onChange(function(t){this.key.setType(t),this.testEase(t,this.key.ext)}.bind(this)),s.onChange(function(t){this.key.setExt(t)}.bind(this)),this.testEase(this.key.name,this.key.ext);break;case"lfo":i=n.lfo1,s=n.lfo2,e=n.lfo3,h=n.lfo4,o=n.lfo5,i.display(!0),s.display(!0),e.display(!0),i.text(this.key.curve),s.setValue(this.key.frequency),e.setValue(this.key.amplitude),h.setValue(this.key.seed),o.setValue(this.key.phase),i.onChange(function(t){this.key.setValue(t,"curve"),this.testLfo(t)}.bind(this)),s.onChange(function(t){this.key.setValue(t,"frequency")}.bind(this)),e.onChange(function(t){this.key.setValue(t,"amplitude")}.bind(this)),h.onChange(function(t){this.key.setValue(t,"seed")}.bind(this)),o.onChange(function(t){this.key.setValue(t,"phase")}.bind(this)),this.testLfo(this.key.curve)}}testLfo(t){let i=this.pannels;"noise"===t?(i.lfo4.display(!0),i.lfo5.display()):(i.lfo4.display(),i.lfo5.display(!0))}testEase(t,i){const s=this.pannels;"linear"===t?s.curve2.display():(s.curve2.display(!0),s.curve2.text(i))}hideAll(){for(let t in this.pannels)this.pannels[t].display()}display(t){null===this.key&&(t=!1),this.content.style.display=t?"block":"none"}clear(){this.key=null,this.type=""}}class F{constructor(t){this.parent=null,this.value=1,this.co=z.keyColor,this.select=!1,this.frame=t,this.df=0,this.first=!1,this.cct="background";const i=z.dom,s=z.basic;this.w=1,this.content=i("div",s+"width:1px; height:100%; left:0px; top:0; overflow:visible;"),this.key=i("div",s+"width:100%; height:100%; opacity:0.5; left:0; top:0; pointer-events:auto; cursor:ew-resize; background:"+this.co[0]),this.content.appendChild(this.key),this.ks=this.key.style,this.cs=this.content.style,this.key.name="key"}selected(){this.select=!0,this.ks[this.cct]=this.co[1],this.parent.parent.showPannel(this)}unSelected(){this.select=!1,this.ks[this.cct]=this.co[0]}getValue(){return this.value}getID(){return this.key.id}setID(t){this.key.id=t}over(){this.ks[this.cct]=this.select?this.co[2]:this.co[1]}out(){this.ks[this.cct]=this.select?this.co[2]:this.co[0]}mmove(t){}down(t){}up(t){}clear(){z.clear(this.content),this.content=null}move(t){this.first&&(this.first=!1,this.df=t-this.frame),t=(t-=this.df)<0?0:t;let i=this.parent.frame[t];void 0!==i&&i!==this.key.id&&(t=this.frame),this.ks[this.cct]=this.co[2],this.frame=t,this.l=Math.floor(this.frame*this.w),this.cs.left=this.l+"px"}reSize(t){this.w=void 0===t?this.w:t,this.l=Math.floor(this.frame*this.w),this.sx=Math.floor(this.w),this.sx=this.sx<6?6:this.sx,this.cs.width=this.sx+"px",this.cs.left=this.l+"px"}getX(){return this.l+.5*this.w}}class R extends F{constructor(t,i){super(t),this.value=i||"",this.flagName=T("string",{target:this.content,value:this.value,w:80,h:18,simple:!0,allway:!0,pos:{left:this.w+"px",top:"0px"}}).onChange(function(t){this.value=t,this.parent.showUpdate()}.bind(this))}clear(){this.flagName.clear(),super.clear()}reSize(t){super.reSize(t),this.flagName.c[0].style.left=this.sx+"px"}setPy(t){this.flagName.c[0].style.top=18*t+"px"}}class N extends F{constructor(t,i){super(t),this.value=void 0===i?255:i,this.ks.background="none",this.ks.width="16px",this.ks.marginLeft="-8px",this.ks.left="50%",this.ks.borderRadius="7px",this.ks.boxShadow="0 0 0 1px "+P.hexToHtml(P.invertColor(this.value)),this.ks.border="4px solid "+this.co[0],this.cct="borderColor"}setColor(t){this.value=P.numToHex(t),this.ks.boxShadow="0 0 0 1px "+P.hexToHtml(P.invertColor(this.value)),this.parent.sort(!0)}}class H extends F{constructor(t,i={},s){super(t),i=i||[],this.pos=i[0]||0,this.ease=i[1]||"linear",this.level=s,this.py=0,this.ext="",this.name="",this.ks.width="16px",this.ks.height="16px",this.ks.marginLeft="-8px",this.ks.marginTop="-8px",this.ks.left="50%",this.ks.borderRadius="7px",this.ks.cursor="move",this.ks.border="3px solid "+this.co[0],this.cct="borderColor",this.ks.background="none",this.color=["#F33","#3F3","#59F","#F95"],this.point=z.dom("div",z.basic+"top:50%; left:50%; margin-left:-3px; margin-top:-3px; border-radius:3px; width:6px; height:6px; background:"+this.color[this.level],null,this.key)}getValue(){return[this.pos,this.ease]}pcolor(t){this.point.style.background=t}clear(){this.key.removeChild(this.point),super.clear()}setY(){this.py=this.parent.yFromPos(this.pos),this.ks.top=~~this.py+"px"}getLastX(t){return Math.floor(t*this.w+.5*this.w)}getY(){return this.py}setAxe(){let t=0;return"y"===this.axe&&(t=1),"z"===this.axe&&(t=2),"w"===this.axe&&(t=3),t}getType(){let t=this.ease,i=t.length;"-in-out"===t.substring(i-7)?(this.name=t.substring(0,i-7),this.ext="-in-out"):"-in"===t.substring(i-3)?(this.name=t.substring(0,i-3),this.ext="-in"):"-out"===t.substring(i-4)?(this.name=t.substring(0,i-4),this.ext="-out"):(this.name=t,this.ext="")}setType(t){this.name=t,this.setEase()}setExt(t){this.ext=t,this.setEase()}setEase(){"linear"===this.name?this.ease=this.name:(""===this.ext&&(this.ext="-in"),this.ease=this.name+this.ext),this.parent.currentLevel=this.level,this.parent.sort(!0)}move(t,i){let s=0;this.first&&(this.first=!1,this.parent.currentLevel=this.level,s=i-this.py,this.df=t-this.frame);let e=this.parent.frame[this.level][t];void 0!==e&&e!==this.key.id&&(t=this.frame),this.ks[this.cct]=this.co[2],this.frame=t-this.df,this.l=~~(this.frame*this.w),this.content.style.left=this.l+"px",this.py=i-s,this.pos=this.parent.posFromY(this.py),this.ks.top=~~this.py+"px"}getID(t){return this.key.id}getLevel(t){return this.key.level}setID(t,i){this.key.id=t,this.level=i,this.key.level=i}}class O extends F{constructor(t,i){super(t),this.end=i||t+1,this.dragtype=0,this.decal=0,this.min=0,this.max=1,this.ks.borderLeft="1px solid #FFF",this.ks.borderRight="1px solid #FFF"}getValue(){return this.end}reSize(t){super.reSize(t),this.reSizeLength()}reSizeLength(){this.lng=this.end-this.frame,this.ks.width=Math.floor(this.w*(this.lng+1))+"px"}over(){let t=this.parent.parent.framePrev;z.inRange(t,this.frame+2,this.end-2)?this.ks.cursor="ew-resize":this.ks.cursor="col-resize",super.over()}move(t,i){let s=this.parent;switch(this.first&&(this.max=s.parent.frameMax-1,t<this.frame+2?this.dragtype=0:t>this.end-2?this.dragtype=1:this.dragtype=2,i&&(this.dragtype=i),this.decal=t-this.frame,s.reset(this.frame),void 0!==s.next&&(this.max=s.items[s.next].frame-1),void 0!==s.prev&&(this.min=s.items[s.prev].end+1),this.first=!1),this.ks[this.cct]=this.co[2],this.dragtype){case 1:t=t<this.frame+1?this.frame+1:t,this.end=t>this.max?this.max:t,this.reSizeLength();break;case 2:this.frame=t-this.decal,this.frame=this.frame<0?0:this.frame,this.frame=this.frame<this.min?this.min:this.frame,this.frame=this.frame+this.lng>this.max?this.max-this.lng:this.frame,this.end=this.frame+this.lng,this.l=Math.floor(this.frame*this.w),this.content.style.left=this.l+"px";break;default:t=(t=t>this.end-1?this.end-1:t)<this.min?this.min:t,F.prototype.move.call(this,t),this.reSizeLength()}}}class B extends O{constructor(t,i=[],s){super(t),this.end=i[0]||t+1,this.value=i[1]||s,this.dragtype=0,this.decal=0,this.min=0,this.max=z.frameMax-1,this.ks.borderLeft="1px solid #FFF",this.ks.borderRight="1px solid #FFF",z.dom("div",z.basic+"top:1px; left:1px; right:1px; bottom:1px;\tbackground:"+z.SlideBG_NN,null,this.key),this.flagName=T("string",{target:this.content,value:this.value,w:80,h:18,simple:!0,allway:!0,pos:{left:this.w+"px",top:"0px"}}).onChange(function(t){this.value=t}.bind(this))}clear(){this.flagName.clear(),super.clear()}getValue(t){return[this.end,this.value]}}class U extends F{constructor(t,i=[]){super(t),this.curve=i[0]||"sine",this.frequency=i[1]||.1,this.amplitude=i[2]||1,this.phase=i[3]||0,this.seed=i[4]||0,this.perlin=null,"noise"===this.curve&&this.getPerlin()}getPerlin(){return null===this.perlin&&(this.perlin=new E(this.seed)),this.perlin}getValue(){return[this.curve,this.frequency,this.amplitude,this.phase,this.seed]}setValue(t,i){this[i]=t,"noise"!==i&&"seed"!==i||(this.perlin=new E(this.seed)),this.parent.draw()}}class G extends R{constructor(t,i){super(t,i),this.totalFrame=0,this.buffer=null,this.source=null,this.key.style.borderLeft="1px solid "+this.co[0],this.key.style.borderRight="1px solid "+this.co[0],this.cct="borderColor",this.key.style.background="none",this.flagName.onChange(function(t){this.value=t,z.loadSound(this.value,this)}.bind(this)),this.value&&z.loadSound(this.value,this)}play(t){t>=this.frame&&t<this.frame+this.totalFrame&&null===this.source&&this.connect(t)}stop(){null!==this.source&&(this.source.stop(0),this.source=null)}connect(t){if(!this.buffer)return;this.source=z.Sound.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(z.Sound.destination);let i=this.frame*this.parent.parent.frameTime,s=(t-this.frame)*this.parent.parent.frameTime;this.source.start(i,s)}clear(){this.flagName.clear(),super.clear()}reSize(t){super.reSize(t),this.flagName.c[0].style.left=this.sx+"px";let i=~~(this.w*this.totalFrame);this.key.style.width=i+2+"px"}}class Z extends R{constructor(t,i=[]){super(t),this.name=i[0]||"",this.frameRate=i[1]||24,this.totalFrame=0,this.video=null,this.inPlay=!1,this.ks.borderLeft="1px solid "+this.co[0],this.ks.borderRight="1px solid "+this.co[0],this.cct="borderColor",this.flagName=T("string",{target:this.content,value:this.name,w:80,h:18,simple:!0,pos:{left:this.w+"px",top:"0px"}}).onChange(function(t){this.name=t,z.loadVideo(this.name,this)}.bind(this)),this.name&&z.loadVideo(this.name,this)}getValue(){return[this.name,this.frameRate]}seek(t){null!==this.video&&(this.video.paused||this.video.pause(),t>=this.frame&&t<this.frame+this.totalFrame&&(this.video.currentTime=(t-this.frame)*this.parent.parent.frameTime+1e-5,Number(this.getFrame())))}getFrame(){if(null!==this.video)return 2*Math.floor(this.video.currentTime.toFixed(5)*this.frameRate)}play(t){t>=this.frame&&t<this.frame+this.totalFrame&&(this.inPlay||(this.inPlay=!0,this.video.play()))}stop(){null!==this.video&&(this.inPlay=!1,this.video.pause())}clear(){this.flagName.clear(),super.clear()}reSize(t){super.reSize(t),this.flagName.c[0].style.left=this.sx+"px";let i=~~(this.w*this.totalFrame);this.ks.width=i+2+"px"}}class V{constructor(t={},i){this.parent=i,this.autoName=void 0===t.name,this.name=t.name||this.type,this.select=!1,this.ready=!1,this.w=10,this.maxw=200,this.fulloverkey=!1,this.isOver=!1,this.overid=-1,this.overitem=null,this.isNameEdit=!1,this.acolor=z.color.action,this.drag=!1,this.current=null,this.tmpName=null,this.id=0,this.loadframe=t.frame||{},this.items=[],this.frame={},this.lng=0,this.show=!0,this.needPrev=!1,this.needNext=!1,this.needTop=!0,this.needTimer=!1,this.isMedia=!1,this.timer=null,this.drawdelay=null,this.top=0,this.tt=20,this.tb=8,this.h=50,this.oldH=50,this.tmpPool=[],this.callback=null;let s=z.int(.5*(this.tt-10));this.target=void 0===t.target?void 0:t.target;const e=[],h=z.dom,o=z.basic;z.txt;let n=z.color.track1,r=z.color.track2;e[0]=h("div",o+"position:relative; overflow:hidden;pointer-events:auto;"),e[1]=h("div",z.css.txtselect+"left:20px; height:16px; top:2px; pointer-events:auto; cursor:pointer; border-color:transparent; "),e[2]=z.liner(this.tt,r),e[3]=z.pins(this.tt),e[4]=z.dels(s),e[5]=h("div",o+"top:"+this.tt+"px; left:0; width:100px; height:60px; overflow:hidden; pointer-events:auto; cursor:pointer; "),e[6]=z.linerBottom(this.tb,n,r),e[7]=h("div",o+"height:"+this.tt+"px;\twidth:100%; overflow:hidden; border-left:1px solid #555; border-right:1px solid #555; display:none;"),e[1].name="trackTitle",this.tmpName=null,this.c=e}getFrame(){let t={},i=this.items.length;for(let s=0;s<i;s++)t[this.items[s].frame]=this.items[s].getValue();return t}init(){let t=[];t[0]=this.c[0].style,t[0].height=this.h+"px";const i=z.frag;let s=this.c.length;for(;s--&&s;)i.appendChild(this.c[s]),t[s]=this.c[s].style;this.c[1].textContent=this.name,this.c[1].name="title",this.c[5].name=this.type,this.c[6].id=this.id,this.c[1].id=this.id,this.c[0].appendChild(i),this.s=t,this.addFrame(),this.setHeight(),this.rightExtra(),this.ready=!0}rightExtra(){switch(this.type){case"bang":case"switch":break;case"color":this.preview=T("color",{target:this.c[0],name:" ",pos:{left:"auto",right:"30px",top:"0px"},simple:!0,side:"down",ctype:"hex",w:20,h:19,radius:20,lock:!0,notext:!0})}}draw(){}showHide(){this.show?this.close():this.open()}editName(){this.isNameEdit||(this.parent.stopEditName(),this.tmpName||(this.tmpName=T(this,"name",{type:"string",target:this.c[0],w:100,simple:!0,allway:!0,pos:{left:"20px",top:"0px"}}),this.tmpName.c[0].name="title"),this.tmpName.display(!0),this.s[1].display="none",this.isNameEdit=!0)}endEditName(){this.isNameEdit&&(this.isNameEdit=!1,this.tmpName.display(),this.tmpName.onChange(),this.autoName=!1,this.c[1].textContent=this.name,this.s[1].display="flex")}selected(){this.select=!0,this.s[1].color="#CC0",this.show||(this.c[3].childNodes[0].style.background="#CC0"),this.c[3].childNodes[0].style.borderColor="#CC0",this.s[7].display="block"}unSelected(){this.select=!1,this.s[1].color="#CCC",this.show||(this.c[3].childNodes[0].style.background="#CCC"),this.c[3].childNodes[0].style.borderColor="#CCC",this.s[7].display="none"}update(t){this.v=this.frame[t],void 0!==this.v&&(this.needPrev&&(this.prev=this.v),this.needNext&&(this.next=this.v<this.lng-1?this.v+1:void 0))}reset(t){let i=this.resetLevel(t,this.frame,this.lng);this.prev=i[0],this.next=i[1]}resetLevel(t,i,s){let e,h,o,n,r=i[t];if(void 0!==r)e=r>0?r-1:void 0,h=r+1<s?r+1:void 0;else{if(!this.needPrev&&!this.needNext)return[];if(n=Object.keys(i),this.needPrev&&t>n[0])for(o=t;void 0===e;)o--,e=i[o];if(this.needNext&&t<n[s-1])for(o=t;void 0===h;)o++,h=i[o]}return[e,h]}setHeight(t){t&&(this.h=t),this.oldH=this.h,this.s[0].height=this.h+"px",this.s[5].height=this.h-this.tt-this.tb+"px",this.changeHeight()}applyHeight(){this.s[0].height=this.h+"px",this.parent.calc()}changeHeight(){}rename(t){this.id=t,this.c[6].id=this.id,this.c[1].id=this.id,this.autoName&&(this.name=this.type+this.id,this.c[1].textContent=this.name)}open(){this.show=!0,this.h=this.oldH,this.c[3].childNodes[0].style.background="none",this.s[5].display="block",this.s[6].display="block",this.s[2].display="block",this.s[6].borderTopColor=z.color.trackover,this.s[6].pointerEvents="auto",this.applyHeight()}close(){this.show=!1,this.h=this.tt+2,this.select?this.c[3].childNodes[0].style.background="#CC0":this.c[3].childNodes[0].style.background="#CCC",this.s[5].display="none",this.s[2].display="none",this.s[6].borderTopColor="transparent",this.s[6].pointerEvents="none",this.applyHeight()}syncroTrack(t,i){this.s[5].left=-t+"px",i&&(this.maxw=i,this.w=this.parent.frameSize,this.s[5].width=i+"px",this.setSize())}setID(t){this.id=t,this.c[6].id=this.id,this.c[1].id=this.id}clear(){z.clear(this.c[0]),void 0!==this.target&&this.target.removeChild(this.c[0]),this.parent.remove(this.id),this.c=null,this.target=void 0}keyOver(t,i){this.fulloverkey&&this.overitem&&this.overitem.over(),this.overid!==t&&(this.overid=t,this.overitem&&(this.overitem.out(),this.overitem=null),-1!==t&&(this.overitem=void 0!==i?this.items[i][t]:this.items[t],this.overitem.over()))}unselectKey(){null!==this.current&&(this.current.unSelected(),this.current=null)}selectKey(t){return this.parent.unselectKey(),this.items[t].selected(),this.items[t]}unselectAllKey(){let t=this.items.length;for(;t--;)this.items[t].unSelected()}setSize(){let t=this.items.length;for(;t--;)this.items[t].reSize(this.w);"lfo"!==this.type&&"audio"!==this.type||this.draw()}addFrame(){let t,i=this.loadframe;if(this.isAudio)this.addFrameOnLoad();else{for(t in i)this.addItem(parseInt(t),i[t]);this.sort()}}addFrameOnLoad(){let t,i=this.loadframe;for(t in this.tmpPool=[],i)-1===this.tmpPool.indexOf(i[t])&&this.tmpPool.push(i[t]);this.callback=function(){this.load_next()}.bind(this),this.load(this.tmpPool[0])}load(t){this.isAudio&&z.loadSound(t,null,this.callback)}load_next(){if(this.tmpPool.shift(),0===this.tmpPool.length){this.callback=null;let t,i=this.loadframe;for(t in i)this.addItem(parseInt(t),i[t]);this.sort()}else this.load(this.tmpPool[0])}addItem(t,i,s){let e,h=this.type[0].toUpperCase()+this.type.slice(1);switch("Bang"===h&&(h=""),"Curve"===h&&(s=void 0===s?this.currentLevel:s),"Module"===h&&(s=this.name),h){case"Flag":e=new R(t,i,s);break;case"Color":e=new N(t,i,s);break;case"Curve":e=new H(t,i,s);break;case"Switch":e=new O(t,i,s);break;case"Module":e=new B(t,i,s);break;case"Lfo":e=new U(t,i,s);break;case"Audio":e=new G(t,i,s);break;case"Video":e=new Z(t,i,s);break;default:e=new F(t,i,s)}return e.parent=this,e.reSize(this.parent.frameSize),this.c[5].appendChild(e.content),"Curve"===h?(1===this.nAxe&&e.pcolor(z.color.key),this.items[s].push(e)):this.items.push(e),e}removeID(t,i){let s=void 0!==i?this.items[i]:this.items;this.c[5].removeChild(s[t].content),s[t].clear(),s.splice(t,1),this.sort(!0)}sort(t){this.items.sort((function(t,i){return t.frame-i.frame})),this.lng=this.items.length;let i,s=this.lng,e={};for(;s--;)i=this.items[s],i.setID(s),e[i.frame]=s;this.frame=e,this.draw(),t&&this.showUpdate()}showUpdate(){this.parent.isPlay||this.parent.goTo()}over(t){let i=t.target.name;if(void 0!==i)if("key"===i.substring(0,3)){let i,s=t.target.id;"curve"===this.type&&(i=t.target.level),this.keyOver(s,i)}else this.keyOver(-1);this.isOver||(this.isOver=!0,this.s[0].background="rgba(0,0,0,0.1)",this.show&&(this.s[2].borderTopColor=z.color.trackover,this.s[6].borderTopColor=z.color.trackover,this.s[5].boxShadow="inset 0 0 3px rgba(0,0,0,0.5)"))}out(t){this.isOver&&(this.isOver=!1,this.s[0].background="none",this.show&&(this.s[2].borderTopColor=z.color.track2,this.s[6].borderTopColor=z.color.track2,this.s[5].boxShadow="none"))}up(t){let i=t.target.name;void 0!==i&&"title"===i||this.endEditName(),this.drag&&(this.drag=!1,this.s[5].cursor="pointer",this.sort(!0))}down(t){if(!this.isOver)return;let i=t.which,s=t.target.name,e=this.parent.framePrev;if(this.endEditName(),this.parent.selected(this),void 0!==s)switch(s="key"===s.substring(0,3)?"key":s,s){case"pins":this.show?this.close():this.open();break;case"dels":this.clear();break;case"title":this.editName();break;case"key":let s,h=t.target.id;"curve"===this.type&&(s=t.target.level),1===i&&(this.current=this.selectKey(h,s),null!==this.current&&(this.current.first=!0,this.drag=!0,this.move(t))),3===i&&this.removeID(h,s);break;case this.type:if(1===i){if(void 0!==this.frame[e])return;let i=this.addItem(e);"curve"===this.type&&(i.py=t.clientY-(this.top+this.tt)),this.sort(!0),this.current=this.selectKey(i.getID()),this.current.first=!0,this.drag=!0,this.move(t,1)}}}move(t,i){if(!this.drag||null===this.current)return;let s=this.parent.framePrev;if("curve"===this.type){this.s[5].cursor="all-scroll";let i=t.clientY-(this.top+this.tt);this.current.move(s,i)}else this.s[5].cursor="e-resize",this.current.move(s,i);this.needTimer&&(clearTimeout(this.timer),this.timer=setTimeout(this.sort.bind(this),0,!0))}}class j extends V{constructor(t={},i){super(t,i),this.type="bang",this.init()}update(t){let i=void 0!==this.frame[t];return(this.select||this.parent.fullActve)&&(this.s[5].background=i?this.acolor:"none"),i}}class Y extends V{constructor(t={},i){super(t,i),this.type="flag",this.needPrev=!0,this.h=84,this.hmax=Math.floor((this.h-this.tt-this.tb)/18)-1,this.init()}update(t){super.update(t);let i=void 0===this.v?"":this.items[this.v].value;return i||(i=void 0===this.prev?"":this.items[this.prev].value),(this.select||this.parent.fullActve)&&(this.c[5].style.background=void 0!==this.v?this.acolor:"none"),i}draw(){let t=0,i=this.items.length;for(let s=0;s!==i;s++)this.items[s].setPy(t),t<this.hmax?t++:t=0}changeHeight(){this.hmax=Math.floor((this.h-this.tt-this.tb)/18)-1,this.draw()}}class X extends V{constructor(t={},i){super(t,i),this.type="switch",this.needPrev=!0,this.fulloverkey=!0,this.init()}update(t){super.update(t);let i=void 0!==this.v,s=this.items[this.prev];return void 0!==s&&(i=t<=s.end||i),(this.select||this.parent.fullActve)&&(this.c[5].style.background=i?this.acolor:"none"),i}}class q extends V{constructor(t={},i){super(t,i),this.type="module",this.needPrev=!0,this.fulloverkey=!0,this.h=80,this.init()}update(t){super.update(t);let i=void 0===this.v?"":this.items[this.v].value,s=this.items[this.prev];return void 0!==s&&(i=t<=s.end?this.items[this.prev].value:""),(this.select||this.parent.fullActve)&&(this.c[5].style.background=i?this.acolor:"none"),i}}class W extends V{constructor(t={},i){super(t,i),this.type="color",this.degradId="deg"+i.DID++,this.degrad=[],this.linear=[],this.degNumber=5,this.needTimer=!0,this.needPrev=!0,this.needNext=!0,this.needTop=!0,this.createDegrad(),this.init()}update(t){let i=this.getColor(t);return(this.select||this.parent.fullActve)&&this.preview.setValue(i),i}getColor(t){let i,s,e=this.frame[t];if(void 0!==e)i=e,s=e<this.lng-1?e+1:void 0;else{let e=this.resetLevel(t,this.frame,this.lng);i=e[0],s=e[1]}let h=void 0===e?void 0:this.items[e].value,o=void 0!==i?this.items[i]:void 0,n=void 0!==s?this.items[s]:void 0;return void 0===h&&(void 0===o&&void 0!==n?h=n.value:void 0===n&&void 0!==o?h=o.value:void 0!==n&&void 0!==o&&(h=P.lerpColor(o.value,n.value,(t-o.frame)/(n.frame-o.frame)))),P.numToHex(h)}createDegrad(){let t,i,s;for(t=this.degNumber;t--;)i=z.dom("defs",z.basic+"position:absolute; top:0px; left:100px; width:100px; height:100%;",{}),s=z.dom("linearGradient","",{id:this.degradId+t,x1:"0%",y1:"0%",x2:"100%",y2:"0%"},i,0),z.dom("rect","",{width:"100%",height:"100%",stroke:"none",x:0,fill:"url(#"+(this.degradId+t)+")"},i),this.c[5].appendChild(i),this.degrad[t]=i,this.linear[t]=s;this.overBox=z.dom("div",z.basic+"position:absolute; top:0; left:0; width:100%; height:100%;"),this.c[5].appendChild(this.overBox)}draw(){let t,i=this.parent.frameMax,s=i/this.degNumber,e=100/this.degNumber,h=this.linear.length;for(;h--;)for(t=this.linear[h].childNodes[0];t.firstChild;)t.removeChild(t.firstChild);for(h=this.linear.length;h--;)z.dom("stop","",{offset:0,"stop-color":o.hexToHtml(this.getColor(s*h)),"stop-opacity":1},this.linear[h],0);let n,r,l=this.items.length;for(h=0;h<l;h++)n=(100*this.items[h].frame/i).toFixed(4),r=Math.floor(n/e),z.dom("stop","",{offset:n/e-r,"stop-color":o.hexToHtml(this.items[h].value),"stop-opacity":1},this.linear[r],0);for(h=this.linear.length;h--;)z.dom("stop","",{offset:1,"stop-color":o.hexToHtml(this.getColor(s*(h+1)-1)),"stop-opacity":1},this.linear[h],0)}over(t){this.overBox.style.boxShadow="inset 0 0 3px rgba(0,0,0,0.5)",super.over(t)}out(t){this.overBox.style.boxShadow="none",super.out(t)}moveDegrad(t,i){this.keys[t]=i,this.draw()}setSize(){let t,i=this.items.length;for(;i--;)t=this.items[i],t.reSize(this.w);let s=Math.floor(this.parent.frameMax/this.degNumber*this.parent.frameSize);for(i=this.degrad.length;i--;)this.degrad[i].style.width=s+"px",this.degrad[i].style.left=s*i+"px"}}class Q extends V{constructor(t={},i){super(t,i),this.type="curve",t.frame=void 0===t.frame?{x:{}}:t.frame,this.nAxe=0,this.px=-10,this.range=t.frame.range||[-100,100],this.precision=t.frame.precision||3,this.defaultTween=t.frame.def||"linear",void 0!==t.frame.x&&this.nAxe++,void 0!==t.frame.y&&this.nAxe++,void 0!==t.frame.z&&this.nAxe++,void 0!==t.frame.w&&this.nAxe++,this.basePos=[0,0,0,0],this.basey=[0,0,0,0],this.items=[],this.frame=[],this.lng=[],this.prev=[],this.next=[],this.loadframe=[],this.currentLevel=0,this.value={},this.axis=["x","y","z","w"],this.needTimer=!0,this.needPrev=!0,this.needNext=!0,this.needTop=!0,this.pointhide=!0,this.origine=z.liner(0,this.acolor),this.c[5].appendChild(this.origine),1===this.nAxe?this.color=[z.color.key]:this.color=["#F33","#3F3","#59F","#F95"],this.curves=[],this.points=[];for(let i=0;i<this.nAxe;i++)this.curves[i]=z.dom("path",z.basic+"opacity:0.75; width:100%; height:100%; left:0; top:0;",{width:"100%",height:"100%",d:"","stroke-width":1,stroke:this.color[i],fill:"none","stroke-linecap":"butt"}),this.points[i]=z.dom("div",z.basic+"left:0; margin-left:-5px; margin-top:-5px; border-radius:5px; width:10px; height:10px; border:1px solid "+this.color[i]+"; display:none"),this.c[5].appendChild(this.curves[i]),this.c[5].appendChild(this.points[i]),0===i&&(this.value.x=0,this.loadframe[0]=t.frame.x||{}),1===i&&(this.value.y=0,this.loadframe[1]=t.frame.y||{}),2===i&&(this.value.z=0,this.loadframe[2]=t.frame.z||{}),3===i&&(this.value.w=0,this.loadframe[3]=t.frame.w||{}),this.items.push([]),this.lng.push(0);this.h=t.h||102+this.tt+this.tb,this.ofRange(this.range[0],this.range[1]),this.init()}getFrame(){let t={},i=this.value;return void 0!==i.x&&(t.x={},this.pushValue(t.x,0)),void 0!==i.y&&(t.y={},this.pushValue(t.y,1)),void 0!==i.z&&(t.z={},this.pushValue(t.z,2)),void 0!==i.w&&(t.w={},this.pushValue(t.w,3)),t.range=[this.range[0],this.range[1]],t}pushValue(t,i){let s=this.items[i].length;for(let e=0;e<s;e++)t[this.items[i][e].frame]=this.items[i][e].getValue()}update(t){let i=this.value;return void 0!==i.x&&(i.x=this.upLevel(t,0)),void 0!==i.y&&(i.y=this.upLevel(t,1)),void 0!==i.z&&(i.z=this.upLevel(t,2)),void 0!==i.w&&(i.w=this.upLevel(t,3)),this.displayPoint(t),1===this.nAxe?i.x:i}upLevel(t,i){let s=this.frame[i][t],e=[0,this.basePos[i],"linear"],h=[this.parent.frameMax,this.basePos[i]],o=0;if(void 0!==s)o=this.items[i][s].pos,this.prev[i]=s,this.next[i]=s<this.lng[i]-1?s+1:void 0;else{let s=this.items[i][this.prev[i]],n=this.items[i][this.next[i]];void 0!==s&&(e=[s.frame,s.pos,s.ease]),void 0!==n&&(h=[n.frame,n.pos]),o=P.Tween(e[1],h[1],e[2],t,e[0],h[0])}return 1*o.toFixed(this.precision)}displayPoint(t){let i=!1,s=!1,e=0;if(this.select||this.parent.fullActve?(this.pointhide&&(this.pointhide=!1,i=!0),s=!0,e=this.parent.frameTrack):this.pointhide||(this.pointhide=!0,i=!0),!i&&!s)return;let h=this.nAxe;for(;h--;)i&&(this.points[h].style.display=this.pointhide?"none":"block"),this.points[h].style.top=P.floor(this.yFromPos(this.value[this.axis[h]]))+"px",this.points[h].style.left=e+"px"}draw(t){if(t){let t=this.nAxe;for(;t--;)this.drawLevel(t)}else this.drawLevel(this.currentLevel)}drawLevel(t){let i,s,e,h=[],o=this.items[t][0];for(void 0!==o?(this.basePos[t]=o.pos,this.basey[t]=o.getY()):(this.basePos[t]=0,this.basey[t]=this.midy+.5),h.push("M 0 "+this.basey[t]),i=this.lng[t],e=0;e!==i;e++)s=this.items[t][e].ease,"linear"===s?h.push(" L "+this.items[t][e].getX()+" "+this.items[t][e].getY()):this.besierSpline(s,this.items[t][e],this.items[t][e+1],h,t);h.push(" L "+this.maxw+" "+this.basey[t]),this.curves[t].childNodes[0].setAttributeNS(null,"d",h.join("\n"))}besierSpline(t,i,s,e,h){let o,n,r,l,a,c,d,u,p=this.precision,m=[],g=[],x=i.frame,f=P.Ease.getNum(t);if(m[0]=i.getX(),g[0]=i.getY(),void 0===s?(o=this.parent.frameMax,m[f]=i.getLastX(o-1),g[f]=this.basey[h]):(o=s.frame,m[f]=s.getX(),g[f]=s.getY()),g[0]===g[f])return void e.push(" L "+m[0]+" "+g[0]);let v=(o-x)/(f-1),b=(m[f]-m[0])/(f-1),y=g[0],w=g[f],k=f;for(;k--;)n=x+v*k,m[k]=m[0]+b*k,g[k]=P.Tween(y,w,t,n,x,o);for(d=P.computeControlPoints(m,p),u=P.computeControlPoints(g,p),r=d[0],l=u[0],a=d[1],c=u[1],k=0;k<f-1;k++)e.push(" L "+m[k]+" "+g[k]+" C "+r[k]+" "+l[k]+" "+a[k]+" "+c[k]+" "+m[k+1]+" "+g[k+1])}ofRange(t,i){let s,e;this.range[0]=t,this.range[1]=i,t<0?(s=Math.abs(t)+Math.abs(i),e=t):t>0?(s=i-t,e=t):(s=i,e=0);let h=this.h-this.tt-this.tb;this.range[2]=s/h,this.range[3]=h/s,this.range[4]=e*this.range[3],this.range[5]=h,this.midy=.5*this.range[5],this.origine.style.top=P.floor(this.midy)+"px"}changeHeight(){this.ofRange(this.range[0],this.range[1]);let t,i=this.nAxe;for(;i--;)for(t=this.items[i].length;t--;)this.items[i][t].setY();this.draw(!0)}yFromPos(t){return this.range[5]-t*this.range[3]+this.range[4]}posFromY(t){return(this.range[5]-t)*this.range[2]+this.range[0]}reset(t){let i,s=this.nAxe;for(;s--;)i=this.resetLevel(t,this.frame[s],this.lng[s]),this.prev[s]=i[0],this.next[s]=i[1]}sort(t){let i,s=this.nAxe;for(;s--;)for(this.items[s].sort((function(t,i){return t.frame-i.frame})),this.lng[s]=this.items[s].length,this.frame[s]={},i=this.lng[s];i--;)this.items[s][i].setID(i,s),this.frame[s][this.items[s][i].frame]=i;this.draw(),t&&this.showUpdate()}setSize(){let t,i=this.nAxe;for(;i--;)for(t=this.lng[i];t--;)this.items[i][t].reSize(this.w);this.draw(!0)}addFrame(){let t,i,s=this.nAxe;for(;s--;)for(t in i=this.loadframe[s],i)this.addItem(parseInt(t),i[t],s);this.sort()}selectKey(t,i){return this.parent.unselectKey(),i=void 0===i?this.currentLevel:i,this.items[i][t].selected(),this.items[i][t]}unselectAllKey(){let t,i=this.nAxe;for(;i--;)for(t=this.lng[i];t--;)this.items[i][t].unSelected()}}class K extends V{constructor(t={},i){super(t,i),this.type="lfo",this.needTimer=!0,this.needPrev=!0,this.needTop=!0,this.pointhide=!0,this.origine=z.liner(0,this.acolor),this.c[5].appendChild(this.origine),this.curve=z.dom("path",z.basic+"width:100%; height:100%; left:0; top:0;",{width:"100%",height:"100%",d:"","stroke-width":1,stroke:z.color.key,fill:"none","stroke-linecap":"butt"}),this.point=z.dom("div",z.basic+"left:0; margin-left:-5px; margin-top:-5px; border-radius:5px; width:10px; height:10px; border:1px solid "+z.color.key+"; display:none"),this.c[5].appendChild(this.curve),this.c[5].appendChild(this.point),this.h=t.h||102+this.tt+this.tb,this.ofRange(),this.init()}update(t){super.update(t);let i,s=0,e=void 0===this.v?void 0===this.prev?void 0:this.prev:this.v;return void 0!==e&&(i=this.items[e],"sine"===i.curve&&(s=P.Sine(t-i.frame,i.phase,i.frequency,i.amplitude)),"noise"===i.curve&&(s=i.perlin.noise((t-i.frame)*i.frequency*.1,0)*i.amplitude)),this.select||this.parent.fullActve?(this.pointhide&&(this.pointhide=!1,this.point.style.display="block"),this.point.style.top=s*(this.midy-10)+this.midy+"px",this.point.style.left=this.parent.frameTrack+"px"):this.pointhide||(this.pointhide=!0,this.point.style.display="none"),s}draw(){clearTimeout(this.drawdelay),this.drawdelay=setTimeout(this.drawCurve.bind(this),0)}drawCurve(){let t,i=this.parent.frameSize,s=this.parent.frameMax,e=[];e.push("M 0 "+this.midy);let h=this.lng;for(let o=0;o!==h;o++)t=o<h-1?this.items[o+1].frame-this.items[o].frame:s-this.items[o].frame,"sine"===this.items[o].curve&&this.curveSine(this.items[o],t,i,e),"noise"===this.items[o].curve&&this.curveNoise(this.items[o],t,i,e);e.push(" L "+this.maxw+" "+this.midy),this.curve.childNodes[0].setAttributeNS(null,"d",e.join("\n"))}curveNoise(t,i,s,e){let h,o,n,r,l=t.getX(),a=t.getPerlin(),c=t.amplitude,d=t.frequency,u=this.midy,p=this.w,m=i/1;for(let t=1;t<m;t+=2)h=(t-1)*p*1+l,n=a.noise((t-1)*d*.1,0)*c*(u-10)+u,o=t*p*1+l,r=a.noise(t*d*.1,0)*c*(u-10)+u,h=h.toFixed(2),o=o.toFixed(2),n=n.toFixed(2),r=r.toFixed(2),e.push(" L "+h+" "+n+" "+o+" "+r)}curveSine(t,i,s,e){let h,o,n,r,l=t.getX(),a=this.midy,c=t.amplitude,d=t.frequency,u=t.phase,p=this.w,m=.5,g=i/m;for(let t=1;t<g;t+=2)h=(t-1)*p*m+l,n=P.Sine((t-1)*m,u,d,c)*(a-10)+a,o=t*p*m+l,r=P.Sine(t*m,u,d,c)*(a-10)+a,h=h.toFixed(2),o=o.toFixed(2),n=n.toFixed(2),r=r.toFixed(2),e.push(" L "+h+" "+n+" "+o+" "+r)}ofRange(){let t=this.h-this.tt-this.tb;this.midy=.5*t,this.origine.style.top=~~this.midy+"px"}changeHeight(){this.ofRange(),this.draw()}}class J extends V{constructor(t={},i){super(t,i),this.type="audio",this.range=t.range||[-100,100],this.needPrev=!0,this.isMedia=!0,this.origine=z.liner(0,this.acolor),this.h=t.h||102+this.tt+this.tb,this.init()}update(t){super.update(t);let i=void 0===this.v?void 0===this.prev?void 0:this.prev:this.v;void 0!==i&&this.parent.isPlay&&this.items[i].play(t)}reset(t){this.stop(),super.reset(t)}stop(){let t=this.items.length;for(;t--;)this.items[t].stop()}}class _ extends V{constructor(t={},i){super(t,i),this.type="video",this.needPrev=!0,this.isMedia=!0,this.h=t.h||102+this.tt+this.tb,this.init()}update(t){super.update(t);let i=0,s=void 0===this.v?void 0===this.prev?void 0:this.prev:this.v;return void 0!==s&&(this.parent.isPlay&&this.items[s].play(t),i=this.items[s].getFrame()),i}reset(t){this.videoGo(t),super.reset(t)}stop(){let t=this.items.length;for(;t--;)this.items[t].stop()}videoGo(t){let i=this.items.length;for(;i--;)this.items[i].seek(t)}}class ${constructor(t={}){this.id=t.id||0,this.name=t.name||"node-"+this.id,this.points=[],this.w=t.w||80,this.h=t.h||20,this.x=10,this.y=10,this.p=null,t.x&&(this.x=t.x-.5*this.w),t.y&&(this.y=t.y-.5*this.h),this.color="#666",this.border="#888",this.borderSel="#AAA",this.select=!1}draw(t){t.lineWidth=1,t.strokeStyle=this.select?this.borderSel:this.border,t.fillStyle=this.color,t.fillRect(this.x,this.y,this.w,this.h),t.strokeRect(this.x,this.y,this.w,this.h);let i=this.points.length;for(;i--;)0===i&&this.points[i].move(this.x,this.y+.5*this.h),1===i&&this.points[i].move(this.x+this.w,this.y+.5*this.h),this.points[i].draw(t);t.font="normal 9px Helvetica,Arial,sans-serif",t.textBaseline="middle",t.fillStyle="#FFF",t.textAlign="center",t.fillText(this.name,this.x+.5*this.w,this.y+.5*this.h)}over(t,i){let s=this.points.length;for(this.p=null;s--;)this.points[s].over(t,i)&&(this.p=this.points[s]);return null!==this.p?(this.select=!0,"link"+(this.p.start?"Start":"End")):(this.select=this.x<=t&&this.x+this.w>=t&&this.y<=i&&this.y+this.h>=i,this.select?"node":"")}move(t,i){this.x=t,this.y=i}}class tt{constructor(t={}){this.x=t.x||0,this.y=t.y||0,this.r=6,this.color="#0AA",this.colorSel="#0FF",this.select=!1,this.start=t.start||!1,this.id=t.id||0,this.start&&(this.color="#AA0",this.colorSel="#FF0")}draw(t){t.beginPath(),t.fillStyle=this.select?this.colorSel:this.color,t.arc(this.x,this.y,this.r,0,2*Math.PI),t.closePath(),t.fill()}over(t,i){return this.select=this.x-this.r<=t&&this.x+this.r>=t&&this.y-this.r<=i&&this.y+this.r>=i,this.select}move(t,i){this.x=t,this.y=i}}class it{constructor(t={}){t.n1.points[1].select=!1,t.n2.points[0].select=!1,this.p1=t.n1.points[1],this.p2=t.n2.points[0],this.r=3,this.color="#FFF"}draw(t,i){t.beginPath(),t.fillStyle="#0FF",t.arc(this.p1.x,this.p1.y,this.r,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath(),t.fillStyle="#FF0",t.arc(this.p2.x,this.p2.y,this.r,0,2*Math.PI),t.closePath(),t.fill();let s=this.p1.x,e=this.p1.y,h=this.p2.x,o=this.p2.y,n=i.findCurve(s,e,h,o,!1);t.lineWidth=2;let r=t.createLinearGradient(s,e,h,o);r.addColorStop(0,"#0FF"),r.addColorStop(1,"#FF0"),t.strokeStyle=r,t.beginPath(),t.moveTo(s,e),5===n.length?(t.lineTo(n[0],e),t.quadraticCurveTo(n[1],e,n[1],n[3]),t.lineTo(n[1],n[4]),t.quadraticCurveTo(n[1],o,n[2],o)):(t.lineTo(n[0],e),t.quadraticCurveTo(n[1],e,n[1],n[4]),t.lineTo(n[1],n[5]),t.quadraticCurveTo(n[1],n[6],n[0],n[6]),t.lineTo(h,n[6]),t.quadraticCurveTo(n[3],n[6],n[3],n[7]),t.lineTo(n[3],n[8]),t.quadraticCurveTo(n[3],o,h,o)),t.lineTo(h,o),t.stroke()}}const st=o,et=T;t.Map=class{constructor(t={}){this.doc=document,this.box={l:0,r:0,t:0,b:0,w:0,h:0,d:0,m:2},this.num={ox:50,oy:50,dx:0,dy:0,tx:0,ty:0},this.zoom=1,this.ratio=1,this.nodes=[],this.links=[],this.drawTimer=null,this.tmpLink=!1,this.dragging=!1,this.linking=!1,this.dragview=!1,this.selection=null,this.action="",this.box.t=t.top||20,this.box.b=t.bottom||20,this.box.l=t.left||20,this.box.r=t.right||20;let i=z.dom,s=z.basic;this.content=i("div",s+"top:"+this.box.t+"px; left:"+this.box.l+"px; pointer-events:auto; overflow:hidden; margin-left:-"+this.box.m+"px; margin-top:-"+this.box.m+"px; this.box-sizing:this.content-this.box; border:"+this.box.m+"px solid #888;"),this.contentStyle=this.content.style,this.m_canvas=i("canvas"),this.canvas=i("canvas","pointer-events:auto;",null,this.content),this.canvas.name="canvas",this.ctx=this.m_canvas.getContext("2d"),this.ctx_end=this.canvas.getContext("2d"),this.doc.body.appendChild(this.content),this.activeEvents(),this.resize()}activeEvents(){this.doc.addEventListener("dblclick",this,!1),this.doc.addEventListener("mousedown",this,!1),this.doc.addEventListener("mousemove",this,!1),this.doc.addEventListener("mouseup",this,!1),this.doc.addEventListener("mousewheel",this,!1),this.doc.addEventListener("contextmenu",this,!1),window.addEventListener("resize",this,!1)}handleEvent(t){switch(t.type){case"contextmenu":this.mouseMenu(t);break;case"mousewheel":this.wheel(t);break;case"mousedown":this.down(t);break;case"mousemove":this.move(t);break;case"mouseup":this.up(t);break;case"dblclick":this.double(t);break;case"resize":this.resize(t)}}mouseMenu(t){return t.preventDefault(),!1}double(t){let i=this.getMouse(t),s={x:i.x,y:i.y};this.add(s)}up(t){if(("linkStart"===this.action||"linkEnd"===this.action)&&null!==this.selection){let i=this.getMouse(t),s=this.nodes.length,e="";for(;s--;){if(e=this.nodes[s].over(i.x,i.y),"linkEnd"===this.action&&"linkStart"===e){this.add({type:"link",n2:this.nodes[s],n1:this.selection});break}if("linkStart"===this.action&&"linkEnd"===e){this.add({type:"link",n1:this.nodes[s],n2:this.selection});break}}this.linking=!1,this.draw()}this.action="",this.selection=null}down(t){this.action="";let i=this.getMouse(t),s=this.nodes.length;for(;s--;){if(this.action=this.nodes[s].over(i.x,i.y),"linkStart"===this.action||"linkEnd"===this.action){this.selection=this.nodes[s],this.num.dx=this.selection.p.x,this.num.dy=this.selection.p.y,this.num.tx=i.x,this.num.ty=i.y;break}if("node"===this.action){this.selection=this.nodes[s],this.num.dx=i.x-this.selection.x,this.num.dy=i.y-this.selection.y;break}}""===this.action&&"canvas"===t.target.name&&(this.action="moveCanvas",this.num.dx=i.x,this.num.dy=i.y),this.draw()}move(t){if(""===this.action)return;let i=this.getMouse(t);switch(this.action){case"linkStart":case"linkEnd":this.num.tx=i.x,this.num.ty=i.y,this.linking=!0;break;case"node":this.selection.move(i.x-this.num.dx,i.y-this.num.dy);break;case"moveCanvas":this.num.ox+=i.x-this.num.dx,this.num.oy+=i.y-this.num.dy,this.transform()}this.draw()}getMouse(t){return{x:Math.floor((t.clientX-this.box.l-this.num.ox)*this.ratio),y:Math.floor((t.clientY-this.box.t-this.num.oy)*this.ratio)}}getCorner(t){return{x:Math.floor(t.clientX-this.box.l),y:Math.floor(t.clientY-this.box.t)}}wheel(t){let i=this.zoom,s=0;if(t.wheelDeltaY?s=.04*t.wheelDeltaY:t.wheelDelta?s=.2*t.wheelDelta:t.detail&&(s=4*-t.detail),this.zoom+=.05*s,this.zoom=this.zoom<1?1:this.zoom,this.zoom=this.zoom>4?4:this.zoom,i===this.zoom)return;let e=this.getMouse(t);this.ratio=1/this.zoom;let h=this.getCorner(t);this.num.ox=h.x-e.x*this.zoom,this.num.oy=h.y-e.y*this.zoom,this.transform(),this.draw()}add(t){let i,s,e;switch((t=void 0===t?{}:t).type||"node"){case"node":t.id=this.nodes.length,i=new $(t),s=new tt({start:!0}),e=new tt({}),i.points.push(s),i.points.push(e),this.nodes.push(i);break;case"link":this.links.push(new it(t))}this.draw()}transform(t,i){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.translate(this.num.ox,this.num.oy),this.ctx.scale(this.zoom,this.zoom)}draw(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.box.w,this.box.h),this.ctx.fillStyle="rgba(0,0,0,0.2)",this.ctx.fillRect(0,0,this.box.w,this.box.h),this.ctx.restore(),this.origin();let t=this.links.length;for(;t--;)this.links[t].draw(this.ctx,this);for(this.drawTmpLink(),t=this.nodes.length;t--;)this.nodes[t].draw(this.ctx);this.render()}render(){this.ctx_end.clearRect(0,0,this.box.w,this.box.h),this.ctx_end.drawImage(this.m_canvas,0,0)}distance(t,i,s){return s=s||.5,t>i?i+(t-i)*s:t+(i-t)*s}findCurve(t,i,s,e,h){let o=[],n=!1,r=Math.abs(t-s);h&&t<s&&(n=!0),!h&&t>s&&(n=!0);let l=h?t-s:s-t,a=e-i,c=a<0;a=a<0?-1*a:a,a*=.5,l=r,l*=.5,l=l<10?10:l,l=a<l?a:l;let d=.5*l,u=h?t-l:t+l,p=h?u-s:s-u,m=p<0?!h:!!h;p=p<0?-1*p:p,p*=.5,p=p<10?10:p,p=a<p?a:p;let g=p;return message.textContent=n+" "+r,n?(o[0]=h?u+d:u-d,o[1]=u,o[2]=m?u-g:u+g,o[3]=m?s-d:s+d,o[4]=c?i-d:i+d,o[5]=c?i-a+d:i+a-d,o[6]=c?e+a:e-a,o[7]=c?e+a-d:e-a+d,o[8]=c?e+d:e-d):(o[0]=h?u+d:u-d,o[1]=u,o[2]=m?u-g:u+g,o[3]=c?i-d:i+d,o[4]=c?e+g:e-g),o}drawTmpLink(){if(!this.linking)return;let t=!1;"linkStart"===this.action&&(t=!0);let i=t?["#FF0","#0AA"]:["#0FF","#AA0"];this.ctx.lineWidth=2;let s=this.ctx.createLinearGradient(this.num.dx,this.num.dy,this.num.tx,this.num.ty);s.addColorStop(0,i[0]),s.addColorStop(1,i[1]);let e=this.findCurve(this.num.dx,this.num.dy,this.num.tx,this.num.ty,t);this.ctx.strokeStyle=s,this.ctx.beginPath(),this.ctx.moveTo(this.num.dx,this.num.dy),5===e.length?(this.ctx.lineTo(e[0],this.num.dy),this.ctx.quadraticCurveTo(e[1],this.num.dy,e[1],e[3]),this.ctx.lineTo(e[1],e[4]),this.ctx.quadraticCurveTo(e[1],this.num.ty,e[2],this.num.ty)):(this.ctx.lineTo(e[0],this.num.dy),this.ctx.quadraticCurveTo(e[1],this.num.dy,e[1],e[4]),this.ctx.lineTo(e[1],e[5]),this.ctx.quadraticCurveTo(e[1],e[6],e[0],e[6]),this.ctx.lineTo(this.num.tx,e[6]),this.ctx.quadraticCurveTo(e[3],e[6],e[3],e[7]),this.ctx.lineTo(e[3],e[8]),this.ctx.quadraticCurveTo(e[3],this.num.ty,this.num.tx,this.num.ty)),this.ctx.lineTo(this.num.tx,this.num.ty),this.ctx.stroke()}origin(){this.ctx.lineWidth=1,this.ctx.strokeStyle="#666",this.ctx.beginPath(),this.ctx.moveTo(-10,0),this.ctx.lineTo(10,0),this.ctx.stroke(),this.ctx.moveTo(0,-10),this.ctx.lineTo(0,10),this.ctx.stroke()}resize(t){this.box.h=window.innerHeight-this.box.b-this.box.t,this.box.w=window.innerWidth-this.box.l-this.box.r,this.contentStyle.width=this.box.w+"px",this.contentStyle.height=this.box.h+"px",this.canvas.width=this.box.w,this.canvas.height=this.box.h,this.m_canvas.width=this.box.w,this.m_canvas.height=this.box.h,this.transform(),this.draw()}},t.Pannel=D,t.REVISION="0.5.0",t.Timeline=class{constructor(t={}){this.types=["bang","flag","switch","module","color","curve","lfo","audio","video"],this.fullActve=!0,this.visible=!0,this.isLoop=!0,this.isPlay=!1,this.isScroll=!1,this.isDown=!1,this.tmpJSON=null,this.DID=0,this.callback=t.callback||null,this.layers=[],this.tracks=[],this.data={},this.trackLength=0,this.colorSelect="#035fcf",this.frameMax=t.maxframe||750,this.frameTime=1/60,this.frameSize=1,this.frameTrack=0,this.frame=0,this.time=0,this.leftFrame=0,this.zone=50,this.trackSpace=[0,0],this.temp=0,this.rfps=0,this.count=0,this.timerStep=0,this.step=0,this.delta=0,this.then=0,this.prev=0,this.fps=60,this.invFS=0,this.framefix=1,this.maxSize=0,this.maxPos=0,this.overtrack=null,this.scy=0,this.maxScy=0,this.viewInvRatio=0,this.currentPannel="",this.currentKey=null,this.currentAction="",this.currentResize=null,this.ratio=0,this.invRatio=0,this.minWidth=0,this.maxWidth=0,this.box={l:0,t:0,r:0,b:0,w:0,h:0,d:0,lr:0,top:70,m:1},this.range={start:0,end:1,lng:1,decal:0,mid:0,midpos:0},this.hhh={total:0,full:89,scroll:0},this.scalerRec={l:0,r:0,w:0},this.box.t=t.top||0,this.box.b=t.bottom||0,this.box.l=t.left||0,this.box.r=t.right||0;let i=z.dom,s=z.css.basic;this.content=i("div",s+"top:"+this.box.t+"px; left:"+this.box.l+"px; overflow:visible; pointer-events:auto; margin-left:-"+this.box.m+"px; margin-top:-"+this.box.m+"px; border:"+this.box.m+"px solid #000; box-sizing:content-box; background:rgba(0,0,0,0.25);"),this.topmenu=i("div",s+"top:0; left:0; width:100%; height:30px; overflow:visible;\tbackground:rgba(0,0,0,0.25); "),this.textTime=i("div",z.css.txt+"top:4px; left:64px; width:150px; height:22px; font-size:15px; letter-spacing:-1px; padding:5px 5px; background:rgba(0,0,0,0.25); border-radius:4px; border:1px solid rgba(80,80,80,0.25); text-shadow:none;"),this.textTime.textContent="0:00:00.00 | 0",this.topmenu.appendChild(this.textTime),this.navmenu=i("div",s+"width:100%; top:30px; height:20px; overflow:hidden; padding:1px 5px; background:rgba(0,0,0,0.25);"),this.timeBar=i("div",s+"width:100%; height:20px; top:"+(this.box.top-20)+"px; pointer-events:auto; cursor:col-resize; background:rgba(0,0,0,0.25);");let e=i("div",s+"width:100%; height:20px; top:0;",null,this.timeBar),h=i("defs",s+"width:100%; height:20px; bottom:0;",{}),o=i("pattern","",{id:"timeBar",x:0,y:0,width:50,height:20,patternUnits:"userSpaceOnUse",patternTransform:"translate(-0.5)"},h,0),n=i("g","",{stroke:z.color.timeline,"stroke-width":1,fill:"none","stroke-linecap":"butt"},o,0);i("path","",{d:"M0 0"},n,0),i("rect","",{width:"100%",height:20,x:0,fill:"url(#timeBar)"},h),this.pattern=h.childNodes[0].childNodes[0],e.appendChild(h),e.appendChild(z.liner(20,z.color.timeline,1)),this.timeBar.name="timeBar",this.timescale=i("div",s+"width:100%; height:20px; bottom:0; pointer-events:auto; cursor:e-resize; overflow:hidden; border-top:1px solid #888;"),this.timescale.name="timescale",this.scaler=i("div",s+"width:200px; height:16px; top:2px; overflow:visible;",null,this.timescale),this.scaler.appendChild(z.liner(8));let r="width:16px; height:16px; top:0px; pointer-events:auto; cursor:col-resize; border:2px solid #888; border-radius:8px;";this.sl=i("div",s+r+"left:-8px;",null,this.scaler),this.sr=i("div",s+r+"right:-8px;",null,this.scaler),this.sl.name="scaleLeft",this.sr.name="scaleRight",this.scOver=!1,this.innerContent=i("div",s+"width:100%; top:70px; height:0px; overflow:hidden;"),this.inner=i("div",s+"width:100%; top:0px; height:0px; overflow:hidden;",null,this.innerContent);let l="border-right:1px solid rgba(0,0,0,0.25); background:"+z.color.timeprev+"; ";this.miniPrev=i("div",s+"width:30px; height:15px; margin-left:10px; top:52px;\tfont-size:14px; letter-spacing:-1px; color:"+z.color.timeprevtext+"; ",null,this.timescale),this.markerPrev=i("div",s+"top:52px; width:10px; height:60px; overflow:hidden;"),i("div",s+l+"width:100%; top:0; height:16px; border-radius:4px;",null,this.markerPrev),i("div",s+l+"left:50%; margin-left:-1px; width:2px; top:18px; height:100%;",null,this.markerPrev),l="border-right:1px solid rgba(0,0,0,0.25); background:"+z.color.time+"; ",this.marker=i("div",s+"top:52px; width:10px; height:60px; overflow:hidden;"),i("div",s+l+"width:100%; top:0; height:16px; border-radius:4px;",null,this.marker),i("div",s+l+"left:50%; margin-left:-1px; width:2px; top:18px; height:100%;",null,this.marker),this.mini=i("div",s+l+"width:1px; height:15px; top:2px; ",null,this.timescale),this.hscroll=i("div",s+"position:absolute; width:19px; height:100px; left:auto; right:1px; top:69px; border-left:1px solid #888; border-top:1px solid #888; background:#1b1b1b; pointer-events:auto; cursor:n-resize;"),i("div",s+"position:absolute; width:10px; height:20px; left:4px; top:0px; background:#666; ",null,this.hscroll),this.hscroll.name="hscroll";let a=z.frag;a.appendChild(this.timeBar),a.appendChild(this.timescale),a.appendChild(this.innerContent),a.appendChild(this.markerPrev),a.appendChild(this.miniPrev),a.appendChild(this.marker),a.appendChild(this.hscroll),a.appendChild(this.navmenu),a.appendChild(this.topmenu),this.content.appendChild(a),this.pannel=new D(this),void 0!==t.parent?t.parent.appendChild(this.content):document.body.appendChild(this.content),this.setFps(this.fps),this.activeEvents(),this.initTopMenu(this.topmenu),this.initNavMenu(this.navmenu),this.miniUI(),this.resize(),void 0!==t.open&&(t.open||this.showHide())}miniUI(){this.content2=z.dom("div",z.basic+"top:"+this.box.t+"px; left:10px; width:50px; height:71px"),this.openButton=T("button",{target:this.content2,w:44,h:44,pos:{left:"0px",top:"3px"},simple:!0}).icon(o.icon("neo","#888",40)).onChange(this.showHide.bind(this)),this.playButton2=T("button",{target:this.content2,w:44,h:24,pos:{left:"0px",top:"48px"},simple:!0}).onChange(this.play.bind(this)),this.playButton2.icon(this.playIcon,2),this.playButton2.display(),document.body.appendChild(this.content2)}onChange(t){return this.callback=t||null,this}floor(t){return Math.floor(t)}load(t){let i=new XMLHttpRequest;i.onload=function(t){z.fromJson(JSON.parse(i.responseText))},i.open("GET",t,!0),i.send()}initNavMenu(t){let i=function(t){this.addLayer()}.bind(this),s=function(t){this.removeLayer()}.bind(this);this.layers.push("ROOT");let e=224;T("button",{target:this.navmenu,name:"+",pos:{left:e+"px"},simple:!0,w:24,h:18}).onChange(i),e+=26,T("button",{target:this.navmenu,name:"-",pos:{left:e+"px"},simple:!0,w:24,h:18}).onChange(s),e+=34,this.layerSelector=T("selector",{target:this.navmenu,simple:!0,w:60*this.layers.length,h:18,pos:{left:e+"px"},bDown:"#888",h:18,values:this.layers,value:"ROOT"})}removeLayer(){this.layers.length<2||(this.layers=this.layers.splice(0,this.layers.length-1),this.layerSelector.clear(),this.layerSelector=T("selector",{target:this.navmenu,simple:!0,w:60*this.layers.length,h:18,pos:{left:"230px"},bDown:"#888",h:18,values:this.layers,value:"ROOT"}))}addLayer(){if(this.layers.length>8)return;let t="LAYER"+(this.layers.length-1);this.layers.push(t),this.layerSelector.clear(),this.layerSelector=T("selector",{target:this.navmenu,simple:!0,w:60*this.layers.length,h:18,pos:{left:"230px"},bDown:"#888",h:18,values:this.layers,value:t})}initTopMenu(t){let i=function(t){z.saveJson(this)}.bind(this),s=function(t){z.fromJson(this,this.tmpJSON)}.bind(this),e=function(t){z.saveJson(this,!0)}.bind(this),h=function(t){z.fromJson(this,t)}.bind(this),o=function(t){this.setFps(t)}.bind(this),n=function(t){this.frameMax=t,this.setRange()}.bind(this),r=function(t){this.add(t),y.text("ADD")}.bind(this),l=function(t){this.play()}.bind(this),a=function(t){this.frame&&this.goTo(this.frame-1)}.bind(this),c=function(t){this.frame<this.frameMax-1&&this.goTo(this.frame+1)}.bind(this),d=function(t){this.moveTo(0)}.bind(this),u=function(t){this.moveTo(this.frameMax-1)}.bind(this),p=function(t){}.bind(this),m=24,g=224,x=T("button",{target:t,w:m,pos:{left:g+"px",top:"3px"},simple:!0,h:m}).onChange(d);g+=26;let f=T("button",{target:t,w:m,pos:{left:g+"px",top:"3px"},simple:!0,h:m}).onChange(a);g+=26,this.playButton=T("button",{target:t,w:40,pos:{left:g+"px",top:"3px"},simple:!0,h:m}).onChange(l),g+=42;let v=T("button",{target:t,w:m,pos:{left:g+"px",top:"3px"},simple:!0,h:m}).onChange(c);g+=26;let b=T("button",{target:t,w:m,pos:{left:g+"px",top:"3px"},simple:!0,h:m}).onChange(u);g+=34;let y=T("list",{target:t,list:this.types,w:80,staticTop:!0,miniCanvas:!0,pos:{left:g+"px",top:"3px"},simple:!0,side:"down",full:!0,h:m,itemBg:"#333"}).onChange(r);g+=90,this.addMiniTrackImg(y),T("button",{target:t,name:"memo",w:40,pos:{left:g+"px",top:"3px"},simple:!0,h:m}).onChange(i),g+=42,T("button",{target:t,name:"back",w:40,pos:{left:g+"px",top:"3px"},simple:!0,h:m}).onChange(s),g+=42,T("button",{target:t,name:"save",w:40,pos:{left:g+"px",top:"3px"},simple:!0,h:m}).onChange(e),g+=42,T("button",{target:t,name:"load",w:40,pos:{left:g+"px",top:"3px"},simple:!0,h:m,loader:!0}).onChange(h),g+=50,this.recordButton=T("button",{target:t,w:40,pos:{left:g+"px",top:"3px"},simple:!0,h:m}).onChange(p),g+=42,T("number",{target:t,name:"max",min:1,value:this.frameMax,step:1,drag:!1,w:100,sa:40,center:!0,h:m,pos:{left:"auto",right:"80px",top:"3px"}}).onChange(n),T("number",{target:t,name:"fps",min:12,max:144,value:this.fps,step:1,drag:!1,w:80,sa:40,sb:30,center:!0,h:m,pos:{left:"auto",right:"0px",top:"3px"}}).onChange(o);let w=z.svgns;this.playIcon="<svg xmlns="+w+" width='18px' height='17px'><path fill='#CCC' d='M 14 8 L 5 3 4 4 4 13 5 14 14 9 14 8 Z'/></svg>",this.pauseIcon="<svg xmlns="+w+" width='18px' height='17px'><path fill='#CCC' d='M 14 4 L 13 3 11 3 10 4 10 13 11 14 13 14 14 13 14 4 M 8 4 L 7 3 5 3 4 4 4 13 5 14 7 14 8 13 8 4 Z'/></svg>";let k="<svg xmlns="+w+" width='18px' height='17px'><path fill='#CCC' d='M 11 12 L 11 10 14 10 14 7 11 7 11 5 8 8 8 9 11 12 M 7 12 L 6 12 6 5 7 5 7 3 4 3 4 14 7 14 7 12 Z'/></svg>",S="<svg xmlns="+w+" width='18px' height='17px'><path fill='#CCC' d='M 10 8 L 7 5 7 7 4 7 4 10 7 10 7 12 10 9 10 8 M 14 3 L 11 3 11 5 12 5 12 12 11 12 11 14 14 14 14 3 Z'/></svg>",C="<svg xmlns="+w+" width='18px' height='17px'><path fill='#CCC' d='M 11 12 L 11 10 14 10 14 7 11 7 11 5 8 8 8 9 11 12 Z'/></svg>",M="<svg xmlns="+w+" width='18px' height='17px'><path fill='#CCC' d='M 10 8 L 7 5 7 7 4 7 4 10 7 10 7 12 10 9 10 8 Z'/></svg>";this.recordIcon="<svg xmlns="+w+" width='18px' height='17px'><path fill='none' stroke='#CCC' stroke-width='2' d='M 13 9 Q 13 10.65 11.8 11.8 10.65 13 9 13 7.35 13 6.15 11.8 5 10.65 5 9 5 7.35 6.15 6.15 7.35 5 9 5 10.65 5 11.8 6.15 13 7.35 13 9 Z'/></svg>",this.recordIcon2="<svg xmlns="+w+" width='18px' height='17px'><path fill='#CCC' stroke='#CCC' stroke-width='2' d='M 13 9 Q 13 10.65 11.8 11.8 10.65 13 9 13 7.35 13 6.15 11.8 5 10.65 5 9 5 7.35 6.15 6.15 7.35 5 9 5 10.65 5 11.8 6.15 13 7.35 13 9 Z'/></svg>",this.playButton.icon(this.playIcon,2),this.recordButton.icon(this.recordIcon,2),x.icon(k,2),b.icon(S,2),f.icon(C,2),v.icon(M,2)}addMiniTrackImg(t){t.text("ADD");let i=document.createElement("img");i.src=z.TRACK,i.onload=function(){for(let s=0;s<this.types.length;s++)t.drawImage(this.types[s],i,20*s,0,20,20)}.bind(this)}getFrame(){return this.frame}setFrame(t){this.frame=t}showHide(){this.visible?(this.visible=!1,this.content.style.visibility="hidden",this.pannel.display(),this.selected(),this.removeEvents(),this.playButton2.display(!0),this.openButton.icon(o.icon("neo","#CCC",40))):(this.visible=!0,this.content.style.visibility="visible",this.pannel.display(!0),this.activeEvents(),this.playButton2.display(),this.openButton.icon(o.icon("neo","#888",40)))}activeEvents(){let t=document;t.addEventListener("pointercancel",this),t.addEventListener("pointerleave",this),t.addEventListener("pointerdown",this),t.addEventListener("pointermove",this),t.addEventListener("pointerup",this),t.addEventListener("wheel",this,{passive:!1}),t.addEventListener("keydown",this),t.addEventListener("contextmenu",this),window.addEventListener("resize",this)}removeEvents(){let t=document;t.removeEventListener("pointercancel",this),t.removeEventListener("pointerleave",this),t.removeEventListener("pointerdown",this),t.removeEventListener("pointermove",this),t.removeEventListener("pointerup",this),t.removeEventListener("wheel",this),t.removeEventListener("contextmenu",this,!1),window.removeEventListener("resize",this,!1)}handleEvent(t){switch(t.type){case"pointercancel":case"pointerleave":this.out(t);break;case"keydown":this.keydown(t);break;case"contextmenu":this.mouseMenu(t);break;case"wheel":this.wheel(t);break;case"pointerdown":this.down(t);break;case"pointermove":this.move(t);break;case"pointerup":this.up(t);break;case"resize":this.resize(t)}}keydown(t){if(!z.getImput())switch(t.keyCode){case 84:this.showHide();break;case 32:this.play()}}out(t){}mouseMenu(t){t.preventDefault()}wheel(t){if(!this.isScroll)return;let i=0;t.wheelDeltaY?i=.04*-t.wheelDeltaY:t.wheelDelta?i=.2*-t.wheelDelta:t.detail&&(i=4*t.detail),this.scy+=i,this.setScrollY()}down(t){if(this.isDown=!0,this.tracksDown(t),t.target.name){let i=t.target.name;"trackTitle"===i&&this.selected(this.tracks[t.target.id]),"timeBar"===i||"timescale"===i||"scaleRight"===i||"scaleLeft"===i||"scaleBar"===i||"hscroll"===i?("timeBar"===i&&this.isPlay&&this.pause(),"timescale"===i&&this.findDecal(t.clientX),"scaleBar"===i&&(this.currentResize=this.tracks[t.target.id]),this.currentAction=i,this.move(t)):this.currentAction=""}else this.currentAction=""}move(t){this.isDown?this.tracksMove(t):this.trackOver(t),this.over(t);let i=t.clientX-this.box.l,s=t.clientY;if(z.inRange(s,this.trackSpace[0]-20,this.trackSpace[1])){this.framePrev=this.getFrameClick(t.clientX);let i=this.floor((this.framePrev-this.range.start)*this.frameSize);this.markerPrev.style.left=this.miniPrev.style.left=i+"px",this.miniPrev.textContent=this.framePrev}if(this.currentAction)switch(i=i<0?0:i,this.currentAction){case"timeBar":this.goTo(this.getFrameClick(i,!0));break;case"timescale":this.moveScroll(i,!0);break;case"scaleLeft":this.changeRange(i);break;case"scaleRight":this.changeRange(i,!0);break;case"scaleBar":this.setTrackHeight(s);break;case"hscroll":this.setScrollY(s)}}over(t){switch(t.target.name){case"scaleLeft":case"scaleRight":this.scalerOver(t);break;default:this.scalerOut()}}up(t){this.isDown=!1,this.tracksUp(t),this.currentAction="",this.currentResize=null}scalerOver(t){t.target.style.background=this.colorSelect,t.target.style.borderColor=this.colorSelect,this.scOver=!0}scalerOut(){this.scOver&&!this.currentAction&&(this.sl.style.background="none",this.sl.style.borderColor="#888",this.sr.style.background="none",this.sr.style.borderColor="#888",this.scOver=!1)}pause(){this.isPlay=!1,this.stopMedia(),this.playButton.icon(this.playIcon,2),this.playButton2.icon(this.playIcon,2)}play(){this.isPlay?this.pause():(this.isPlay=!0,this.playButton.icon(this.pauseIcon,2),this.playButton2.icon(this.pauseIcon,2),this.loop())}loop(t){this.isPlay&&window.requestAnimationFrame(this.loop.bind(this)),this.update(t)}update(t){if(this.isPlay){if(this.step=void 0===t?performance.now():t,this.delta=this.step-this.then,this.delta<=this.timerStep)return;this.then=this.step-this.delta%this.timerStep,this.step-1e3>this.temp&&(this.temp=this.step,this.rfps=this.count,this.count=0),this.count++}this.updateTime(!0),this.tracksUpdate(),this.callback&&this.callback(),this.isPlay&&(this.autoScroll(),this.frame++),this.frame>=this.frameMax&&(this.isLoop?this.moveTo(0):this.pause())}updateTime(t){let i,s,e,h,o,n,r,l=this.frameSize;t&&(this.time=this.frame/this.fps,i=this.floor(this.time/60/60),s=this.floor(this.time/60)%60,e=this.time%60,h=e<10?"0":"",o=s<10?"0":"",this.textTime.textContent=i+":"+o+s+":"+h+e.toFixed(3)+" | "+this.frame,this.frameTrack=this.floor(this.frame*l+.5*this.framefix)),n=this.floor((this.frame-this.range.start)*l),r=this.floor(this.frame*this.invRatio)+1,this.marker.style.left=n+"px",this.mini.style.left=r+"px"}goTo(t){this.frame=void 0===t?this.frame:t,this.reset(this.frame),this.isPlay||this.loop()}moveTo(t){this.range.end=t-10,this.goTo(t),this.autoScroll()}upMarker(){this.frame&&!this.isPlay&&(this.updateTime(!0),this.tracksUpdate())}autoScroll(){this.frame>this.range.end&&this.moveScroll(Math.round(this.frame*this.invRatio))}findDecal(t){let i=t-this.box.l-this.range.midpos;this.range.decal=Math.abs(i)<this.range.mid?i:0}moveScroll(t,i){i&&(t-=this.range.mid+this.range.decal),t=(t=t<0?0:t)>this.range.max?this.range.max:t,this.moveRange(t)}setRange(){this.ratio=this.frameMax/this.box.w,this.invRatio=this.box.w/this.frameMax;let t=this.zone*this.frameMax/100;this.scalerRec.w=this.floor(t*this.invRatio),this.scalerRec.r=this.scalerRec.l+this.scalerRec.w,this.scaler.style.width=this.scalerRec.w+"px",this.minWidth=this.floor(this.box.w/30/this.ratio),this.changeRange()}moveRange(t){this.scalerRec.l=t,this.scalerRec.r=this.scalerRec.l+this.scalerRec.w,this.scaler.style.left=this.scalerRec.l+"px",this.translateRange();let i=this.trackLength;for(;i--;)this.tracks[i].syncroTrack(this.leftFrame)}translateRange(){let t=this.scalerRec;this.range.start=this.floor(t.l*this.ratio),this.range.end=this.floor(t.r*this.ratio)-1,this.range.midpos=t.l+this.range.mid,this.leftFrame=this.floor(this.frameSize*this.range.start),this.pattern.setAttributeNS(null,"patternTransform","translate("+(-this.leftFrame-.5)+")"),this.updateTime()}changeRange(t,i){let s,e=this.scalerRec,h=this.box;void 0!==t&&(s=i?this.floor(t-e.l):this.floor(e.r-t),s=s<this.minWidth?this.minWidth:s,s=s>h.w?h.w:s,s!==e.w&&(e.w=s,this.scaler.style.width=e.w+"px",i?e.r=t:(e.l=t,this.scaler.style.left=e.l+"px"))),this.range.end=this.floor(e.r*this.ratio),this.range.lng=this.floor(e.w*this.ratio),this.range.max=h.w-e.w,this.range.mid=.5*e.w;let o=(h.w-h.d)/(this.range.lng+1);this.maxPos=h.w-h.d-o,this.frameSize=o,this.invFS=1/o,this.framefix=o<6?6:this.floor(o),this.maxSize=this.floor(o*this.frameMax),void 0!==t&&(this.zone=100*this.range.lng/(this.frameMax+1)),this.translateRange(),this.floor(h.w/this.frameMax),this.marker.style.width=this.framefix+"px",this.markerPrev.style.width=this.framefix+"px",this.miniPrev.style.marginLeft=this.framefix+5+"px",this.timePattern(),this.syncroTracks(),this.upMarker()}timePattern(){let t,i,s,e=this.frameSize;if(e<5){switch(i=this.floor(e)||1,i){case 1:case 2:t=e*this.fps;break;case 3:t=e*(.5*this.fps);break;case 4:t=e*(.25*this.fps)}s="M0 10 L0 20 M"+t+" 10 L"+t+" 20"}else t=5*e,s="M0 10 L0 20M"+e+" 15 L"+e+" 20M"+2*e+" 15 L"+2*e+" 20M"+3*e+" 15 L"+3*e+" 20M"+4*e+" 15 L"+4*e+" 20 M"+t+" 10 L"+t+" 20";this.pattern.childNodes[0].childNodes[0].setAttributeNS(null,"d",s),this.pattern.setAttributeNS(null,"width",t)}dataToString(){let t,i=this.data;for(let s in i)"object"==typeof i[s]&&(t=JSON.stringify(i[s]),t=t.replace(/["']/g,""),t=t.replace(/:/g," "),t=t.replace(/,/g,"|"),t=t.slice(1,t.length-1),i[s]=t);let s=JSON.stringify(i);return s=s.replace(/["']/g,""),s=s.slice(1,s.length-1),s=s.replace(/:/g,": "),s=s.replace(/,/g,"<br>"),s=s.replace(/[|]/g,", "),s+="<br><br>"+this.rfps+" fps",s}info(){return this.rfps+" fps"}getFrameClick(t,i){return t=(t=i?t:t-this.box.l)>this.maxPos?this.maxPos:t,this.floor(t*this.invFS)+this.range.start}setFps(t){this.fps=t,this.frameTime=1/this.fps,this.timerStep=1e3*this.frameTime,this.updateTime(!0)}add(t,i){let s;switch(i=i||{},t=t[0].toUpperCase()+t.slice(1)){case"Bang":s=new j(i,this);break;case"Flag":s=new Y(i,this);break;case"Color":s=new W(i,this);break;case"Curve":s=new Q(i,this);break;case"Switch":s=new X(i,this);break;case"Module":s=new q(i,this);break;case"Lfo":s=new K(i,this);break;case"Audio":s=new J(i,this);break;case"Video":s=new _(i,this)}return s.rename(this.trackLength),this.tracks.push(s),this.trackLength=this.tracks.length,void 0===s.target&&this.inner.appendChild(s.c[0]),s.syncroTrack(this.leftFrame,this.maxSize),clearTimeout(this.addTimer),this.addTimer=setTimeout(this.calc.bind(this),0),s}remove(t){void 0===this.tracks[t].target&&this.inner.removeChild(this.tracks[t].c[0]),this.tracks.splice(t,1),this.trackLength=this.tracks.length;let i=this.trackLength;for(;i--;)this.tracks[i].setID(i);this.calc()}clear(){let t=this.trackLength;for(;t--;)this.tracks[t].clear();this.tracks=[],this.trackLength=0}tracksDown(t){this.overtrack&&this.overtrack.down(t)}tracksMove(t){this.overtrack&&this.overtrack.move(t)}trackOver(t){let i,s=t.clientY,e=this.trackLength;for(null!==this.overtrack&&(this.overtrack.out(),this.overtrack=null);e--;)i=this.tracks[e],z.inRange(s,i.top,i.top+i.h)&&(this.overtrack=i);this.overtrack&&this.overtrack.over(t)}tracksUp(t){this.overtrack&&(this.overtrack.up(t),this.overtrack=null)}tracksUpdate(){let t,i=this.trackLength;for(;i--;)t=this.tracks[i],this.data[t.name]=t.update(this.frame)}unselectKey(){let t=this.trackLength;for(;t--;)this.tracks[t].unselectKey()}stopEditName(){let t=this.trackLength;for(;t--;)this.tracks[t].endEditName()}syncroTracks(){let t=this.trackLength;for(;t--;)this.tracks[t].syncroTrack(this.leftFrame,this.maxSize)}stopMedia(){let t=this.trackLength;for(;t--;)this.tracks[t].isMedia&&this.tracks[t].stop()}upTrackTop(){let t=this.trackLength;for(;t--;)this.tracks[t].needTop&&(this.tracks[t].top=this.tracks[t].c[0].getBoundingClientRect().top)}reset(t){let i=this.trackLength;for(;i--;)this.tracks[i].reset(t)}selected(t){let i=this.trackLength;for(;i--;)this.tracks[i].unSelected();void 0!==t&&t.selected()}calc(){this.hhh.total=0;let t=this.trackLength;for(;t--;)this.hhh.total+=this.tracks[t].h;this.inner.style.height=this.hhh.total+"px",this.hhh.full=this.box.top+this.hhh.total+19,this.resizeHeight()}resize(t){this.box.h=window.innerHeight-this.box.b-this.box.t,this.resizeHeight(),this.resizeWidth(),this.upMarker()}resizeWidth(){this.box.w=window.innerWidth-this.box.l-this.box.r,this.content.style.width=this.box.w+"px",this.topmenu.style.width=this.box.w+"px",this.innerContent.style.width=this.box.w-this.box.d+"px",this.timeBar.style.width=this.box.w-this.box.d+"px",this.setRange(),this.pannel.resize(this.box.l,this.box.w-this.box.d)}resizeHeight(){let t=0,i=0,s=this.box.d,e=this.box;this.hhh.full>e.h?(t=e.h,i=t-(e.top+20),e.d=20,this.viewInvRatio=(this.hhh.total-1)/i,this.hhh.scroll=i*(i/(this.hhh.total-1)),this.maxScy=i-this.hhh.scroll,this.hscroll.style.height=i+1+"px",this.hscroll.childNodes[0].style.height=this.floor(this.hhh.scroll)+"px",this.hscroll.style.display="block",this.isScroll=!0):(t=this.hhh.full,i=t-(e.top+20),e.d=0,this.inner.style.top="0px",this.hscroll.style.display="none",this.isScroll=!1),this.innerContent.style.height=i+"px",this.content.style.height=t+"px",this.marker.style.height=i+18+"px",this.markerPrev.style.height=i+18+"px",this.trackSpace=[e.t+e.top,e.t+t-20],this.upTrackTop(),this.pannel.move(),this.isScroll&&this.setScrollY(),s!==e.d&&this.resizeWidth()}setScrollY(t){void 0!==t&&(this.scy=t-this.box.top-this.box.t-.5*this.hhh.scroll),this.scy=this.scy<0?0:this.scy,this.scy=this.scy>this.maxScy?this.maxScy:this.scy,this.hscroll.childNodes[0].style.top=this.floor(this.scy)+"px",this.inner.style.top=this.floor(-this.scy*this.viewInvRatio)+"px",this.upTrackTop(),this.pannel.move()}setTrackHeight(t){let i=t-this.currentResize.c[0].getBoundingClientRect().top+4;i=i<40?40:i,this.currentResize.setHeight(i),clearTimeout(this.addTimer),this.addTimer=setTimeout(this.calc.bind(this),0)}isInView(t){let i=!0;return t<this.box.top&&(i=!1),t>this.box.h+this.box.top-40&&(i=!1),i}showPannel(t){this.pannel.setKey(t)}},t.Tools=st,t.Utils=z,t.add=et,Object.defineProperty(t,"__esModule",{value:!0})}));
